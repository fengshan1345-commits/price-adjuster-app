<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂÆ∂ÁîµÊä•‰ª∑Âä©Êâã</title>
    
    <!-- PWAÊîØÊåÅ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Êä•‰ª∑Âä©Êâã">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        /* ========== ÂÖ®Â±ÄÊ†∑Âºè ========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
            padding-top: 50px; /* ‰∏∫È°∂ÈÉ®TabÊ†èÁïôÂá∫Á©∫Èó¥ */
            padding-bottom: env(safe-area-inset-bottom); /* iOSÂÆâÂÖ®Âå∫Âüü */
        }
        
        /* ========== È°∂ÈÉ®TabÂØºËà™Ê†è ========== */
        .tab-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #667eea;
            display: flex;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding-top: env(safe-area-inset-top); /* iOSÂàòÊµ∑Â±èÈÄÇÈÖç */
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab-item.active {
            color: white;
            border-bottom-color: white;
            font-weight: 600;
        }
        
        .tab-item:active {
            background: rgba(255,255,255,0.1);
        }
        
        /* ========== ÂÜÖÂÆπÂå∫Âüü ========== */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ========== ‰ºöÂëòÈôêÂà∂Ê†∑Âºè ========== */
        .membership-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 8px;
        }
        
        .membership-lock-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: #f39c12;
        }
        
        .membership-lock-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .membership-lock-desc {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .membership-upgrade-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }
        
        .membership-upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(243, 156, 18, 0.4);
        }
        
        .membership-restricted {
            position: relative;
        }
        
        .membership-restricted .control-input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .membership-restricted .control-label {
            position: relative;
        }
        
        .membership-restricted .control-label::after {
            content: "üîí";
            margin-left: 8px;
            color: #f39c12;
            font-size: 14px;
        }
        
        .membership-badge {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* ========== ‰∫ßÂìÅÁÆ°ÁêÜÂàóË°®È°πÁßªÂä®ÂäüËÉΩÊ†∑Âºè ========== */
        .result-item {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }
        
        .result-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
        }
        
        .result-item.drag-over {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        .drag-handle {
            cursor: grab;
            padding: 8px;
            margin-right: 8px;
            color: #999;
            font-size: 18px;
            user-select: none;
            transition: color 0.2s;
        }
        
        .drag-handle:hover {
            color: #667eea;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .move-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-left: 8px;
        }
        
        .move-btn {
            width: 32px;
            height: 24px;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .move-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .move-btn:disabled {
            background: #f0f0f0;
            color: #ccc;
            cursor: not-allowed;
        }
        
        .item-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 0;
        }
        
        .item-text {
            flex: 1;
            margin-right: 12px;
            word-break: break-word;
        }
        
        .price-display {
            flex-shrink: 0;
        }

        /* ========== ÁïåÈù¢1Ôºö‰∫ßÂìÅÁÆ°ÁêÜ Ê†∑Âºè ========== */
        #productManager .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            margin-top: 20px;
            position: relative;
        }
        
        #productManager h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        #productManager .input-section {
            margin-bottom: 20px;
        }
        
        #productManager textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        #productManager textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        #productManager .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #productManager button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #productManager button:hover {
            background-color: #2980b9;
        }
        
        #productManager button.secondary {
            background-color: #95a5a6;
        }
        
        #productManager button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        #productManager button.danger {
            background-color: #e74c3c;
        }
        
        #productManager button.danger:hover {
            background-color: #c0392b;
        }
        
        #productManager .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        #productManager .stats-vertical {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        #productManager .stat-item {
            text-align: center;
        }
        
        #productManager .stat-item-vertical {
            text-align: center;
            flex: 1;
        }
        
        #productManager .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        #productManager .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        #productManager .results-container {
            margin-top: 20px;
            max-height: 60vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            -webkit-overflow-scrolling: touch;
        }
        
        #productManager .result-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
            position: relative;
            cursor: default;
        }
        
        #productManager .result-item:last-child {
            border-bottom: none;
        }
        
        #productManager .result-item:hover {
            background-color: #f8f9fa;
        }
        
        #productManager .result-item.selected {
            background-color: #e8f4fd;
        }
        
        #productManager .checkbox {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        #productManager .checkbox.hidden {
            display: none;
        }
        
        #productManager .price {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 5px;
        }
        
        #productManager .price-display {
            margin-left: auto;
            margin-right: 10px;
        }
        
        #productManager .blue-price {
            color: #2196F3;
            font-weight: bold;
            background-color: #f0f8ff;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #bbdefb;
        }
        
        #productManager .no-price {
            color: #999;
            font-style: italic;
        }
        
        #productManager .sort-controls {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #productManager select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #productManager .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        #productManager .copy-success.show {
            opacity: 1;
        }
        
        /* ========== ÁïåÈù¢2Ôºö‰ª∑Ê†ºË∞ÉÊï¥ Ê†∑Âºè ========== */
        #priceAdjuster .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 4vw;
        }
        
        #priceAdjuster .header { 
            text-align: center; 
            margin-bottom: 6vw; 
        }
        
        #priceAdjuster .title { 
            font-size: 6vw; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 2vw; 
        }
        
        #priceAdjuster .subtitle { 
            font-size: 4vw; 
            color: #666; 
        }
        
        #priceAdjuster .test-section { 
            background: white; 
            border-radius: 12px; 
            padding: 4vw; 
            margin-bottom: 4vw; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        
        #priceAdjuster .test-title { 
            font-size: 4.5vw; 
            font-weight: 600; 
            margin-bottom: 3vw; 
            color: #333; 
        }
        
        #priceAdjuster .input-area { 
            margin-bottom: 4vw; 
        }
        
        #priceAdjuster .input-text { 
            width: 100%; 
            min-height: 200px; 
            padding: 3vw; 
            font-size: 4vw; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            resize: vertical; 
        }
        
        #priceAdjuster .input-text:focus { 
            outline: none; 
            border-color: #667eea; 
        }
        
        #priceAdjuster .btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 3vw 6vw; 
            border-radius: 8px; 
            font-size: 4vw; 
            font-weight: 600; 
            cursor: pointer; 
            margin: 2vw; 
        }
        
        #priceAdjuster .btn:hover { 
            background: #5a6fd8; 
        }
        
        #priceAdjuster .btn-success { 
            background: #4caf50; 
        }
        
        #priceAdjuster .result-area { 
            margin-top: 4vw; 
        }
        
        #priceAdjuster .result-item { 
            background: #f9f9f9; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 3vw; 
            margin-bottom: 2vw; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        
        #priceAdjuster .result-item.has-price { 
            border-color: #4caf50; 
            background: #f0f8f0; 
        }
        
        #priceAdjuster .result-item.no-price { 
            border-color: #ff9800; 
            background: #fff8f0; 
        }
        
        #priceAdjuster .result-content { 
            flex: 1; 
            font-size: 3.5vw; 
            color: #333; 
        }
        
        #priceAdjuster .result-price { 
            font-size: 4.5vw; 
            font-weight: 700; 
            color: #4caf50; 
            margin-left: 2vw; 
        }
        
        #priceAdjuster .result-price.original { 
            color: #666; 
            text-decoration: line-through; 
        }
        
        #priceAdjuster .result-price.new { 
            color: #f44336; 
        }
        
        #priceAdjuster .stats { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 2vw; 
            margin-top: 4vw; 
        }
        
        #priceAdjuster .stat-item { 
            text-align: center; 
            padding: 3vw; 
            background: #f0f0f0; 
            border-radius: 8px; 
        }
        
        #priceAdjuster .stat-number { 
            font-size: 6vw; 
            font-weight: 700; 
        }
        
        #priceAdjuster .stat-label { 
            font-size: 3vw; 
            color: #666; 
            margin-top: 1vw; 
        }
        
        #priceAdjuster .price-controls { 
            background: #e8f5e8; 
            padding: 3vw; 
            border-radius: 8px; 
            margin-bottom: 4vw; 
        }
        
        #priceAdjuster .control-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 2vw; 
        }
        
        #priceAdjuster .control-label { 
            font-size: 3.5vw; 
            margin-right: 2vw; 
            min-width: 120px; 
        }
        
        #priceAdjuster .control-input { 
            flex: 1; 
            padding: 2vw; 
            font-size: 3.5vw; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
        }
        
        /* ========== ÁïåÈù¢3ÔºöÁ¨¶Âè∑Êõ¥Êç¢ Ê†∑Âºè ========== */
        #symbolChanger .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 4vw;
        }
        
        #symbolChanger .header { 
            text-align: center; 
            margin-bottom: 6vw; 
        }
        
        #symbolChanger .title { 
            font-size: 6vw; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 2vw; 
        }
        
        #symbolChanger .subtitle { 
            font-size: 4vw; 
            color: #666; 
        }
        
        #symbolChanger .test-section { 
            background: white; 
            border-radius: 12px; 
            padding: 4vw; 
            margin-bottom: 4vw; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        
        #symbolChanger .test-title { 
            font-size: 4.5vw; 
            font-weight: 600; 
            margin-bottom: 3vw; 
            color: #333; 
        }
        
        #symbolChanger .input-area { 
            margin-bottom: 4vw; 
        }
        
        #symbolChanger .input-text { 
            width: 100%; 
            min-height: 200px; 
            padding: 3vw; 
            font-size: 4vw; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            resize: vertical; 
        }
        
        #symbolChanger .input-text:focus { 
            outline: none; 
            border-color: #667eea; 
        }
        
        #symbolChanger .btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 3vw 6vw; 
            border-radius: 8px; 
            font-size: 4vw; 
            font-weight: 600; 
            cursor: pointer; 
            margin: 2vw; 
        }
        
        #symbolChanger .btn:hover { 
            background: #5a6fd8; 
        }
        
        #symbolChanger .btn-success { 
            background: #4caf50; 
        }
        
        #symbolChanger .result-area { 
            margin-top: 4vw; 
            max-height: 60vh; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
        }
        
        #symbolChanger .result-area::-webkit-scrollbar {
            width: 6px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        #symbolChanger .result-area {
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }
        
        #symbolChanger .result-item { 
            background: #f9f9f9; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 3vw; 
            margin-bottom: 2vw; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            cursor: default;
        }
        
        #symbolChanger .result-item.has-price { 
            border-color: #4caf50; 
            background: #f0f8f0; 
        }
        
        #symbolChanger .result-item.no-price { 
            border-color: #ff9800; 
            background: #fff8f0; 
        }
        
        #symbolChanger .result-content { 
            flex: 1; 
            font-size: 3.5vw; 
            color: #333; 
        }
        
        #symbolChanger .result-price { 
            font-size: 4.5vw; 
            font-weight: 700; 
            color: #4caf50; 
            margin-left: 2vw; 
        }
        
        #symbolChanger .stats { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 2vw; 
            margin-top: 4vw; 
        }
        
        #symbolChanger .stat-item { 
            text-align: center; 
            padding: 3vw; 
            background: #f0f0f0; 
            border-radius: 8px; 
        }
        
        #symbolChanger .stat-number { 
            font-size: 6vw; 
            font-weight: 700; 
        }
        
        #symbolChanger .stat-label { 
            font-size: 3vw; 
            color: #666; 
            margin-top: 1vw; 
        }
        
        /* ========== ‰ºöÂëòÁ≥ªÁªüÊ†∑Âºè ========== */
        #membership .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .membership-status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-info {
            display: flex;
            align-items: center;
        }
        
        .status-icon {
            font-size: 40px;
            margin-right: 15px;
        }
        
        .status-text h3 {
            margin: 0 0 5px 0;
            font-size: 24px;
        }
        
        .status-text p {
            margin: 0;
            opacity: 0.9;
        }
        
        .section-title {
            font-size: 20px;
            color: #333;
            margin: 30px 0 20px 0;
            text-align: center;
        }
        
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .package-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .package-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .package-card.popular {
            border-color: #ff6b35;
            transform: scale(1.05);
        }
        
        .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b35;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .package-header h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: #333;
        }
        
        .package-price {
            margin-bottom: 20px;
        }
        
        .price-new {
            font-size: 32px;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .price-original {
            font-size: 16px;
            color: #999;
            text-decoration: line-through;
            margin-left: 10px;
        }
        
        .package-features {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .package-features p {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
        }
        
        .btn-package {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .btn-package:hover {
            background: #5a6fd8;
        }
        
        .referral-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .referral-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .referral-code {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .referral-code input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 16px;
        }
        
        .btn-small {
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .referral-desc {
            font-size: 14px;
            color: #666;
            margin: 10px 0 0 0;
        }
        
        .referral-input {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .referral-code-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-code-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .benefit-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .benefit-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .benefit-item h4 {
            margin: 10px 0;
            color: #333;
        }
        
        .benefit-item p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        /* ========== ËÆæÁΩÆÁïåÈù¢Ê†∑Âºè ========== */
        #settings .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .user-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .user-avatar {
            font-size: 40px;
            margin-right: 15px;
        }
        
        .user-details h3 {
            margin: 0 0 5px 0;
            font-size: 20px;
        }
        
        .user-details p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .login-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .login-buttons .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .settings-section .section-title {
            font-size: 18px;
            color: #333;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-item label {
            font-weight: 500;
            color: #333;
        }
        
        .setting-item select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .checkmark {
            margin-left: 8px;
        }
        
        .about-info {
            text-align: center;
        }
        
        .about-info p {
            margin: 10px 0;
            color: #666;
        }
        
        .contact-links {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn-link {
            background: none;
            border: none;
            color: #667eea;
            text-decoration: underline;
            cursor: pointer;
            padding: 5px 10px;
        }
        
        .btn-link:hover {
            color: #5a6fd8;
        }
        
        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .form-actions .btn {
            flex: 1;
        }
        
        /* ========== ‰∏ªÈ¢òÂíåÂ≠ó‰ΩìÊ†∑Âºè ========== */
        .theme-dark {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        .theme-dark .tab-bar {
            background-color: #2d2d2d;
            border-bottom-color: #444;
        }
        
        .theme-dark .tab-item {
            color: #e0e0e0;
        }
        
        .theme-dark .tab-item.active {
            color: #667eea;
        }
        
        .theme-dark .container {
            background-color: #1a1a1a;
        }
        
        .theme-dark .settings-section {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        .theme-dark .setting-item {
            border-bottom-color: #444;
        }
        
        .theme-dark .setting-item label {
            color: #e0e0e0;
        }
        
        .theme-dark .setting-item select {
            background-color: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }
        
        .theme-dark .modal-content {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        .theme-dark .modal-header {
            border-bottom-color: #444;
        }
        
        .theme-dark .form-group input {
            background-color: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }
        
        .theme-dark .form-group input:focus {
            border-color: #667eea;
        }
        
        /* Â≠ó‰ΩìÂ§ßÂ∞èÊ†∑Âºè */
        .font-small {
            font-size: 14px;
        }
        
        .font-small .tab-item {
            font-size: 14px;
        }
        
        .font-small .container h1 {
            font-size: 24px;
        }
        
        .font-small .btn {
            font-size: 14px;
            padding: 8px 16px;
        }
        
        .font-large {
            font-size: 18px;
        }
        
        .font-large .tab-item {
            font-size: 18px;
        }
        
        .font-large .container h1 {
            font-size: 32px;
        }
        
        .font-large .btn {
            font-size: 18px;
            padding: 12px 24px;
        }
        
        /* ========== ÂìçÂ∫îÂºèËÆæËÆ° ========== */
        @media (max-width: 768px) {
            #productManager .container {
                margin: 10px;
                padding: 15px;
            }
            
            #productManager .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            #productManager .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .packages-grid {
                grid-template-columns: 1fr;
            }
            
            .package-card.popular {
                transform: none;
            }
            
            .membership-status-card {
                flex-direction: column;
                text-align: center;
            }
            
            .status-info {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®TabÂØºËà™Ê†è -->
    <div class="tab-bar">
        <div class="tab-item" data-tab="productManager">‰∫ßÂìÅÁÆ°ÁêÜ</div>
        <div class="tab-item active" data-tab="priceAdjuster">‰ª∑Ê†ºË∞ÉÊï¥</div>
        <div class="tab-item" data-tab="symbolChanger">Á¨¶Âè∑Êõ¥Êç¢</div>
        <div class="tab-item" data-tab="membership" style="color: #ff6b35;">üëë ‰ºöÂëò</div>
        <div class="tab-item" data-tab="settings">‚öôÔ∏è ËÆæÁΩÆ</div>
        <div id="membershipStatusBadge" class="membership-badge" style="display: none;">‰ºöÂëò</div>
    </div>
    
    <!-- ÁïåÈù¢1Ôºö‰∫ßÂìÅÁÆ°ÁêÜ -->
    <div id="productManager" class="tab-content">
        <div class="container">
            <h1>‰∫ßÂìÅÂàóË°®ÁÆ°ÁêÜÂô®</h1>
            
            <div class="input-section">
                <textarea id="pm_inputText" placeholder="ËØ∑Âú®Ê≠§Á≤òË¥¥ÂåÖÂê´‰∫ßÂìÅ‰ø°ÊÅØÁöÑÊñáÊú¨..."></textarea>
            </div>
            
            <div class="action-buttons">
                <button id="pm_parseBtn">Ëß£ÊûêÊñáÊú¨</button>
                <button id="pm_batchDeleteBtn" class="danger">ÊâπÈáèÂà†Èô§</button>
                <button id="pm_deleteSelectedBtn" class="danger" style="display: none;">Âà†Èô§ÈÄâ‰∏≠</button>
                <button id="pm_cancelDeleteBtn" class="secondary" style="display: none;">ÂèñÊ∂à</button>
                <button id="pm_copyBtn">Â§çÂà∂ÁªìÊûú</button>
            </div>
            
            <div class="sort-controls">
                <label>ÊéíÂ∫èÊñπÂºèÔºö</label>
                <select id="pm_sortSelect">
                    <option value="original">ÂéüÂßãÈ°∫Â∫è</option>
                    <option value="priceAsc">‰ª∑Ê†ºÂçáÂ∫è</option>
                    <option value="priceDesc">‰ª∑Ê†ºÈôçÂ∫è</option>
                    <option value="nameAsc">ÂêçÁß∞ÂçáÂ∫è</option>
                </select>
            </div>
            
            <div class="stats-vertical">
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_totalLines">0</div>
                    <div class="stat-label">ÊÄªË°åÊï∞</div>
                </div>
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_priceLines">0</div>
                    <div class="stat-label">Âê´‰ª∑Ê†ºË°å</div>
                </div>
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_textLines">0</div>
                    <div class="stat-label">Á∫ØÊñáÊú¨Ë°å</div>
                </div>
            </div>
            
            <div class="results-container" id="pm_resultsContainer"></div>
        </div>
        
        <div class="copy-success" id="pm_copySuccess">Â§çÂà∂ÊàêÂäüÔºÅ</div>
    </div>
    
    <!-- ÁïåÈù¢2Ôºö‰ª∑Ê†ºË∞ÉÊï¥ -->
    <div id="priceAdjuster" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1 class="title">üí∞ ‰ª∑Ê†ºË∞ÉÊï¥Âô®</h1>
                <p class="subtitle">Êô∫ËÉΩËØÜÂà´‰ª∑Ê†ºÂπ∂Á≤æÂáÜË∞ÉÊï¥</p>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">üìù ËæìÂÖ•‰∫ßÂìÅ‰ø°ÊÅØ</h2>
                <div class="input-area">
                    <textarea class="input-text" id="pa_productInput" placeholder="ËØ∑Á≤òË¥¥ÂÆ¢Êà∑ÁöÑ‰∫ßÂìÅ‰ø°ÊÅØ..."></textarea>
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="PriceAdjuster.parseProducts()">üîç Ëß£Êûê‰ª∑Ê†º</button>
                    <button class="btn btn-success" onclick="PriceAdjuster.applyPricing()">üìà Â∫îÁî®Ë∞É‰ª∑</button>
                    <button class="btn" onclick="PriceAdjuster.copyResults()">üìã Â§çÂà∂ÁªìÊûú</button>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">‚öôÔ∏è Ë∞É‰ª∑ËÆæÁΩÆ</h2>
                <div class="price-controls">
                    <div class="control-row">
                        <span class="control-label">Ë∞É‰ª∑ÊñπÂºè:</span>
                        <select class="control-input" id="pa_pricingType">
                            <option value="percentage">ÁôæÂàÜÊØîË∞É‰ª∑</option>
                            <option value="fixed">Âõ∫ÂÆöÈáëÈ¢ùË∞É‰ª∑</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">Ë∞É‰ª∑ÂπÖÂ∫¶:</span>
                        <input type="number" class="control-input" id="pa_pricingValue" value="5" placeholder="5">
                        <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                    </div>
                    <div class="control-row">
                        <span class="control-label">Ë∞É‰ª∑ÊñπÂêë:</span>
                        <select class="control-input" id="pa_pricingDirection">
                            <option value="increase">Ê∂®‰ª∑</option>
                            <option value="decrease">Èôç‰ª∑</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">‰ª∑Ê†ºÂèñÊï¥:</span>
                        <select class="control-input" id="pa_priceRounding">
                            <option value="none" selected>‰∏çÂèñÊï¥</option>
                            <option value="ones">‰∏™‰ΩçÂèñÊï¥</option>
                            <option value="tens">ÂçÅ‰ΩçÂèñÊï¥</option>
                            <option value="hundreds">Áôæ‰ΩçÂèñÊï¥</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">Ë∞É‰ª∑Ê®°Âºè:</span>
                        <select class="control-input" id="pa_pricingMode" onchange="PriceAdjuster.togglePricingMode()">
                            <option value="uniform">Áªü‰∏ÄË∞É‰ª∑</option>
                            <option value="range">Âå∫Èó¥Ë∞É‰ª∑</option>
                        </select>
                    </div>
                    <!-- Âå∫Èó¥Ë∞É‰ª∑ËÆæÁΩÆ -->
                    <div id="pa_rangePricingSection" style="display: none; margin-top: 3vw; padding: 3vw; background: #f0f8ff; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 2vw; font-size: 4vw;">‰ª∑Ê†ºÂå∫Èó¥ËÆæÁΩÆ:</div>
                        <div class="control-row">
                            <span class="control-label">0-999:</span>
                            <input type="number" class="control-input" id="pa_range0_999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">1000-1999:</span>
                            <input type="number" class="control-input" id="pa_range1000_1999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">2000-4999:</span>
                            <input type="number" class="control-input" id="pa_range2000_4999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">5000-9999:</span>
                            <input type="number" class="control-input" id="pa_range5000_9999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">10000+:</span>
                            <input type="number" class="control-input" id="pa_range10000_plus" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">üìä Ëß£ÊûêÁªìÊûú <button class="btn" onclick="PriceAdjuster.copyResults()" style="float: right; font-size: 3vw; padding: 1.5vw 3vw; margin: 0;">üìã Â§çÂà∂</button></h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="pa_totalLines">0</div>
                        <div class="stat-label">ÊÄªË°åÊï∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number success" id="pa_priceLines">0</div>
                        <div class="stat-label">Âê´‰ª∑Ê†ºË°å</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number warning" id="pa_textLines">0</div>
                        <div class="stat-label">Á∫ØÊñáÊú¨Ë°å</div>
                    </div>
                </div>
                <div class="result-area" id="pa_resultArea"></div>
            </div>
        </div>
    </div>
    
    <!-- ÁïåÈù¢3ÔºöÁ¨¶Âè∑Êõ¥Êç¢ -->
    <div id="symbolChanger" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">üîÑ Á¨¶Âè∑Êõ¥Êç¢Âô®</h1>
                <p class="subtitle">ÊâπÈáèÊõ¥Êç¢‰ª∑Ê†ºÂâçÁöÑÁ¨¶Âè∑</p>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">üìù ËæìÂÖ•‰∫ßÂìÅ‰ø°ÊÅØ</h2>
                <div class="input-area">
                    <textarea class="input-text" id="sc_productInput" placeholder="ËØ∑Á≤òË¥¥ÂÆ¢Êà∑ÁöÑ‰∫ßÂìÅ‰ø°ÊÅØ..."></textarea>
                </div>
                
                <div class="input-area" style="margin-top: 3vw;">
                    <label style="font-size: 3.5vw; color: #666; margin-bottom: 1vw; display: block;">üí∞ ‰ª∑Ê†ºÂâçÊõøÊç¢Á¨¶Âè∑Ôºö</label>
                    <input type="text" id="sc_priceSeparator" placeholder="ËæìÂÖ•ÊõøÊç¢Á¨¶Âè∑ÔºàÂ¶Çüí∞„ÄÅ„ÄêÂèë„ÄëÁ≠âÔºâ" value="" style="width: 100%; padding: 3vw; font-size: 4vw; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <p style="font-size: 3vw; color: #999; margin-top: 1vw;">ÊèêÁ§∫ÔºöÁïôÁ©∫Ë°®Á§∫‰∏çÊõøÊç¢ÔºåÊîØÊåÅË°®ÊÉÖÁ¨¶Âè∑</p>
                </div>
                
                <!-- ÁªìÂ∞æËØ¥ÊòéËÆæÁΩÆ -->
                <div class="input-area" style="margin-top: 3vw; padding: 3vw; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                    <div style="display: flex; align-items: center; margin-bottom: 2vw;">
                        <input type="checkbox" id="sc_enableFooter" style="margin-right: 2vw; transform: scale(1.2);">
                        <label for="sc_enableFooter" style="font-size: 3.5vw; color: #333; font-weight: 600;">Ëá™Âä®Ê∑ªÂä†ÁªìÂ∞æËØ¥Êòé</label>
                    </div>
                    <textarea id="sc_footerText" placeholder="ËæìÂÖ•ÁªìÂ∞æËØ¥ÊòéÂÜÖÂÆπ..." style="width: 100%; padding: 3vw; font-size: 3.5vw; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 80px; resize: vertical;">Âπ≥Âè∞Áé∞Êü•Ôºå‰ª∑Ê†ºÂèØËÉΩ‰ºöÊúâÊ≥¢Âä®ÔºåÊÑüË∞¢ÁêÜËß£ÔºÅÈÉ®ÂàÜ‰∫ßÂìÅÁßÅËÅäËØ¢‰ª∑‰∏ãÂçïÔºåÊúüÂæÖÂêà‰Ωú[Êè°Êâã]</textarea>
                    <p style="font-size: 3vw; color: #999; margin-top: 1vw;">ÊèêÁ§∫ÔºöÂãæÈÄâÂêéÔºåÊ≠§ÂÜÖÂÆπÂ∞ÜËá™Âä®Ê∑ªÂä†Âà∞ÊñáÁ´†Êú´Â∞æ„ÄÇ</p>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn" onclick="SymbolChanger.parseProducts()">üîç Ëß£Êûê‰ª∑Ê†º</button>
                    <button class="btn btn-primary" onclick="SymbolChanger.applyPriceSeparator()" style="margin-top: 2vw;">‚ú® Â∫îÁî®Êõ¥Êç¢</button>
                    <button class="btn btn-success" onclick="SymbolChanger.copyResults()" style="margin-top: 2vw;">üìã Â§çÂà∂ÁªìÊûú</button>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">üìä Ëß£ÊûêÁªìÊûú <button class="btn" onclick="SymbolChanger.copyResults()" style="float: right; font-size: 3vw; padding: 1.5vw 3vw; margin: 0;">üìã Â§çÂà∂</button></h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="sc_totalLines">0</div>
                        <div class="stat-label">ÊÄªË°åÊï∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number success" id="sc_priceLines">0</div>
                        <div class="stat-label">Âê´‰ª∑Ê†ºË°å</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number warning" id="sc_textLines">0</div>
                        <div class="stat-label">Á∫ØÊñáÊú¨Ë°å</div>
                    </div>
                </div>
                <div class="result-area" id="sc_resultArea"></div>
            </div>
        </div>
    </div>
    
    <!-- ÁïåÈù¢4Ôºö‰ºöÂëò‰∏≠ÂøÉ -->
    <div id="membership" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">üëë ‰ºöÂëò‰∏≠ÂøÉ</h1>
                <p class="subtitle">Ëß£ÈîÅÊõ¥Â§öÂäüËÉΩÔºå‰∫´Âèó‰∏ì‰∏öÊúçÂä°</p>
            </div>
            
            <!-- ‰ºöÂëòÁä∂ÊÄÅÂç°Áâá -->
            <div class="membership-status-card" id="membershipStatusCard">
                <div class="status-info">
                    <div class="status-icon">üëë</div>
                    <div class="status-text">
                        <h3 id="membershipStatus">ÂÖçË¥πÁî®Êà∑</h3>
                        <p id="membershipExpiry">Á´ãÂç≥ÂºÄÈÄö‰ºöÂëòÔºå‰∫´ÂèóÊõ¥Â§öÂäüËÉΩ</p>
                    </div>
                </div>
                <div class="status-actions">
                    <button class="btn btn-primary" onclick="Membership.showPurchaseModal()">ÂºÄÈÄö‰ºöÂëò</button>
                </div>
            </div>
            
            <!-- ‰ºöÂëòÂ•óÈ§êÈÄâÊã© -->
            <div class="membership-packages" id="membershipPackages" style="display: none;">
                <h2 class="section-title">ÈÄâÊã©‰ºöÂëòÂ•óÈ§ê</h2>
                <div class="packages-grid">
                    <!-- ÊúàÂ∫¶Â•óÈ§ê -->
                    <div class="package-card" data-package="monthly">
                        <div class="package-header">
                            <h3>ÊúàÂ∫¶‰ºöÂëò</h3>
                            <div class="package-price">
                                <span class="price-new">¬•19</span>
                                <span class="price-original">¬•33</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>‚úÖ 30Â§©‰ºöÂëòÊùÉÁõä</p>
                            <p>‚úÖ Êó†ÈôêÂà∂‰ΩøÁî®ÊâÄÊúâÂäüËÉΩ</p>
                            <p>‚úÖ ‰ºòÂÖàÂÆ¢ÊúçÊîØÊåÅ</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('monthly')">Á´ãÂç≥Ë¥≠‰π∞</button>
                    </div>
                    
                    <!-- ÂçäÂπ¥Â•óÈ§ê -->
                    <div class="package-card popular" data-package="halfyear">
                        <div class="popular-badge">ÊúÄÂàíÁÆó</div>
                        <div class="package-header">
                            <h3>ÂçäÂπ¥‰ºöÂëò</h3>
                            <div class="package-price">
                                <span class="price-new">¬•99</span>
                                <span class="price-original">¬•198</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>‚úÖ 120Â§©‰ºöÂëòÊùÉÁõäÔºà‰π∞3ÈÄÅ3Ôºâ</p>
                            <p>‚úÖ Êó†ÈôêÂà∂‰ΩøÁî®ÊâÄÊúâÂäüËÉΩ</p>
                            <p>‚úÖ ‰ºòÂÖàÂÆ¢ÊúçÊîØÊåÅ</p>
                            <p>‚úÖ ‰∏ìÂ±û‰ºöÂëòÊ†áËØÜ</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('halfyear')">Á´ãÂç≥Ë¥≠‰π∞</button>
                    </div>
                    
                    <!-- Âπ¥Â∫¶Â•óÈ§ê -->
                    <div class="package-card" data-package="yearly">
                        <div class="package-header">
                            <h3>Âπ¥Â∫¶‰ºöÂëò</h3>
                            <div class="package-price">
                                <span class="price-new">¬•188</span>
                                <span class="price-original">¬•396</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>‚úÖ 360Â§©‰ºöÂëòÊùÉÁõäÔºà‰π∞6ÈÄÅ6Ôºâ</p>
                            <p>‚úÖ Êó†ÈôêÂà∂‰ΩøÁî®ÊâÄÊúâÂäüËÉΩ</p>
                            <p>‚úÖ ‰ºòÂÖàÂÆ¢ÊúçÊîØÊåÅ</p>
                            <p>‚úÖ ‰∏ìÂ±û‰ºöÂëòÊ†áËØÜ</p>
                            <p>‚úÖ Êé®ËçêÂ•ñÂä±ÁâπÊùÉ</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('yearly')">Á´ãÂç≥Ë¥≠‰π∞</button>
                    </div>
                </div>
            </div>
            
            <!-- Êé®ËçêÁ≥ªÁªü -->
            <div class="referral-section">
                <h2 class="section-title">Êé®ËçêÂ•ΩÂèã</h2>
                <div class="referral-card">
                    <div class="referral-info">
                        <h3>ÊàëÁöÑÊé®ËçêÁ†Å</h3>
                        <div class="referral-code">
                            <input type="text" id="myReferralCode" readonly>
                            <button class="btn btn-small" onclick="Membership.copyReferralCode()">Â§çÂà∂</button>
                        </div>
                        <p class="referral-desc">Â•ΩÂèã‰ΩøÁî®ÊÇ®ÁöÑÊé®ËçêÁ†ÅÊ≥®ÂÜåÔºåÂèåÊñπÈÉΩËÉΩËé∑Âæó‰ºöÂëòÂ§©Êï∞Â•ñÂä±ÔºÅ</p>
                    </div>
                </div>
                
                <div class="referral-input">
                    <h3>ËæìÂÖ•Êé®ËçêÁ†Å</h3>
                    <div class="referral-code-input">
                        <input type="text" id="referralCodeInput" placeholder="ËØ∑ËæìÂÖ•Êé®ËçêÁ†Å">
                        <button class="btn btn-primary" onclick="Membership.applyReferralCode()">‰ΩøÁî®Êé®ËçêÁ†Å</button>
                    </div>
                </div>
            </div>
            
            <!-- ‰ºöÂëòÁâπÊùÉËØ¥Êòé -->
            <div class="member-benefits">
                <h2 class="section-title">‰ºöÂëòÁâπÊùÉ</h2>
                <div class="benefits-grid">
                    <div class="benefit-item">
                        <div class="benefit-icon">üöÄ</div>
                        <h4>Êó†ÈôêÂà∂‰ΩøÁî®</h4>
                        <p>Ëß£Èô§ÊâÄÊúâÂäüËÉΩÈôêÂà∂ÔºåÁïÖ‰∫´ÂÆåÊï¥‰ΩìÈ™å</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">‚ö°</div>
                        <h4>‰ºòÂÖàÂ§ÑÁêÜ</h4>
                        <p>‰∫´ÂèóÊõ¥Âø´ÁöÑÂ§ÑÁêÜÈÄüÂ∫¶Âíå‰ºòÂÖàÂÆ¢Êúç</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üéÅ</div>
                        <h4>Êé®ËçêÂ•ñÂä±</h4>
                        <p>Êé®ËçêÂ•ΩÂèãËé∑ÂæóÈ¢ùÂ§ñ‰ºöÂëòÂ§©Êï∞Â•ñÂä±</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">üíé</div>
                        <h4>‰∏ìÂ±ûÊ†áËØÜ</h4>
                        <p>ÊòæÁ§∫‰∏ìÂ±û‰ºöÂëòÊ†áËØÜÔºåÂΩ∞ÊòæË∫´‰ªΩ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÁïåÈù¢5ÔºöËÆæÁΩÆ‰∏≠ÂøÉ -->
    <div id="settings" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">‚öôÔ∏è ËÆæÁΩÆ‰∏≠ÂøÉ</h1>
                <p class="subtitle">‰∏™ÊÄßÂåñÊÇ®ÁöÑ‰ΩøÁî®‰ΩìÈ™å</p>
            </div>
            
            <!-- Áî®Êà∑‰ø°ÊÅØÂç°Áâá -->
            <div class="user-info-card" id="userInfoCard">
                <div class="user-avatar">üë§</div>
                <div class="user-details">
                    <h3 id="userName">Êú™ÁôªÂΩï</h3>
                    <p id="userStatus">ÁÇπÂáªÁôªÂΩï‰∫´ÂèóÊõ¥Â§öÂäüËÉΩ</p>
                </div>
                <div class="login-buttons" id="loginButtons">
                    <button class="btn btn-primary" onclick="Settings.handlePhoneLogin()" id="phoneLoginBtn">üì± ‰∏ÄÈîÆÁôªÂΩï</button>
                    <button class="btn btn-secondary" onclick="Settings.showLoginModal()" id="otherLoginBtn">ÂÖ∂‰ªñÁôªÂΩï</button>
                </div>
            </div>
            
            <!-- ËÆæÁΩÆÈÄâÈ°π -->
            <div class="settings-sections">
                <!-- Â§ñËßÇËÆæÁΩÆ -->
                <div class="settings-section">
                    <h3 class="section-title">üé® Â§ñËßÇËÆæÁΩÆ</h3>
                    <div class="setting-item">
                        <label>‰∏ªÈ¢òÊ®°Âºè</label>
                        <select id="themeSelect" onchange="Settings.changeTheme()">
                            <option value="light">ÊµÖËâ≤Ê®°Âºè</option>
                            <option value="dark">Ê∑±Ëâ≤Ê®°Âºè</option>
                            <option value="auto">Ë∑üÈöèÁ≥ªÁªü</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Â≠ó‰ΩìÂ§ßÂ∞è</label>
                        <select id="fontSizeSelect" onchange="Settings.changeFontSize()">
                            <option value="small">Â∞è</option>
                            <option value="medium" selected>‰∏≠</option>
                            <option value="large">Â§ß</option>
                        </select>
                    </div>
                </div>
                
                <!-- ÂäüËÉΩËÆæÁΩÆ -->
                <div class="settings-section">
                    <h3 class="section-title">üîß ÂäüËÉΩËÆæÁΩÆ</h3>
                    <div class="setting-item">
                        <label>Ëá™Âä®‰øùÂ≠ò</label>
                        <label class="switch">
                            <input type="checkbox" id="autoSave" checked onchange="Settings.toggleAutoSave()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>‰ª∑Ê†ºËØÜÂà´ÊèêÁ§∫</label>
                        <label class="switch">
                            <input type="checkbox" id="priceHint" checked onchange="Settings.togglePriceHint()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>ÈúáÂä®ÂèçÈ¶à</label>
                        <label class="switch">
                            <input type="checkbox" id="vibration" onchange="Settings.toggleVibration()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Êï∞ÊçÆÁÆ°ÁêÜ -->
                <div class="settings-section">
                    <h3 class="section-title">üìä Êï∞ÊçÆÁÆ°ÁêÜ</h3>
                    <div class="setting-item">
                        <label>ÂØºÂá∫Êï∞ÊçÆ</label>
                        <button class="btn btn-secondary" onclick="Settings.exportData()">ÂØºÂá∫</button>
                    </div>
                    <div class="setting-item">
                        <label>ÂØºÂÖ•Êï∞ÊçÆ</label>
                        <input type="file" id="importFile" accept=".json" onchange="Settings.importData()" style="display: none;">
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">ÂØºÂÖ•</button>
                    </div>
                    <div class="setting-item">
                        <label>Ê∏ÖÈô§Êï∞ÊçÆ</label>
                        <button class="btn btn-danger" onclick="Settings.clearData()">Ê∏ÖÈô§</button>
                    </div>
                </div>
                
                <!-- ÂÖ≥‰∫éÊàë‰ª¨ -->
                <div class="settings-section">
                    <h3 class="section-title">‚ÑπÔ∏è ÂÖ≥‰∫éÊàë‰ª¨</h3>
                    <div class="about-info">
                        <p><strong>ÂÆ∂ÁîµÊä•‰ª∑Âä©Êâã</strong></p>
                        <p>ÁâàÊú¨Ôºö1.0.0</p>
                        <p>‰∏ì‰∏∫ÂÆ∂ÁîµË°å‰∏öÊâìÈÄ†ÁöÑÊô∫ËÉΩÊä•‰ª∑Â∑•ÂÖ∑</p>
                        <div class="contact-links">
                            <button class="btn btn-link" onclick="Settings.showFeedback()">ÊÑèËßÅÂèçÈ¶à</button>
                            <button class="btn btn-link" onclick="Settings.showHelp()">‰ΩøÁî®Â∏ÆÂä©</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Áî®Êà∑ÁôªÂΩï</h2>
                <span class="close" onclick="Settings.closeLoginModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Áî®Êà∑Âêç</label>
                        <input type="text" id="username" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required>
                    </div>
                    <div class="form-group">
                        <label for="password">ÂØÜÁ†Å</label>
                        <input type="password" id="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            ËÆ∞‰ΩèÊàë
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ÁôªÂΩï</button>
                        <button type="button" class="btn btn-secondary" onclick="Settings.showRegisterModal()">Ê≥®ÂÜå</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Ê≥®ÂÜåÊ®°ÊÄÅÊ°Ü -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Áî®Êà∑Ê≥®ÂÜå</h2>
                <span class="close" onclick="Settings.closeRegisterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">Áî®Êà∑Âêç</label>
                        <input type="text" id="regUsername" placeholder="ËØ∑ËæìÂÖ•Áî®Êà∑Âêç" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">ÂØÜÁ†Å</label>
                        <input type="password" id="regPassword" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Á°ÆËÆ§ÂØÜÁ†Å</label>
                        <input type="password" id="confirmPassword" placeholder="ËØ∑ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å" required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">ÈÇÆÁÆ±ÔºàÂèØÈÄâÔºâ</label>
                        <input type="email" id="regEmail" placeholder="ËØ∑ËæìÂÖ•ÈÇÆÁÆ±">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Ê≥®ÂÜå</button>
                        <button type="button" class="btn btn-secondary" onclick="Settings.showLoginModal()">ËøîÂõûÁôªÂΩï</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ÈòøÈáå‰∫ëÂè∑Á†ÅËÆ§ËØÅ H5 SDK - ‰ΩøÁî®ÂÆòÊñπCDN -->
    <script type="text/javascript" charset="utf-8" src="https://g.alicdn.com/dingding/h5-phone-number-verification/1.0.0/numberAuth-web-sdk.js" 
            onload="console.log('ÈòøÈáå‰∫ëSDKÂä†ËΩΩÊàêÂäüÔºåPhoneNumberServer:', typeof PhoneNumberServer)" 
            onerror="console.log('ÈòøÈáå‰∫ëSDKÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØïÂ§áÁî®ÈìæÊé•')"></script>
    
    <!-- Â§áÁî®SDKÈìæÊé• - ‰ΩøÁî®‰∏çÂêåÁöÑCDN -->
    <script type="text/javascript" charset="utf-8" src="https://g.alicdn.com/dingding/h5-phone-number-verification/latest/numberAuth-web-sdk.js" 
            onload="console.log('Â§áÁî®SDKÂä†ËΩΩÊàêÂäüÔºåPhoneNumberServer:', typeof PhoneNumberServer)" 
            onerror="console.log('Â§áÁî®SDK‰πüÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®Ê®°ÊãüÊ®°Âºè')"></script>
    
    <!-- Â¶ÇÊûúSDKÂä†ËΩΩÂ§±Ë¥•ÔºåÊèê‰æõÊ®°ÊãüÂÆûÁé∞ -->
    <script>
        // Â¶ÇÊûúSDKÂä†ËΩΩÂ§±Ë¥•ÔºåÊèê‰æõÊ®°ÊãüÂÆûÁé∞
        if (typeof PhoneNumberServer === 'undefined') {
            console.log('SDKÂä†ËΩΩÂ§±Ë¥•ÔºåÂàõÂª∫Ê®°ÊãüPhoneNumberServer');
            window.PhoneNumberServer = function() {
                this.checkLoginAvailable = function(options) {
                    console.log('Ê®°ÊãücheckLoginAvailableË¢´Ë∞ÉÁî®');
                    if (options.success) {
                        options.success({ code: 600000, message: 'Ê®°ÊãüÈâ¥ÊùÉÊàêÂäü' });
                    }
                };
                this.getLoginToken = function(options) {
                    console.log('Ê®°ÊãügetLoginTokenË¢´Ë∞ÉÁî®');
                    if (options.success) {
                        options.success({ spToken: 'mock_sp_token_' + Date.now() });
                    }
                };
            };
            console.log('Ê®°ÊãüPhoneNumberServerÂ∑≤ÂàõÂª∫');
        }
    </script>
    
    <script>
        // ========== ÈòøÈáå‰∫ëÂè∑Á†ÅËÆ§ËØÅÈÖçÁΩÆ ==========
        const ALIYUN_CONFIG = {
            sceneCode: 'FC220000012450005', // ÊÇ®ÁöÑÊñπÊ°à Code
            // Áîü‰∫ßÊ®°ÂºèÔºöÂêØÁî®ÁúüÂÆûÁöÑÈòøÈáå‰∫ëÂè∑Á†ÅËÆ§ËØÅ
            isDevelopment: false
        };
        
        // ========== È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑSDKÊ£ÄÊü• ==========
        window.addEventListener('load', function() {
            console.log('È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÊ£ÄÊü•SDKÁä∂ÊÄÅ...');
            console.log('PhoneNumberServer:', typeof PhoneNumberServer);
            console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
            
            // Âª∂ËøüÊ£ÄÊü•ÔºåÁ°Æ‰øùSDKÊúâÊó∂Èó¥Âä†ËΩΩ
            setTimeout(function() {
                console.log('Âª∂ËøüÊ£ÄÊü•SDKÁä∂ÊÄÅ...');
                console.log('PhoneNumberServer:', typeof PhoneNumberServer);
                console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
            }, 2000);
        });
        
        // ========== ‰ºöÂëòÊùÉÈôêÊ£ÄÊü•Á≥ªÁªü ==========
        function checkMembershipStatus() {
            // ‰ªé‰ºöÂëòÁ≥ªÁªüËé∑ÂèñÁä∂ÊÄÅ
            return Membership && Membership.isMember ? Membership.isMember() : false;
        }
        
        function updateMembershipBadge() {
            const badge = document.getElementById('membershipStatusBadge');
            if (checkMembershipStatus()) {
                badge.style.display = 'inline-block';
                badge.textContent = 'üëë ‰ºöÂëò';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function showMembershipUpgradePrompt(featureName) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    text-align: center;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 48px; margin-bottom: 16px;">üîí</div>
                    <h3 style="margin: 0 0 8px 0; color: #2c3e50;">${featureName}</h3>
                    <p style="margin: 0 0 24px 0; color: #7f8c8d;">Ê≠§ÂäüËÉΩ‰∏∫‰ºöÂëò‰∏ì‰∫´ÔºåÁ´ãÂç≥ÂºÄÈÄö‰∫´ÂèóÊõ¥Â§öÁâπÊùÉÔºÅ</p>
                    <button class="membership-upgrade-btn" onclick="Membership.showPurchaseModal(); this.closest('.modal')?.remove();">
                        Á´ãÂç≥ÂºÄÈÄö‰ºöÂëò
                    </button>
                    <button onclick="this.closest('.modal')?.remove();" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        margin-left: 12px;
                        cursor: pointer;
                    ">ÂèñÊ∂à</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function createMembershipOverlay(featureName) {
            const overlay = document.createElement('div');
            overlay.className = 'membership-overlay';
            overlay.innerHTML = `
                <div class="membership-lock-icon">üîí</div>
                <div class="membership-lock-title">${featureName}</div>
                <div class="membership-lock-desc">Ê≠§ÂäüËÉΩ‰∏∫‰ºöÂëò‰∏ì‰∫´<br>Á´ãÂç≥ÂºÄÈÄö‰∫´ÂèóÊõ¥Â§öÁâπÊùÉÔºÅ</div>
                <button class="membership-upgrade-btn" onclick="Membership.showPurchaseModal()">
                    Á´ãÂç≥ÂºÄÈÄö‰ºöÂëò
                </button>
            `;
            return overlay;
        }
        
        // ========== ÂêÑÊ®°Âùó‰ºöÂëòÈôêÂà∂ÂàùÂßãÂåñÂáΩÊï∞ ==========
        function initProductManagerRestrictions() {
            const container = document.getElementById('productManager').querySelector('.container');
            if (!checkMembershipStatus()) {
                // Â¶ÇÊûúÂ∑≤ÁªèÊúâÈÅÆÁΩ©Â±ÇÔºåÂÖàÁßªÈô§
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
                
                // Ê∑ªÂä†ÈÅÆÁΩ©Â±Ç
                const overlay = createMembershipOverlay('‰∫ßÂìÅÁÆ°ÁêÜ');
                container.appendChild(overlay);
            } else {
                // ‰ºöÂëòÁî®Êà∑ÔºåÁßªÈô§ÈÅÆÁΩ©Â±Ç
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
            }
        }
        
        function initPriceAdjusterRestrictions() {
            const container = document.getElementById('priceAdjuster').querySelector('.container');
            
            // ‰ª∑Ê†ºÂèñÊï¥ÈÄâÈ°πÈôêÂà∂
            const priceRoundingSelect = document.getElementById('pa_priceRounding');
            const priceRoundingLabel = priceRoundingSelect.previousElementSibling;
            
            // Ë∞É‰ª∑Ê®°ÂºèÈÄâÈ°πÈôêÂà∂
            const pricingModeSelect = document.getElementById('pa_pricingMode');
            const pricingModeLabel = pricingModeSelect.previousElementSibling;
            
            if (!checkMembershipStatus()) {
                // Èùû‰ºöÂëòÔºöÁ¶ÅÁî®È´òÁ∫ßÈÄâÈ°π
                priceRoundingSelect.disabled = true;
                priceRoundingLabel.classList.add('membership-restricted');
                
                // ÈöêËóèÂå∫Èó¥Ë∞É‰ª∑ÈÄâÈ°π
                const rangeOption = pricingModeSelect.querySelector('option[value="range"]');
                if (rangeOption) {
                    rangeOption.style.display = 'none';
                }
                pricingModeSelect.value = 'uniform';
                pricingModeSelect.disabled = true;
                pricingModeLabel.classList.add('membership-restricted');
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÊòæÁ§∫ÂçáÁ∫ßÊèêÁ§∫
                priceRoundingSelect.addEventListener('click', function() {
                    if (this.disabled) {
                        showMembershipUpgradePrompt('‰ª∑Ê†ºÂèñÊï¥ÂäüËÉΩ');
                    }
                });
                
                pricingModeSelect.addEventListener('click', function() {
                    if (this.disabled) {
                        showMembershipUpgradePrompt('Âå∫Èó¥Ë∞É‰ª∑ÂäüËÉΩ');
                    }
                });
            } else {
                // ‰ºöÂëòÔºöÂêØÁî®ÊâÄÊúâÈÄâÈ°π
                priceRoundingSelect.disabled = false;
                priceRoundingLabel.classList.remove('membership-restricted');
                
                const rangeOption = pricingModeSelect.querySelector('option[value="range"]');
                if (rangeOption) {
                    rangeOption.style.display = 'block';
                }
                pricingModeSelect.disabled = false;
                pricingModeLabel.classList.remove('membership-restricted');
            }
        }
        
        function initSymbolChangerRestrictions() {
            const container = document.getElementById('symbolChanger').querySelector('.container');
            if (!checkMembershipStatus()) {
                // Â¶ÇÊûúÂ∑≤ÁªèÊúâÈÅÆÁΩ©Â±ÇÔºåÂÖàÁßªÈô§
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
                
                // Ê∑ªÂä†ÈÅÆÁΩ©Â±Ç
                const overlay = createMembershipOverlay('Á¨¶Âè∑Êõ¥Êç¢');
                container.appendChild(overlay);
            } else {
                // ‰ºöÂëòÁî®Êà∑ÔºåÁßªÈô§ÈÅÆÁΩ©Â±Ç
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
            }
        }

        // ========== TabÂàáÊç¢ÈÄªËæë ==========
        document.addEventListener('DOMContentLoaded', function() {
            const tabItems = document.querySelectorAll('.tab-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Ê£ÄÊü•‰ºöÂëòÊùÉÈôê
                    if (targetTab === 'productManager' || targetTab === 'symbolChanger') {
                        if (!checkMembershipStatus()) {
                            showMembershipUpgradePrompt(targetTab === 'productManager' ? '‰∫ßÂìÅÁÆ°ÁêÜ' : 'Á¨¶Âè∑Êõ¥Êç¢');
                            return;
                        }
                    }
                    
                    // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
                    tabItems.forEach(tab => tab.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Ê∑ªÂä†activeÁ±ªÂà∞ÂΩìÂâçÈ°π
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // ÂàùÂßãÂåñÂØπÂ∫îÊ®°ÂùóÁöÑ‰ºöÂëòÈôêÂà∂
                    if (targetTab === 'productManager') {
                        initProductManagerRestrictions();
                    } else if (targetTab === 'priceAdjuster') {
                        initPriceAdjusterRestrictions();
                    } else if (targetTab === 'symbolChanger') {
                        initSymbolChangerRestrictions();
                    }
                });
            });
            
            // ÂàùÂßãÂåñÂêÑ‰∏™ÁïåÈù¢
            ProductManager.init();
            PriceAdjuster.init();
            SymbolChanger.init();
            
            // ÂàùÂßãÂåñ‰ª∑Ê†ºË∞ÉÊï¥ÁöÑ‰ºöÂëòÈôêÂà∂ÔºàÂõ†‰∏∫ÈªòËÆ§ÊòæÁ§∫‰ª∑Ê†ºË∞ÉÊï¥ÁïåÈù¢Ôºâ
            initPriceAdjusterRestrictions();
            
            // Êõ¥Êñ∞‰ºöÂëòÁä∂ÊÄÅÂæΩÁ´†
            updateMembershipBadge();
        });
        
        // ========== ÁïåÈù¢1Ôºö‰∫ßÂìÅÁÆ°ÁêÜ JavaScript ==========
        const ProductManager = (function() {
            let parsedItems = [];
            let batchDeleteMode = false;
            
            function init() {
                const parseBtn = document.getElementById('pm_parseBtn');
                const batchDeleteBtn = document.getElementById('pm_batchDeleteBtn');
                const deleteSelectedBtn = document.getElementById('pm_deleteSelectedBtn');
                const cancelDeleteBtn = document.getElementById('pm_cancelDeleteBtn');
                const copyBtn = document.getElementById('pm_copyBtn');
                const sortSelect = document.getElementById('pm_sortSelect');
                const inputText = document.getElementById('pm_inputText');
                
                parseBtn.addEventListener('click', parseText);
                batchDeleteBtn.addEventListener('click', enterBatchDeleteMode);
                deleteSelectedBtn.addEventListener('click', deleteSelectedItems);
                cancelDeleteBtn.addEventListener('click', exitBatchDeleteMode);
                copyBtn.addEventListener('click', copyResults);
                sortSelect.addEventListener('change', sortAndDisplayItems);
                inputText.addEventListener('keydown', handleEnterKey);
            }
            
            function handleEnterKey(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    parseText();
                }
            }
            
            function parseText() {
                const text = document.getElementById('pm_inputText').value.trim();
                if (!text) return;
                
                const lines = text.split('\n');
                parsedItems = [];
                
                lines.forEach((line, index) => {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) return;
                    
                    const result = parseProducts(trimmedLine);
                    
                    if (result && result.hasPrice && result.prices && result.prices.length > 0) {
                        // Êúâ‰ª∑Ê†ºÁöÑ‰∫ßÂìÅ
                        parsedItems.push({
                            id: index,
                            originalLine: trimmedLine,
                            name: result.content || 'Êú™Áü•‰∫ßÂìÅ',
                            price: result.prices[0].price,
                            hasPrice: true,
                            selected: false
                        });
                    } else {
                        // Êó†‰ª∑Ê†ºÁöÑË°å
                        parsedItems.push({
                            id: index,
                            originalLine: trimmedLine,
                            name: trimmedLine,
                            price: null,
                            hasPrice: false,
                            selected: false
                        });
                    }
                });
                
                updateStats();
                sortAndDisplayItems();
            }
            
            function parseProducts(line) {
                // ‰ΩøÁî®‰ª∑Ê†ºË∞ÉÊï¥ÁïåÈù¢ÁöÑÈ´òÁ≤æÂ∫¶ÁÆóÊ≥ï
                return purePriceParse(line);
            }
            
            // Á∫Ø‰ª∑Ê†ºËß£Êûê - È´òÂáÜÁ°ÆÁéáÁâàÊú¨Ôºà‰ªé‰ª∑Ê†ºË∞ÉÊï¥ÁïåÈù¢Â§çÂà∂Ôºâ
            function purePriceParse(line) {
                // Ë∑≥ËøáÊòéÊòæÁöÑÈùû‰∫ßÂìÅË°å
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text',
                        debug: { method: 'non-product' }
                    };
                }
                
                // ÂØªÊâæÊâÄÊúâ‰ª∑Ê†º
                let allPrices = [];
                
                // Á¨¨‰∏ÄÊ≠•ÔºöÂØªÊâæÊòéÁ°ÆÁöÑ‰ª∑Ê†ºÊ†áËØÜ
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                // Á¨¨‰∫åÊ≠•ÔºöÂØªÊâæ‰∏ä‰∏ãÊñá‰ª∑Ê†º
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                // ÂéªÈáçÂπ∂ÊéíÂ∫è
                allPrices = removeDuplicatePrices(allPrices);
                
                // Âè™ÈÄâÊã©ÊúÄÈù†ÂêéÁöÑ‰∏Ä‰∏™‰ª∑Ê†º
                if (allPrices.length > 0) {
                    // Êåâ‰ΩçÁΩÆÊéíÂ∫èÔºåÈÄâÊã©ÊúÄÈù†ÂêéÁöÑ
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]]; // Âè™ÂèñÊúÄÈù†ÂêéÁöÑ‰∏Ä‰∏™
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product',
                        debug: { method: 'single-price', count: 1 }
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text',
                    debug: { method: 'no-price' }
                };
            }
            
            // Èùû‰∫ßÂìÅË°åËøáÊª§ÂáΩÊï∞Ôºà‰ªé‰ª∑Ê†ºË∞ÉÊï¥ÁïåÈù¢Â§çÂà∂Ôºâ
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^‚Äî‚Äî‚Äî‚Äî+$/, 
                    /^\[Á∫¢ÂåÖ\].*\[Á∫¢ÂåÖ\]$/,
                    /^[\s\-_=]+$/,
                    /Âπ≥Âè∞Áé∞Êü•|‰ª∑Ê†ºÂèØËÉΩ‰ºöÊ≥¢Âä®/,
                    /ÂÖ®ÂõΩÂåÖÈÇÆ|Ê∑±Âú≥|Ê≤≥Ê∫ê|ÊÉ†Â∑û/,
                    /Áé∞Ë¥ßÁßíÂèë|ÂÖ∂‰ªñÊú∫ÂûãËØ¢‰ª∑/,
                    /Êõ¥Â§öÂÖ∂‰ªñÂìÅÁâåÂûãÂè∑/,
                    /Â§áÊ≥®Ôºö|‰ª•‰∏äÂá†Ê¨æ|‰ª•ÂÆûÈôÖÂºÄÂçï‰∏∫ÂáÜ/,
                    /^\.+$/,
                    /^[‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅ]+„ÄÅ/,
                    /ÊàëÂè∏‰∫ßÂìÅÂèØÂºÄÁ•®/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                
                // Ë¥ßÂ∏ÅÁ¨¶Âè∑‰ª∑Ê†º
                let currencyPattern = /[¬•$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                // Â∏¶Âçï‰ΩçÁöÑ‰ª∑Ê†º
                let unitPattern = /(\d+(?:\.\d+)?)\s*(ÂÖÉ|Âùó|Âè∞|Â§ö|Ëµ∑|Èôê|Áâπ)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // Â∏¶Ë°®ÊÉÖÁ¨¶Âè∑ÁöÑ‰ª∑Ê†ºËØÜÂà´Â∑≤ÁßªÈô§ÔºåÈÅøÂÖç6XXX‰ª∑Ê†ºËØÜÂà´ÈîôËØØ
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                
                // ‰ªéÂêéÂæÄÂâçÂØªÊâæ‰ª∑Ê†º - ‰ºòÂÖàËØÜÂà´Ë°åÊú´ÁöÑ‰ª∑Ê†º
                const numbers = line.match(/\d{3,}/g);
                if (!numbers) return prices;
                
                // ‰øÆÂ§ç‰ΩçÁΩÆËÆ°ÁÆóÔºö‰ΩøÁî®Ê≠£ÂàôÁöÑmatch.indexÁ≤æÁ°ÆÂÆö‰ΩçÔºåÈÅøÂÖçlastIndexOfÊ≠ß‰πâ
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                // Êåâ‰ΩçÁΩÆ‰ªéÂêéÂæÄÂâçÊéíÂ∫è
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) { // ÈôêÂà∂Âú®199-99999‰πãÈó¥
                        // Ê£ÄÊü•‰∏ä‰∏ãÊñáÔºà‰ΩçÁΩÆÂõ†Á¥†Â∑≤Âú®getPriceContext‰∏≠ËÄÉËôëÔºâ
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        
                        // ‰ΩøÁî®getPriceContextËøîÂõûÁöÑÁΩÆ‰ø°Â∫¶
                        let confidence = context.confidence;
                        
                        // Ê£ÄÊü•ÊòØÂê¶Âú®ÊñúÊù†ÂêéÔºàÈÄöÂ∏∏ÊòØ‰ª∑Ê†ºÔºâ
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2; // ÊñúÊù†ÂêéÈÄöÂ∏∏ÊòØ‰ª∑Ê†º
                        }
                        
                        // Ê£ÄÊü•ÊòØÂê¶Âú®Êã¨Âè∑ÂâçÔºàÈÄöÂ∏∏ÊòØ‰ª∑Ê†ºÔºâ
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1; // Êã¨Âè∑ÂâçÂèØËÉΩÊòØ‰ª∑Ê†º
                        }
                        
                        if (confidence >= 0.3) { // ÊèêÈ´òÈòàÂÄºËá≥0.3ÔºåÈÅøÂÖçËØØËØÜÂà´ÂûãÂè∑‰∏≠ÁöÑÊï∞Â≠ó
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'ÂâçÂêéÂ≠óÊØçÂµåÂÖ• ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'ÂêéÈù¢Â≠óÊØç ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'ÂâçÈù¢Â≠óÊØç ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Ê®™Êù† ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Âä†Âè∑ ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'ÂâçÈù¢Âä†Âè∑ ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'ÂâçÈù¢Ê®™Êù† ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'ÊúâÂàÜÈöîÁ¨¶ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'ÊúâÁ©∫Ê†º ';
                }
                
                if (before.match(/(Âê´Á•®|‰ª∑Ê†º|Êä•‰ª∑|Ôø•|\$)/)) {
                    confidence += 0.4;
                    context += 'Êúâ‰ª∑Ê†ºÂÖ≥ÈîÆËØç ';
                }
                
                if (after.match(/^(ÂÖÉ|Âùó|ÂåÖÈÇÆ|Ëµ∑|\()/)) {
                    confidence += 0.3;
                    context += 'Êúâ‰ª∑Ê†ºÂçï‰Ωç ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'Ë°åÊú´ ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'Êé•ËøëË°åÊú´ ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'Êã¨Âè∑ÂÜÖ ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function processPrices(line, prices) {
                if (!prices || prices.length === 0) return null;
                
                const uniquePrices = removeDuplicatePrices(prices);
                
                let productName = line;
                uniquePrices.forEach(priceInfo => {
                    const priceStr = priceInfo.price.toString();
                    
                    if (priceInfo.method === 'currency') {
                        productName = productName.replace(new RegExp(`[¬•Ôø•]\\s*${priceStr}`, 'g'), '').trim();
                    } else if (priceInfo.method === 'unit') {
                        productName = productName.replace(new RegExp(`${priceStr}\\s*(ÂÖÉ|Âùó|Âè∞|Â§ö|Ëµ∑|Èôê|Áâπ)`, 'g'), '').trim();
                    } else {
                        productName = productName.replace(new RegExp(`(?<!\\w)${priceStr}(?!\\w)`, 'g'), '').trim();
                    }
                });
                
                return uniquePrices.map(priceInfo => {
                    return {
                        name: productName,
                        price: priceInfo.price
                    };
                });
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function updateStats() {
                const total = parsedItems.length;
                const priceLines = parsedItems.filter(item => item.hasPrice).length;
                const textLines = total - priceLines;
                
                document.getElementById('pm_totalLines').textContent = total;
                document.getElementById('pm_priceLines').textContent = priceLines;
                document.getElementById('pm_textLines').textContent = textLines;
            }
            
            function enterBatchDeleteMode() {
                batchDeleteMode = true;
                document.getElementById('pm_batchDeleteBtn').style.display = 'none';
                document.getElementById('pm_deleteSelectedBtn').style.display = 'inline-block';
                document.getElementById('pm_cancelDeleteBtn').style.display = 'inline-block';
                document.getElementById('pm_copyBtn').disabled = true;
                document.getElementById('pm_parseBtn').disabled = true;
                document.getElementById('pm_sortSelect').disabled = true;
                
                displayItems(parsedItems);
            }
            
            function exitBatchDeleteMode() {
                batchDeleteMode = false;
                document.getElementById('pm_batchDeleteBtn').style.display = 'inline-block';
                document.getElementById('pm_deleteSelectedBtn').style.display = 'none';
                document.getElementById('pm_cancelDeleteBtn').style.display = 'none';
                document.getElementById('pm_copyBtn').disabled = false;
                document.getElementById('pm_parseBtn').disabled = false;
                document.getElementById('pm_sortSelect').disabled = false;
                
                parsedItems.forEach(item => {
                    item.selected = false;
                });
                
                displayItems(parsedItems);
            }
            
            function deleteSelectedItems() {
                const remainingItems = parsedItems.filter(item => !item.selected);
                
                if (remainingItems.length === parsedItems.length) {
                    alert('ËØ∑ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑÈ°πÁõÆ');
                    return;
                }
                
                parsedItems = remainingItems;
                updateStats();
                exitBatchDeleteMode();
                sortAndDisplayItems();
            }
            
            function sortAndDisplayItems() {
                const sortMethod = document.getElementById('pm_sortSelect').value;
                let sortedItems = [...parsedItems];
                
                switch (sortMethod) {
                    case 'priceAsc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return a.price - b.price;
                            return 0;
                        });
                        break;
                    case 'priceDesc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return b.price - a.price;
                            return 0;
                        });
                        break;
                    case 'nameAsc':
                        sortedItems.sort((a, b) => {
                            return a.name.localeCompare(b.name, 'zh-CN');
                        });
                        break;
                    default:
                        break;
                }
                
                displayItems(sortedItems);
            }
            
            function displayItems(items) {
                const resultsContainer = document.getElementById('pm_resultsContainer');
                resultsContainer.innerHTML = '';
                
                resultsContainer.style.overflowY = 'auto';
                resultsContainer.style.maxHeight = '60vh';
                
                items.forEach((item, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = `result-item ${item.selected ? 'selected' : ''}`;
                    resultItem.dataset.index = index;
                    
                    // Â§çÈÄâÊ°Ü
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = `checkbox ${batchDeleteMode ? '' : 'hidden'}`;
                    checkbox.checked = item.selected;
                    checkbox.addEventListener('change', (e) => {
                        parsedItems.forEach(pItem => {
                            if (pItem.originalLine === item.originalLine) {
                                pItem.selected = e.target.checked;
                            }
                        });
                        resultItem.classList.toggle('selected', e.target.checked);
                    });
                    
                    // ÊãñÊãΩÊâãÊüÑ
                    const dragHandle = document.createElement('div');
                    dragHandle.className = 'drag-handle';
                    dragHandle.innerHTML = '‚â°';
                    dragHandle.title = 'ÊãñÊãΩÁßªÂä®';
                    
                    // ÁßªÂä®ÊåâÈíÆ
                    const moveButtons = document.createElement('div');
                    moveButtons.className = 'move-buttons';
                    
                    const moveUpBtn = document.createElement('button');
                    moveUpBtn.className = 'move-btn';
                    moveUpBtn.innerHTML = '‚Üë';
                    moveUpBtn.title = 'Âêë‰∏äÁßªÂä®';
                    moveUpBtn.disabled = index === 0;
                    moveUpBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        moveItemUp(index);
                    });
                    
                    const moveDownBtn = document.createElement('button');
                    moveDownBtn.className = 'move-btn';
                    moveDownBtn.innerHTML = '‚Üì';
                    moveDownBtn.title = 'Âêë‰∏ãÁßªÂä®';
                    moveDownBtn.disabled = index === items.length - 1;
                    moveDownBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        moveItemDown(index);
                    });
                    
                    moveButtons.appendChild(moveUpBtn);
                    moveButtons.appendChild(moveDownBtn);
                    
                    // ÂÜÖÂÆπÂå∫Âüü
                    const itemContent = document.createElement('div');
                    itemContent.className = 'item-content';
                    
                    const itemText = document.createElement('div');
                    itemText.className = 'item-text';
                    itemText.style.cursor = 'pointer';
                    itemText.style.padding = '8px';
                    itemText.style.borderRadius = '4px';
                    itemText.style.transition = 'background-color 0.2s';
                    
                    // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
                    itemText.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = '#f0f8ff';
                    });
                    itemText.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'transparent';
                    });
                    
                    // Ê∑ªÂä†ÁÇπÂáªÁºñËæëÂäüËÉΩ
                    itemText.addEventListener('click', function() {
                        editItemContent(item, index, this);
                    });
                    
                    const priceDisplayDiv = document.createElement('div');
                    priceDisplayDiv.className = 'price-display';
                    
                    if (item.hasPrice) {
                        itemText.textContent = item.originalLine;
                        
                        const bluePriceSpan = document.createElement('span');
                        bluePriceSpan.className = 'blue-price';
                        bluePriceSpan.textContent = `¬•${item.price}`;
                        priceDisplayDiv.appendChild(bluePriceSpan);
                    } else {
                        itemText.textContent = item.name;
                        
                        const noPriceSpan = document.createElement('span');
                        noPriceSpan.className = 'no-price';
                        noPriceSpan.textContent = 'Êó†‰ª∑Ê†º';
                        priceDisplayDiv.appendChild(noPriceSpan);
                    }
                    
                    itemContent.appendChild(itemText);
                    itemContent.appendChild(priceDisplayDiv);
                    
                    // ÁªÑË£ÖÂÖÉÁ¥†
                    resultItem.appendChild(checkbox);
                    resultItem.appendChild(dragHandle);
                    resultItem.appendChild(itemContent);
                    resultItem.appendChild(moveButtons);
                    
                    // ÊãñÊãΩÂäüËÉΩ
                    setupDragAndDrop(resultItem, index);
                    
                    // ÊâπÈáèÂà†Èô§Ê®°Âºè
                    if (batchDeleteMode) {
                        resultItem.addEventListener('click', (e) => {
                            if (e.target !== checkbox && !e.target.closest('.price-display') && 
                                !e.target.closest('.move-buttons') && !e.target.closest('.drag-handle')) {
                                checkbox.checked = !checkbox.checked;
                                const event = new Event('change');
                                checkbox.dispatchEvent(event);
                            }
                        });
                    }
                    
                    resultsContainer.appendChild(resultItem);
                });
            }
            
            // ========== ÂàóË°®È°πÁßªÂä®ÂäüËÉΩ ==========
            function moveItemUp(index) {
                if (index === 0) return;
                
                // ‰∫§Êç¢Êï∞ÁªÑÂÖÉÁ¥†
                [parsedItems[index], parsedItems[index - 1]] = [parsedItems[index - 1], parsedItems[index]];
                
                // ÈáçÊñ∞ÊòæÁ§∫ÂàóË°®
                sortAndDisplayItems();
            }
            
            function moveItemDown(index) {
                if (index === parsedItems.length - 1) return;
                
                // ‰∫§Êç¢Êï∞ÁªÑÂÖÉÁ¥†
                [parsedItems[index], parsedItems[index + 1]] = [parsedItems[index + 1], parsedItems[index]];
                
                // ÈáçÊñ∞ÊòæÁ§∫ÂàóË°®
                sortAndDisplayItems();
            }
            
            function setupDragAndDrop(element, index) {
                const dragHandle = element.querySelector('.drag-handle');
                let draggedElement = null;
                let draggedIndex = null;
                let isDragging = false;
                let lastScrollTime = 0;
                let scrollInterval = null;
                let hasScrolled = false;
                let touchCount = 0;
                let isMultiTouch = false;
                
                // ÂºÄÂßãÊãñÊãΩ
                const startDrag = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Ê£ÄÊµãËß¶Êë∏ÁÇπÊï∞Èáè
                    if (e.type === 'touchstart') {
                        touchCount = e.touches.length;
                        isMultiTouch = touchCount > 1;
                        console.log('Ëß¶Êë∏ÂºÄÂßãÔºåËß¶Êë∏ÁÇπÊï∞Èáè:', touchCount);
                    } else {
                        touchCount = 1;
                        isMultiTouch = false;
                    }
                    
                    draggedElement = element;
                    draggedIndex = index;
                    element.classList.add('dragging');
                    isDragging = true;
                    hasScrolled = false;
                    
                    console.log('ÂºÄÂßãÊãñÊãΩ:', index, 'Â§öÊåáÊ®°Âºè:', isMultiTouch);
                    
                    // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨
                    document.addEventListener('mousemove', handleMove);
                    document.addEventListener('mouseup', handleEnd);
                    document.addEventListener('touchmove', handleTouchMove, { passive: false });
                    document.addEventListener('touchend', handleTouchEnd);
                    document.addEventListener('touchcancel', handleTouchEnd);
                    
                    // Ê∑ªÂä†ÊªöÂä®ÁõëÂê¨
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    resultsContainer.addEventListener('scroll', handleScroll, { passive: true });
                    
                    // ÂºÄÂßãÊ£ÄÊµã
                    startDetection();
                };
                
                // Ëß¶Êë∏ÁßªÂä®Â§ÑÁêÜ
                function handleTouchMove(e) {
                    if (!isDragging) return;
                    
                    // Êõ¥Êñ∞Ëß¶Êë∏ÁÇπÊï∞Èáè
                    touchCount = e.touches.length;
                    isMultiTouch = touchCount > 1;
                    
                    console.log('Ëß¶Êë∏ÁßªÂä®ÔºåËß¶Êë∏ÁÇπÊï∞Èáè:', touchCount, 'Â§öÊåáÊ®°Âºè:', isMultiTouch);
                    
                    // ÂçïÊåáÊ®°ÂºèÔºöÊ≠£Â∏∏ÊãñÊãΩ
                    if (!isMultiTouch) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const clientX = e.touches[0].clientX;
                        const clientY = e.touches[0].clientY;
                        
                        // Ê£ÄÊµãÁõÆÊ†áÂÖÉÁ¥†
                        const elementBelow = document.elementFromPoint(clientX, clientY);
                        const resultItem = elementBelow?.closest('.result-item');
                        
                        if (resultItem && resultItem !== draggedElement) {
                            // Ê∏ÖÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ
                            document.querySelectorAll('.result-item').forEach(item => {
                                item.classList.remove('drag-over');
                            });
                            
                            // È´ò‰∫ÆÁõÆÊ†áÂÖÉÁ¥†
                            resultItem.classList.add('drag-over');
                        }
                    }
                    // Â§öÊåáÊ®°ÂºèÔºöÂÖÅËÆ∏ÊªöÂä®Ôºå‰∏çÈòªÊ≠¢ÈªòËÆ§Ë°å‰∏∫
                }
                
                // Èº†Ê†áÁßªÂä®Â§ÑÁêÜ
                function handleMove(e) {
                    if (!isDragging) return;
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const clientX = e.clientX;
                    const clientY = e.clientY;
                    
                    // Ê£ÄÊµãÁõÆÊ†áÂÖÉÁ¥†
                    const elementBelow = document.elementFromPoint(clientX, clientY);
                    const resultItem = elementBelow?.closest('.result-item');
                    
                    if (resultItem && resultItem !== draggedElement) {
                        // Ê∏ÖÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ
                        document.querySelectorAll('.result-item').forEach(item => {
                            item.classList.remove('drag-over');
                        });
                        
                        // È´ò‰∫ÆÁõÆÊ†áÂÖÉÁ¥†
                        resultItem.classList.add('drag-over');
                    }
                }
                
                // ÊªöÂä®Â§ÑÁêÜ
                function handleScroll(e) {
                    if (!isDragging) return;
                    
                    lastScrollTime = Date.now();
                    hasScrolled = true;
                    
                    console.log('Ê£ÄÊµãÂà∞ÊªöÂä®');
                    
                    // Ê£ÄÊµãÂ±èÂπï‰∏≠ÂøÉÁöÑÁõÆÊ†áÂÖÉÁ¥†
                    updateTarget();
                }
                
                // Êõ¥Êñ∞ÁõÆÊ†á
                function updateTarget() {
                    if (!isDragging) return;
                    
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    const containerRect = resultsContainer.getBoundingClientRect();
                    const centerX = containerRect.left + containerRect.width / 2;
                    const centerY = containerRect.top + containerRect.height / 2;
                    
                    const elementBelow = document.elementFromPoint(centerX, centerY);
                    const resultItem = elementBelow?.closest('.result-item');
                    
                    if (resultItem && resultItem !== draggedElement) {
                        // Ê∏ÖÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ
                        document.querySelectorAll('.result-item').forEach(item => {
                            item.classList.remove('drag-over');
                        });
                        
                        // È´ò‰∫ÆÁõÆÊ†áÂÖÉÁ¥†
                        resultItem.classList.add('drag-over');
                    }
                }
                
                // ÂºÄÂßãÊ£ÄÊµã
                function startDetection() {
                    if (scrollInterval) clearInterval(scrollInterval);
                    
                    scrollInterval = setInterval(() => {
                        if (!isDragging) {
                            clearInterval(scrollInterval);
                            return;
                        }
                        
                        // Â¶ÇÊûúÊ≠£Âú®ÊªöÂä®ÔºåÊõ¥Êñ∞ÁõÆÊ†á
                        if (hasScrolled && Date.now() - lastScrollTime < 200) {
                            updateTarget();
                        }
                        
                        // Â¶ÇÊûúÂÅúÊ≠¢ÊªöÂä®Ë∂ÖËøá1ÁßíÔºåÊ£ÄÊü•ÊúÄÁªà‰ΩçÁΩÆ
                        if (Date.now() - lastScrollTime > 1000 && hasScrolled) {
                            checkFinal();
                        }
                    }, 100);
                }
                
                // Ê£ÄÊü•ÊúÄÁªà‰ΩçÁΩÆ
                function checkFinal() {
                    if (!isDragging) return;
                    
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    const containerRect = resultsContainer.getBoundingClientRect();
                    const centerX = containerRect.left + containerRect.width / 2;
                    const centerY = containerRect.top + containerRect.height / 2;
                    
                    const elementBelow = document.elementFromPoint(centerX, centerY);
                    const targetElement = elementBelow?.closest('.result-item');
                    
                    if (targetElement && targetElement !== draggedElement) {
                        const targetIndex = parseInt(targetElement.dataset.index);
                        
                        if (targetIndex !== draggedIndex) {
                            // ÁßªÂä®ÂÖÉÁ¥†
                            const item = parsedItems.splice(draggedIndex, 1)[0];
                            parsedItems.splice(targetIndex, 0, item);
                            
                            // ÈáçÊñ∞ÊòæÁ§∫
                            sortAndDisplayItems();
                        }
                    }
                }
                
                // Ëß¶Êë∏ÁªìÊùüÂ§ÑÁêÜ
                function handleTouchEnd(e) {
                    if (!isDragging) return;
                    
                    // Êõ¥Êñ∞Ëß¶Êë∏ÁÇπÊï∞Èáè
                    touchCount = e.touches.length;
                    isMultiTouch = touchCount > 1;
                    
                    console.log('Ëß¶Êë∏ÁªìÊùüÔºåÂâ©‰ΩôËß¶Êë∏ÁÇπÊï∞Èáè:', touchCount);
                    
                    // Âè™ÊúâÂΩìÊâÄÊúâËß¶Êë∏ÁÇπÈÉΩÁ¶ªÂºÄÊó∂ÊâçÁªìÊùüÊãñÊãΩ
                    if (touchCount === 0) {
                        handleEnd(e);
                    }
                }
                
                // ÁªìÊùüÊãñÊãΩ
                function handleEnd(e) {
                    if (!isDragging) return;
                    
                    console.log('ÁªìÊùüÊãñÊãΩ');
                    
                    // Â¶ÇÊûúÊªöÂä®ËøáÔºåÊ£ÄÊü•ÊúÄÁªà‰ΩçÁΩÆ
                    if (hasScrolled) {
                        checkFinal();
                    }
                    
                    // Ê∏ÖÁêÜ
                    cleanup();
                }
                
                // Ê∏ÖÁêÜ
                function cleanup() {
                    // ÁßªÈô§È´ò‰∫Æ
                    document.querySelectorAll('.result-item').forEach(item => {
                        item.classList.remove('dragging', 'drag-over');
                    });
                    
                    // ÈáçÁΩÆÁä∂ÊÄÅ
                    draggedElement = null;
                    draggedIndex = null;
                    isDragging = false;
                    hasScrolled = false;
                    touchCount = 0;
                    isMultiTouch = false;
                    
                    // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨
                    document.removeEventListener('mousemove', handleMove);
                    document.removeEventListener('mouseup', handleEnd);
                    document.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                    document.removeEventListener('touchcancel', handleTouchEnd);
                    
                    // ÁßªÈô§ÊªöÂä®ÁõëÂê¨
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    resultsContainer.removeEventListener('scroll', handleScroll);
                    
                    // Ê∏ÖÁêÜÂÆöÊó∂Âô®
                    if (scrollInterval) {
                        clearInterval(scrollInterval);
                        scrollInterval = null;
                    }
                }
                
                // ÁªëÂÆö‰∫ã‰ª∂
                dragHandle.addEventListener('mousedown', startDrag);
                dragHandle.addEventListener('touchstart', startDrag, { passive: false });
                
                // Èò≤Ê≠¢ÈªòËÆ§Ë°å‰∏∫
                dragHandle.addEventListener('dragstart', (e) => {
                    e.preventDefault();
                });
            }
            
            function copyResults() {
                // Ëé∑ÂèñÂΩìÂâçÊéíÂ∫èÂêéÁöÑÊï∞ÊçÆÔºåËÄå‰∏çÊòØÂéüÂßãÊï∞ÊçÆ
                const sortMethod = document.getElementById('pm_sortSelect').value;
                let sortedItems = [...parsedItems];
                
                // Â∫îÁî®‰∏éÊòæÁ§∫Êó∂Áõ∏ÂêåÁöÑÊéíÂ∫èÈÄªËæë
                switch (sortMethod) {
                    case 'priceAsc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return a.price - b.price;
                            return 0;
                        });
                        break;
                    case 'priceDesc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return b.price - a.price;
                            return 0;
                        });
                        break;
                    case 'nameAsc':
                        sortedItems.sort((a, b) => {
                            return a.name.localeCompare(b.name, 'zh-CN');
                        });
                        break;
                    default:
                        // ÂéüÂßãÈ°∫Â∫èÔºå‰∏çÈúÄË¶ÅÊéíÂ∫è
                        break;
                }
                
                const resultText = sortedItems.map(item => item.originalLine).join('\n');
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(resultText)
                        .then(() => {
                            showCopySuccess();
                        })
                        .catch(err => {
                            fallbackCopy(resultText);
                        });
                } else {
                    fallbackCopy(resultText);
                }
            }
            
            function showCopySuccess() {
                const copySuccess = document.getElementById('pm_copySuccess');
                copySuccess.classList.add('show');
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    console.error('Â§çÂà∂Â§±Ë¥•: ', err);
                } finally {
                    document.body.removeChild(textArea);
                }
            }
            
            // ÁºñËæëÈ°πÁõÆÂÜÖÂÆπÂäüËÉΩ
            function editItemContent(item, index, contentElement) {
                // ÂàõÂª∫ÁºñËæëÊ®°ÊÄÅÊ°Ü
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    padding: 20px;
                `;
                
                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    border-radius: 12px;
                    padding: 20px;
                    width: 100%;
                    max-width: 500px;
                    max-height: 80vh;
                    overflow-y: auto;
                `;
                
                const title = document.createElement('h3');
                title.textContent = 'ÁºñËæëÂÜÖÂÆπ';
                title.style.cssText = `
                    margin: 0 0 15px 0;
                    color: #333;
                    font-size: 18px;
                `;
                
                const textarea = document.createElement('textarea');
                textarea.value = item.originalLine;
                textarea.style.cssText = `
                    width: 100%;
                    min-height: 120px;
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                    box-sizing: border-box;
                `;
                textarea.focus();
                textarea.select();
                
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = `
                    display: flex;
                    gap: 10px;
                    margin-top: 15px;
                    justify-content: flex-end;
                `;
                
                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'ÂèñÊ∂à';
                cancelBtn.style.cssText = `
                    padding: 10px 20px;
                    background: #95a5a6;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                const saveBtn = document.createElement('button');
                saveBtn.textContent = '‰øùÂ≠ò';
                saveBtn.style.cssText = `
                    padding: 10px 20px;
                    background: #3498db;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                // ‰∫ã‰ª∂Â§ÑÁêÜ
                const closeModal = () => {
                    document.body.removeChild(modal);
                };
                
                cancelBtn.addEventListener('click', closeModal);
                
                saveBtn.addEventListener('click', () => {
                    const newContent = textarea.value.trim();
                    if (newContent && newContent !== item.originalLine) {
                        // Êõ¥Êñ∞ÂéüÂßãÊï∞ÊçÆ
                        item.originalLine = newContent;
                        item.name = newContent;
                        
                        // ÈáçÊñ∞Ëß£Êûê‰ª∑Ê†º
                        const result = parseProducts(newContent);
                        if (result && result.hasPrice && result.prices && result.prices.length > 0) {
                            item.hasPrice = true;
                            item.price = result.prices[0].price;
                        } else {
                            item.hasPrice = false;
                            item.price = null;
                        }
                        
                        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
                        updateStats();
                        
                        // ÈáçÊñ∞ÊòæÁ§∫ÂàóË°®
                        sortAndDisplayItems();
                        
                        // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
                        showEditSuccess();
                    }
                    closeModal();
                });
                
                // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
                
                // ESCÈîÆÂÖ≥Èó≠
                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleKeyDown);
                    }
                };
                document.addEventListener('keydown', handleKeyDown);
                
                // ÁªÑË£ÖÊ®°ÊÄÅÊ°Ü
                buttonContainer.appendChild(cancelBtn);
                buttonContainer.appendChild(saveBtn);
                modalContent.appendChild(title);
                modalContent.appendChild(textarea);
                modalContent.appendChild(buttonContainer);
                modal.appendChild(modalContent);
                
                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                document.body.appendChild(modal);
            }
            
            // ÊòæÁ§∫ÁºñËæëÊàêÂäüÊèêÁ§∫
            function showEditSuccess() {
                const toast = document.createElement('div');
                toast.textContent = '‚úì ÂÜÖÂÆπÂ∑≤Êõ¥Êñ∞';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            return {
                init: init
            };
        })();
        
        // ========== ÁïåÈù¢2Ôºö‰ª∑Ê†ºË∞ÉÊï¥ JavaScript ==========
        const PriceAdjuster = (function() {
            let parsedData = [];
            let isPricingApplied = false;
            
            function init() {
                // ÂàùÂßãÂåñÂÆåÊàê
            }
            
            function parseProducts() {
                const input = document.getElementById('pa_productInput').value.trim();
                if (!input) {
                    alert('ËØ∑ËæìÂÖ•‰∫ßÂìÅ‰ø°ÊÅØ');
                    return;
                }
                
                const lines = input.split('\n').filter(line => line.trim());
                parsedData = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const result = purePriceParse(line);
                    parsedData.push(result);
                }
                
                displayResults();
                updateStats();
            }
            
            function purePriceParse(line) {
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text',
                        debug: { method: 'non-product' }
                    };
                }
                
                let allPrices = [];
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                allPrices = removeDuplicatePrices(allPrices);
                
                if (allPrices.length > 0) {
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]];
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product',
                        debug: { method: 'single-price', count: 1 }
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text',
                    debug: { method: 'no-price' }
                };
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                let currencyPattern = /[¬•$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                let unitPattern = /(\d+(?:\.\d+)?)\s*(ÂÖÉ|Âùó|Âè∞|Â§ö|Ëµ∑|Èôê|Áâπ)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // Â∏¶Ë°®ÊÉÖÁ¨¶Âè∑ÁöÑ‰ª∑Ê†ºËØÜÂà´Â∑≤ÁßªÈô§ÔºåÈÅøÂÖç6XXX‰ª∑Ê†ºËØÜÂà´ÈîôËØØ
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) {
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        let confidence = context.confidence;
                        
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2;
                        }
                        
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1;
                        }
                        
                        if (confidence >= 0.3) {
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'ÂâçÂêéÂ≠óÊØçÂµåÂÖ• ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'ÂêéÈù¢Â≠óÊØç ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'ÂâçÈù¢Â≠óÊØç ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Ê®™Êù† ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Âä†Âè∑ ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'ÂâçÈù¢Âä†Âè∑ ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'ÂâçÈù¢Ê®™Êù† ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'ÊúâÂàÜÈöîÁ¨¶ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'ÊúâÁ©∫Ê†º ';
                }
                
                if (before.match(/(Âê´Á•®|‰ª∑Ê†º|Êä•‰ª∑|Ôø•|\$)/)) {
                    confidence += 0.4;
                    context += 'Êúâ‰ª∑Ê†ºÂÖ≥ÈîÆËØç ';
                }
                
                if (after.match(/^(ÂÖÉ|Âùó|ÂåÖÈÇÆ|Ëµ∑|\()/)) {
                    confidence += 0.3;
                    context += 'Êúâ‰ª∑Ê†ºÂçï‰Ωç ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'Ë°åÊú´ ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'Êé•ËøëË°åÊú´ ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'Êã¨Âè∑ÂÜÖ ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function applyPricing() {
                if (parsedData.length === 0) {
                    alert('ËØ∑ÂÖàËß£Êûê‰∫ßÂìÅ');
                    return;
                }
                
                const pricingType = document.getElementById('pa_pricingType').value;
                const pricingMode = document.getElementById('pa_pricingMode').value;
                const pricingDirection = document.getElementById('pa_pricingDirection').value;
                const priceRounding = document.getElementById('pa_priceRounding').value;
                
                // Âè™ÊúâÂú®Áªü‰∏ÄË∞É‰ª∑Ê®°Âºè‰∏ãÊâçÈúÄË¶ÅËé∑ÂèñÁªü‰∏ÄÁöÑË∞É‰ª∑ÂÄº
                let pricingValue = 0;
                if (pricingMode === 'uniform') {
                    pricingValue = parseFloat(document.getElementById('pa_pricingValue').value);
                }
                
                for (let item of parsedData) {
                    if (item.hasPrice && item.prices && item.prices.length > 0) {
                        item.newPrices = [];
                        
                        for (let priceInfo of item.prices) {
                            let newPrice = priceInfo.price;
                            let currentPricingValue = pricingValue;
                            
                            // Â¶ÇÊûúÊòØÂå∫Èó¥Ë∞É‰ª∑Ê®°ÂºèÔºåÊ†πÊçÆ‰ª∑Ê†ºÂå∫Èó¥Ëé∑ÂèñÂØπÂ∫îÁöÑË∞É‰ª∑ÁôæÂàÜÊØî
                            if (pricingMode === 'range') {
                                currentPricingValue = getPriceRangePercentage(priceInfo.price);
                            }
                            
                            if (pricingType === 'percentage') {
                                if (pricingDirection === 'increase') {
                                    newPrice = priceInfo.price * (1 + currentPricingValue / 100);
                                } else {
                                    newPrice = priceInfo.price * (1 - currentPricingValue / 100);
                                }
                            } else {
                                if (pricingDirection === 'increase') {
                                    newPrice = priceInfo.price + currentPricingValue;
                                } else {
                                    newPrice = priceInfo.price - currentPricingValue;
                                }
                            }
                            
                            newPrice = applyRounding(newPrice, priceRounding);
                            item.newPrices.push(newPrice);
                        }
                    }
                }
                
                isPricingApplied = true;
                displayResults();
            }
            
            function applyRounding(price, roundingType) {
                switch (roundingType) {
                    case 'ones':
                        return Math.round(price);
                    case 'tens':
                        return Math.round(price / 10) * 10;
                    case 'hundreds':
                        return Math.round(price / 100) * 100;
                    case 'none':
                    default:
                        return Math.round(price);
                }
            }
            
            // ÂàáÊç¢Ë∞É‰ª∑Ê®°ÂºèÊòæÁ§∫
            function togglePricingMode() {
                const mode = document.getElementById('pa_pricingMode').value;
                const rangeSection = document.getElementById('pa_rangePricingSection');
                
                if (mode === 'range') {
                    rangeSection.style.display = 'block';
                } else {
                    rangeSection.style.display = 'none';
                }
            }
            
            // Ê†πÊçÆ‰ª∑Ê†ºËé∑ÂèñÂØπÂ∫îÁöÑÂå∫Èó¥Ë∞É‰ª∑ÁôæÂàÜÊØî
            function getPriceRangePercentage(price) {
                // Ëé∑ÂèñÂêÑÂå∫Èó¥ÁöÑË∞É‰ª∑ÁôæÂàÜÊØî
                const range0_999 = parseFloat(document.getElementById('pa_range0_999').value);
                const range1000_1999 = parseFloat(document.getElementById('pa_range1000_1999').value);
                const range2000_4999 = parseFloat(document.getElementById('pa_range2000_4999').value);
                const range5000_9999 = parseFloat(document.getElementById('pa_range5000_9999').value);
                const range10000_plus = parseFloat(document.getElementById('pa_range10000_plus').value);
                
                // Ê†πÊçÆ‰ª∑Ê†ºÂå∫Èó¥ËøîÂõûÂØπÂ∫îÁöÑÁôæÂàÜÊØî
                if (price >= 0 && price <= 999) {
                    return range0_999;
                } else if (price >= 1000 && price <= 1999) {
                    return range1000_1999;
                } else if (price >= 2000 && price <= 4999) {
                    return range2000_4999;
                } else if (price >= 5000 && price <= 9999) {
                    return range5000_9999;
                } else if (price >= 10000) {
                    return range10000_plus;
                }
                return 0; // ÈªòËÆ§ÂÄº
            }
            
            function displayResults() {
                const resultArea = document.getElementById('pa_resultArea');
                resultArea.innerHTML = '';
                
                for (let item of parsedData) {
                    const itemDiv = document.createElement('div');
                    let itemClass = 'result-item';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        itemClass += ' has-price';
                    } else {
                        itemClass += ' no-price';
                    }
                    
                    itemDiv.className = itemClass;
                    
                    let content = item.content;
                    let priceDisplay = '';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        if (isPricingApplied && item.newPrices) {
                            priceDisplay = item.prices.map((priceInfo, index) => {
                                const newPrice = item.newPrices[index] || priceInfo.price;
                                return `
                                    <span class="result-price original">¬•${priceInfo.price}</span>
                                    <span class="result-price new">¬•${newPrice}</span>
                                `;
                            }).join(' ');
                        } else {
                            priceDisplay = item.prices.map(priceInfo => 
                                `<span class="result-price">¬•${priceInfo.price}</span>`
                            ).join(' ');
                        }
                    } else {
                        priceDisplay = '<span style="color: #999; font-size: 3vw;">Êó†‰ª∑Ê†º</span>';
                    }
                    
                    itemDiv.innerHTML = `
                        <div class="result-content">${content}</div>
                        <div class="result-price">${priceDisplay}</div>
                    `;
                    
                    resultArea.appendChild(itemDiv);
                }
            }
            
            function updateStats() {
                const totalLines = parsedData.length;
                const priceLines = parsedData.filter(item => item.hasPrice).length;
                const textLines = parsedData.filter(item => !item.hasPrice).length;
                
                document.getElementById('pa_totalLines').textContent = totalLines;
                document.getElementById('pa_priceLines').textContent = priceLines;
                document.getElementById('pa_textLines').textContent = textLines;
            }
            
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^‚Äî‚Äî‚Äî‚Äî+$/, 
                    /^\[Á∫¢ÂåÖ\].*\[Á∫¢ÂåÖ\]$/,
                    /^[\s\-_=]+$/,
                    /Âπ≥Âè∞Áé∞Êü•|‰ª∑Ê†ºÂèØËÉΩ‰ºöÊ≥¢Âä®/,
                    /ÂÖ®ÂõΩÂåÖÈÇÆ|Ê∑±Âú≥|Ê≤≥Ê∫ê|ÊÉ†Â∑û/,
                    /Áé∞Ë¥ßÁßíÂèë|ÂÖ∂‰ªñÊú∫ÂûãËØ¢‰ª∑/,
                    /Êõ¥Â§öÂÖ∂‰ªñÂìÅÁâåÂûãÂè∑/,
                    /Â§áÊ≥®Ôºö|‰ª•‰∏äÂá†Ê¨æ|‰ª•ÂÆûÈôÖÂºÄÂçï‰∏∫ÂáÜ/,
                    /^\.+$/,
                    /^[‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅ]+„ÄÅ/,
                    /ÊàëÂè∏‰∫ßÂìÅÂèØÂºÄÁ•®/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function copyResults() {
                if (parsedData.length === 0) {
                    alert('ËØ∑ÂÖàËß£Êûê‰∫ßÂìÅ');
                    return;
                }
                
                let output = [];
                
                for (let item of parsedData) {
                    if (item.hasPrice && item.prices.length > 0) {
                        let content = item.original;
                        let newPrice = item.newPrices && item.newPrices[0] 
                            ? item.newPrices[0] 
                            : item.prices[0].price;
                        
                        content = replacePriceInOriginal(content, item.prices[0], newPrice);
                        output.push(content);
                    } else {
                        output.push(item.original);
                    }
                }
                
                const textToCopy = output.join('\n');
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    fallbackCopy(textToCopy);
                });
            }
            
            function replacePriceInOriginal(content, priceInfo, newPrice) {
                const oldPriceStr = priceInfo.price.toString();
                const position = priceInfo.position;
                const newPriceStr = newPrice.toString();
                
                let start = position;
                let end = position + oldPriceStr.length;
                
                const actualNumber = content.substring(start, end);
                if (actualNumber !== oldPriceStr) {
                    const priceRegex = new RegExp('\\b' + oldPriceStr + '\\b');
                    const match = content.match(priceRegex);
                    if (match) {
                        start = content.indexOf(match[0]);
                        end = start + match[0].length;
                    } else {
                        return content;
                    }
                }
                
                const beforePrice = content.substring(0, start);
                const afterPrice = content.substring(end);
                const result = beforePrice + newPriceStr + afterPrice;
                
                return result;
            }
            
            function showCopySuccess() {
                const toast = document.createElement('div');
                toast.textContent = '‚úì Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                }
                
                document.body.removeChild(textarea);
            }
            
            return {
                init: init,
                parseProducts: parseProducts,
                applyPricing: applyPricing,
                copyResults: copyResults,
                togglePricingMode: togglePricingMode
            };
        })();
        
        // ========== ÁïåÈù¢3ÔºöÁ¨¶Âè∑Êõ¥Êç¢ JavaScript ==========
        const SymbolChanger = (function() {
            let parsedData = [];
            let currentPriceSeparator = '¬•';
            let enableFooter = false;
            let footerText = '';
            
            function init() {
                // Âä†ËΩΩ‰øùÂ≠òÁöÑËÆæÁΩÆ
                loadSettings();
                
                // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
                document.getElementById('sc_enableFooter').addEventListener('change', function() {
                    enableFooter = this.checked;
                    saveSettings();
                    if (parsedData.length > 0) {
                        displayResults();
                    }
                });
                
                document.getElementById('sc_footerText').addEventListener('input', function() {
                    footerText = this.value;
                    saveSettings();
                });
            }
            
            function loadSettings() {
                // ‰ªélocalStorageÂä†ËΩΩËÆæÁΩÆ
                const savedEnableFooter = localStorage.getItem('symbolChanger_enableFooter');
                const savedFooterText = localStorage.getItem('symbolChanger_footerText');
                
                if (savedEnableFooter !== null) {
                    enableFooter = savedEnableFooter === 'true';
                    document.getElementById('sc_enableFooter').checked = enableFooter;
                }
                
                if (savedFooterText !== null) {
                    footerText = savedFooterText;
                    document.getElementById('sc_footerText').value = footerText;
                } else {
                    // ËÆæÁΩÆÈªòËÆ§ÂÄº
                    footerText = 'Âπ≥Âè∞Áé∞Êü•Ôºå‰ª∑Ê†ºÂèØËÉΩ‰ºöÊúâÊ≥¢Âä®ÔºåÊÑüË∞¢ÁêÜËß£ÔºÅÈÉ®ÂàÜ‰∫ßÂìÅÁßÅËÅäËØ¢‰ª∑‰∏ãÂçïÔºåÊúüÂæÖÂêà‰Ωú[Êè°Êâã]';
                    document.getElementById('sc_footerText').value = footerText;
                }
            }
            
            function saveSettings() {
                // ‰øùÂ≠òËÆæÁΩÆÂà∞localStorage
                localStorage.setItem('symbolChanger_enableFooter', enableFooter.toString());
                localStorage.setItem('symbolChanger_footerText', footerText);
            }
            
            function parseProducts() {
                const input = document.getElementById('sc_productInput').value.trim();
                if (!input) {
                    alert('ËØ∑ËæìÂÖ•‰∫ßÂìÅ‰ø°ÊÅØ');
                    return;
                }
                
                const lines = input.split('\n').filter(line => line.trim());
                parsedData = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const result = purePriceParse(line);
                    parsedData.push(result);
                }
                
                displayResults();
                updateStats();
            }
            
            function purePriceParse(line) {
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text'
                    };
                }
                
                let allPrices = [];
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                allPrices = removeDuplicatePrices(allPrices);
                
                if (allPrices.length > 0) {
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]];
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product'
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text'
                };
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                let currencyPattern = /[¬•$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                let unitPattern = /(\d+(?:\.\d+)?)\s*(ÂÖÉ|Âùó|Âè∞|Â§ö|Ëµ∑|Èôê|Áâπ)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // Â∏¶Ë°®ÊÉÖÁ¨¶Âè∑ÁöÑ‰ª∑Ê†ºËØÜÂà´Â∑≤ÁßªÈô§ÔºåÈÅøÂÖç6XXX‰ª∑Ê†ºËØÜÂà´ÈîôËØØ
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) {
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        let confidence = context.confidence;
                        
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2;
                        }
                        
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1;
                        }
                        
                        if (confidence >= 0.3) {
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'ÂâçÂêéÂ≠óÊØçÂµåÂÖ• ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'ÂêéÈù¢Â≠óÊØç ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'ÂâçÈù¢Â≠óÊØç ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Ê®™Êù† ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'ÂêéÈù¢Âä†Âè∑ ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'ÂâçÈù¢Âä†Âè∑ ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'ÂâçÈù¢Ê®™Êù† ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'ÊúâÂàÜÈöîÁ¨¶ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'ÊúâÁ©∫Ê†º ';
                }
                
                if (before.match(/(Âê´Á•®|‰ª∑Ê†º|Êä•‰ª∑|Ôø•|\$)/)) {
                    confidence += 0.4;
                    context += 'Êúâ‰ª∑Ê†ºÂÖ≥ÈîÆËØç ';
                }
                
                if (after.match(/^(ÂÖÉ|Âùó|ÂåÖÈÇÆ|Ëµ∑|\()/)) {
                    confidence += 0.3;
                    context += 'Êúâ‰ª∑Ê†ºÂçï‰Ωç ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'Ë°åÊú´ ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'Êé•ËøëË°åÊú´ ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'Êã¨Âè∑ÂÜÖ ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function applyPriceSeparator() {
                const replaceSymbol = document.getElementById('sc_priceSeparator').value;
                currentPriceSeparator = replaceSymbol || '¬•';
                redisplayResultsWithSeparator();
                
                const toast = document.createElement('div');
                toast.textContent = '‚úì ‰ª∑Ê†ºÁ¨¶Âè∑Â∑≤Êõ¥Êñ∞';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function redisplayResultsWithSeparator() {
                const resultItems = document.querySelectorAll('#symbolChanger .result-item');
                
                parsedData.forEach((item, index) => {
                    if (index < resultItems.length && item.hasPrice && item.prices.length > 0) {
                        const priceElement = resultItems[index].querySelector('.result-price');
                        if (priceElement) {
                            priceElement.textContent = currentPriceSeparator + item.prices[0].price;
                        }
                    }
                });
            }
            
            function displayResults() {
                const resultArea = document.getElementById('sc_resultArea');
                resultArea.innerHTML = '';
                
                updateStats();
                
                for (let item of parsedData) {
                    const itemDiv = document.createElement('div');
                    let itemClass = 'result-item';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        itemClass += ' has-price';
                    } else {
                        itemClass += ' no-price';
                    }
                    
                    itemDiv.className = itemClass;
                    
                    let content = item.content;
                    
                    const originalText = document.createElement('div');
                    originalText.className = 'result-content';
                    originalText.textContent = content;
                    
                    const priceDisplay = document.createElement('div');
                    priceDisplay.className = 'result-price';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        priceDisplay.textContent = currentPriceSeparator + item.prices[0].price;
                    } else {
                        priceDisplay.textContent = '';
                    }
                    
                    itemDiv.appendChild(originalText);
                    itemDiv.appendChild(priceDisplay);
                    resultArea.appendChild(itemDiv);
                }
                
                // Âú®ÊúÄÂêéÊ∑ªÂä†ÁªìÂ∞æËØ¥ÊòéÔºàÂè™Ê∑ªÂä†‰∏ÄÊ¨°Ôºâ
                if (enableFooter && footerText.trim()) {
                    const footerDiv = document.createElement('div');
                    footerDiv.className = 'result-item';
                    footerDiv.style.background = '#f0f8ff';
                    footerDiv.style.border = '2px solid #2196F3';
                    footerDiv.style.fontStyle = 'italic';
                    footerDiv.style.color = '#666';
                    footerDiv.style.textAlign = 'center';
                    footerDiv.style.padding = '2vw';
                    footerDiv.style.marginTop = '2vw';
                    
                    const footerTextDiv = document.createElement('div');
                    footerTextDiv.className = 'result-content';
                    footerTextDiv.textContent = footerText.trim();
                    footerTextDiv.style.width = '100%';
                    footerTextDiv.style.textAlign = 'center';
                    
                    footerDiv.appendChild(footerTextDiv);
                    resultArea.appendChild(footerDiv);
                }
            }
            
            function updateStats() {
                const totalLines = parsedData.length;
                const priceLines = parsedData.filter(item => item.hasPrice).length;
                const textLines = parsedData.filter(item => !item.hasPrice).length;
                
                document.getElementById('sc_totalLines').textContent = totalLines;
                document.getElementById('sc_priceLines').textContent = priceLines;
                document.getElementById('sc_textLines').textContent = textLines;
            }
            
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^‚Äî‚Äî‚Äî‚Äî+$/, 
                    /^\[Á∫¢ÂåÖ\].*\[Á∫¢ÂåÖ\]$/,
                    /^[\s\-_=]+$/,
                    /Âπ≥Âè∞Áé∞Êü•|‰ª∑Ê†ºÂèØËÉΩ‰ºöÊ≥¢Âä®/,
                    /ÂÖ®ÂõΩÂåÖÈÇÆ|Ê∑±Âú≥|Ê≤≥Ê∫ê|ÊÉ†Â∑û/,
                    /Áé∞Ë¥ßÁßíÂèë|ÂÖ∂‰ªñÊú∫ÂûãËØ¢‰ª∑/,
                    /Êõ¥Â§öÂÖ∂‰ªñÂìÅÁâåÂûãÂè∑/,
                    /Â§áÊ≥®Ôºö|‰ª•‰∏äÂá†Ê¨æ|‰ª•ÂÆûÈôÖÂºÄÂçï‰∏∫ÂáÜ/,
                    /^\.+$/,
                    /^[‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅ]+„ÄÅ/,
                    /ÊàëÂè∏‰∫ßÂìÅÂèØÂºÄÁ•®/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function copyResults() {
                if (parsedData.length === 0) {
                    alert('ËØ∑ÂÖàËß£Êûê‰∫ßÂìÅ');
                    return;
                }
                
                const replaceSymbol = document.getElementById('sc_priceSeparator').value;
                
                let output = [];
                
                for (let item of parsedData) {
                    let lineToAdd = '';
                    
                    if (item.hasPrice && item.prices.length > 0 && replaceSymbol !== '') {
                        const originalLine = item.original;
                        const priceInfo = item.prices[0];
                        const priceValue = priceInfo.price;
                        const priceStr = priceValue.toString();
                        
                        lineToAdd = replacePriceSeparator(originalLine, priceStr, replaceSymbol);
                    } else {
                        lineToAdd = item.original;
                    }
                    
                    output.push(lineToAdd);
                }
                
                // Âú®ÊúÄÂêéÊ∑ªÂä†ÁªìÂ∞æËØ¥ÊòéÔºàÂè™Ê∑ªÂä†‰∏ÄÊ¨°Ôºâ
                let textToCopy = output.join('\n');
                if (enableFooter && footerText.trim()) {
                    textToCopy += '\n' + footerText.trim();
                }
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    fallbackCopy(textToCopy);
                });
            }
            
            function replacePriceSeparator(line, priceStr, replaceSymbol) {
                const priceIndex = line.lastIndexOf(priceStr);
                
                if (priceIndex > 0) {
                    let endIndex = priceIndex; // ‰ª∑Ê†ºÂºÄÂßã‰ΩçÁΩÆ
                    let startIndex = priceIndex;
                    
                    // Á¨¨‰∏ÄÊ≠•ÔºöÂêëÂâçÂà†Èô§ÊâÄÊúâÁ©∫Ê†ºÔºàÂ§ÑÁêÜ [ÊñáÂ≠ó] ÂêéÁöÑÁ©∫Ê†ºÔºâ
                    while (startIndex > 0 && /\s/.test(line[startIndex - 1])) {
                        startIndex--;
                    }
                    
                    // Á¨¨‰∫åÊ≠•ÔºöÊ£ÄÊü•ÊòØÂê¶Êúâ [ÊñáÂ≠ó] Ê†ºÂºè
                    if (startIndex > 0 && line[startIndex - 1] === ']') {
                        // ÂêëÂâçÊü•ÊâæÂåπÈÖçÁöÑ '['
                        let bracketStart = -1;
                        for (let i = startIndex - 2; i >= 0; i--) {
                            if (line[i] === '[') {
                                bracketStart = i;
                                break;
                            }
                        }
                        
                        if (bracketStart >= 0) {
                            startIndex = bracketStart;
                        }
                    } else {
                        // Á¨¨‰∏âÊ≠•ÔºöÂ¶ÇÊûúÊ≤°ÊúâÊñπÊã¨Âè∑ÔºåÂà†Èô§‰ª∑Ê†ºÂâçÁöÑÁ¨¶Âè∑Ôºå‰ΩÜ‰øùÁïôÊã¨Âè∑
                        while (startIndex > 0) {
                            const char = line[startIndex - 1];
                            
                            // Â¶ÇÊûúÊòØÂ≠óÊØç„ÄÅÊï∞Â≠ó„ÄÅ‰∏≠ÊñáÔºåÂÅúÊ≠¢Âà†Èô§
                            if (/[A-Za-z0-9\u4e00-\u9fa5]/.test(char)) {
                                break;
                            }
                            
                            // Â¶ÇÊûúÊòØÊã¨Âè∑Ôºà‰∏≠ÊñáÊàñËã±ÊñáÔºâÔºåÂÅúÊ≠¢Âà†Èô§
                            if (char === ')' || char === 'Ôºâ') {
                                break;
                            }
                            
                            // Âà†Èô§ÂÖ∂‰ªñÁ¨¶Âè∑Ôºö‰ª∑Ê†ºÁ¨¶Âè∑„ÄÅemoji„ÄÅÊ†áÁÇπÁ¨¶Âè∑„ÄÅÊñúÊù†Á≠â
                            const isPriceSymbol = /[¬•$‚Ç¨¬£‚Çπüí∞Ôø•]/.test(char);
                            const isEmoji = char.codePointAt(0) > 0x1F300;
                            const isPunctuation = /[!@#$%^&*()_+=\[\]{}|;':",./<>?~`-]/.test(char);
                            const isSlash = char === '/';
                            
                            if (!isPriceSymbol && !isEmoji && !isPunctuation && !isSlash) {
                                break;
                            }
                            
                            startIndex--;
                        }
                    }
                    
                    const beforeSeparator = line.substring(0, startIndex);
                    const afterPrice = line.substring(priceIndex + priceStr.length);
                    return beforeSeparator + replaceSymbol + priceStr + afterPrice;
                }
                
                return line;
            }
            
            function showCopySuccess() {
                const toast = document.createElement('div');
                toast.textContent = '‚úì Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                }
                
                document.body.removeChild(textarea);
            }
            
            return {
                init: init,
                parseProducts: parseProducts,
                applyPriceSeparator: applyPriceSeparator,
                copyResults: copyResults
            };
        })();
        
        // ========== ‰ºöÂëòÁ≥ªÁªü JavaScript ==========
        const Membership = (function() {
            let membershipData = {
                isMember: false,
                expiryDate: null,
                packageType: null,
                referralCode: null,
                referredBy: null
            };
            
            // Â•óÈ§êÈÖçÁΩÆ
            const packages = {
                monthly: {
                    name: 'ÊúàÂ∫¶‰ºöÂëò',
                    price: 19,
                    originalPrice: 33,
                    days: 30,
                    isNewUser: true
                },
                halfyear: {
                    name: 'ÂçäÂπ¥‰ºöÂëò',
                    price: 99,
                    originalPrice: 198,
                    days: 120,
                    isNewUser: false
                },
                yearly: {
                    name: 'Âπ¥Â∫¶‰ºöÂëò',
                    price: 188,
                    originalPrice: 396,
                    days: 360,
                    isNewUser: false
                }
            };
            
            function init() {
                loadMembershipData();
                generateReferralCode();
                updateMembershipStatus();
                checkMembershipExpiry();
            }
            
            function loadMembershipData() {
                const saved = localStorage.getItem('membership_data');
                if (saved) {
                    membershipData = JSON.parse(saved);
                }
            }
            
            function saveMembershipData() {
                localStorage.setItem('membership_data', JSON.stringify(membershipData));
            }
            
            function generateReferralCode() {
                if (!membershipData.referralCode) {
                    // ÁîüÊàê8‰ΩçÊé®ËçêÁ†Å
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                    let result = '';
                    for (let i = 0; i < 8; i++) {
                        result += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    membershipData.referralCode = result;
                    saveMembershipData();
                }
                document.getElementById('myReferralCode').value = membershipData.referralCode;
            }
            
            function updateMembershipStatus() {
                const statusCard = document.getElementById('membershipStatusCard');
                const statusText = document.getElementById('membershipStatus');
                const expiryText = document.getElementById('membershipExpiry');
                
                if (membershipData.isMember && membershipData.expiryDate) {
                    const expiryDate = new Date(membershipData.expiryDate);
                    const now = new Date();
                    
                    if (expiryDate > now) {
                        statusText.textContent = `üëë ${packages[membershipData.packageType]?.name || '‰ºöÂëò'}`;
                        expiryText.textContent = `Âà∞ÊúüÊó∂Èó¥Ôºö${expiryDate.toLocaleDateString()}`;
                        statusCard.style.background = 'linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)';
                    } else {
                        // ‰ºöÂëòÂ∑≤ËøáÊúü
                        membershipData.isMember = false;
                        membershipData.expiryDate = null;
                        membershipData.packageType = null;
                        saveMembershipData();
                        showMembershipExpired();
                    }
                } else {
                    statusText.textContent = 'ÂÖçË¥πÁî®Êà∑';
                    expiryText.textContent = 'Á´ãÂç≥ÂºÄÈÄö‰ºöÂëòÔºå‰∫´ÂèóÊõ¥Â§öÂäüËÉΩ';
                    statusCard.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            }
            
            function showMembershipExpired() {
                const statusText = document.getElementById('membershipStatus');
                const expiryText = document.getElementById('membershipExpiry');
                statusText.textContent = '‰ºöÂëòÂ∑≤ËøáÊúü';
                expiryText.textContent = 'Áª≠Ë¥π‰ºöÂëòÔºåÁªßÁª≠‰∫´ÂèóÁâπÊùÉ';
            }
            
            function checkMembershipExpiry() {
                if (membershipData.isMember && membershipData.expiryDate) {
                    const expiryDate = new Date(membershipData.expiryDate);
                    const now = new Date();
                    const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysLeft <= 7 && daysLeft > 0) {
                        showExpiryWarning(daysLeft);
                    }
                }
            }
            
            function showExpiryWarning(daysLeft) {
                const message = `ÊÇ®ÁöÑ‰ºöÂëòÂ∞ÜÂú®${daysLeft}Â§©ÂêéÂà∞ÊúüÔºåËØ∑ÂèäÊó∂Áª≠Ë¥πÔºÅ`;
                if (confirm(message)) {
                    showPurchaseModal();
                }
            }
            
            function showPurchaseModal() {
                // 1. ÂàáÊç¢Âà∞‰ºöÂëòTab
                const tabItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                
                // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
                tabItems.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // ÊøÄÊ¥ª‰ºöÂëòTab
                const membershipTab = document.querySelector('[data-tab="membership"]');
                const membershipContent = document.getElementById('membership');
                if (membershipTab) membershipTab.classList.add('active');
                if (membershipContent) membershipContent.classList.add('active');
                
                // 2. ÊòæÁ§∫Ë¥≠‰π∞Â•óÈ§êÂå∫ÂüüÂπ∂ÊªöÂä®Âà∞ÈÇ£Èáå
                setTimeout(() => {
                    const packagesDiv = document.getElementById('membershipPackages');
                    if (packagesDiv) {
                        packagesDiv.style.display = 'block';
                        packagesDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100); // Áü≠ÊöÇÂª∂ËøüÁ°Æ‰øùTabÂàáÊç¢ÂÆåÊàê
            }
            
            function selectPackage(packageType) {
                const packageInfo = packages[packageType];
                if (!packageInfo) return;
                
                const confirmMessage = `Á°ÆËÆ§Ë¥≠‰π∞${packageInfo.name}Ôºü\n‰ª∑Ê†ºÔºö¬•${packageInfo.price}ÔºàÂéü‰ª∑¬•${packageInfo.originalPrice}Ôºâ\n‰ºöÂëòÂ§©Êï∞Ôºö${packageInfo.days}Â§©`;
                
                if (confirm(confirmMessage)) {
                    processPurchase(packageType);
                }
            }
            
            function processPurchase(packageType) {
                const packageInfo = packages[packageType];
                const now = new Date();
                const expiryDate = new Date(now.getTime() + packageInfo.days * 24 * 60 * 60 * 1000);
                
                // Êõ¥Êñ∞‰ºöÂëòÁä∂ÊÄÅ
                membershipData.isMember = true;
                membershipData.expiryDate = expiryDate.toISOString();
                membershipData.packageType = packageType;
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâÊé®Ëçê‰∫∫Â•ñÂä±
                if (membershipData.referredBy) {
                    addReferralReward(membershipData.referredBy, packageType);
                }
                
                saveMembershipData();
                updateMembershipStatus();
                
                // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                showSuccessMessage(`ÊÅ≠ÂñúÔºÅÊÇ®Â∑≤ÊàêÂäüÂºÄÈÄö${packageInfo.name}Ôºå‰∫´Âèó${packageInfo.days}Â§©‰ºöÂëòÊùÉÁõäÔºÅ`);
                
                // ÈöêËóèÂ•óÈ§êÈÄâÊã©
                document.getElementById('membershipPackages').style.display = 'none';
            }
            
            function addReferralReward(referrerCode, packageType) {
                // Êé®Ëçê‰∫∫Ëé∑Âæó20Â§©Â•ñÂä±
                const referrerData = JSON.parse(localStorage.getItem(`referrer_${referrerCode}`) || '{}');
                const currentExpiry = referrerData.expiryDate ? new Date(referrerData.expiryDate) : new Date();
                const newExpiry = new Date(currentExpiry.getTime() + 20 * 24 * 60 * 60 * 1000);
                referrerData.expiryDate = newExpiry.toISOString();
                referrerData.referralCount = (referrerData.referralCount || 0) + 1;
                localStorage.setItem(`referrer_${referrerCode}`, JSON.stringify(referrerData));
                
                // Â¶ÇÊûúÊòØÈ¶ñÊ¨°Ë¥≠‰π∞ÔºåÊé®Ëçê‰∫∫È¢ùÂ§ñËé∑Âæó40Â§©
                if (packageType !== 'monthly') {
                    const extraExpiry = new Date(newExpiry.getTime() + 40 * 24 * 60 * 60 * 1000);
                    referrerData.expiryDate = extraExpiry.toISOString();
                    localStorage.setItem(`referrer_${referrerCode}`, JSON.stringify(referrerData));
                }
            }
            
            function applyReferralCode() {
                const code = document.getElementById('referralCodeInput').value.trim();
                if (!code) {
                    alert('ËØ∑ËæìÂÖ•Êé®ËçêÁ†Å');
                    return;
                }
                
                if (code === membershipData.referralCode) {
                    alert('‰∏çËÉΩ‰ΩøÁî®Ëá™Â∑±ÁöÑÊé®ËçêÁ†Å');
                    return;
                }
                
                // Ê£ÄÊü•Êé®ËçêÁ†ÅÊòØÂê¶Â≠òÂú®
                const referrerData = JSON.parse(localStorage.getItem(`referrer_${code}`) || '{}');
                if (!referrerData.expiryDate || new Date(referrerData.expiryDate) <= new Date()) {
                    alert('Êé®ËçêÁ†ÅÊó†ÊïàÊàñÂ∑≤ËøáÊúü');
                    return;
                }
                
                // Â∫îÁî®Êé®ËçêÁ†Å
                membershipData.referredBy = code;
                saveMembershipData();
                
                // ÁªôÂèåÊñπÊ∑ªÂä†Â•ñÂä±Â§©Êï∞
                const now = new Date();
                
                // Ë¢´Êé®Ëçê‰∫∫Ëé∑Âæó7Â§©
                if (membershipData.isMember && membershipData.expiryDate) {
                    const currentExpiry = new Date(membershipData.expiryDate);
                    const newExpiry = new Date(Math.max(currentExpiry, now).getTime() + 7 * 24 * 60 * 60 * 1000);
                    membershipData.expiryDate = newExpiry.toISOString();
                } else {
                    const newExpiry = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                    membershipData.isMember = true;
                    membershipData.expiryDate = newExpiry.toISOString();
                    membershipData.packageType = 'referral';
                }
                
                // Êé®Ëçê‰∫∫Ëé∑Âæó20Â§©
                const referrerExpiry = new Date(referrerData.expiryDate);
                const referrerNewExpiry = new Date(referrerExpiry.getTime() + 20 * 24 * 60 * 60 * 1000);
                referrerData.expiryDate = referrerNewExpiry.toISOString();
                referrerData.referralCount = (referrerData.referralCount || 0) + 1;
                localStorage.setItem(`referrer_${code}`, JSON.stringify(referrerData));
                
                saveMembershipData();
                updateMembershipStatus();
                
                showSuccessMessage('Êé®ËçêÁ†Å‰ΩøÁî®ÊàêÂäüÔºÅÊÇ®Ëé∑Âæó‰∫Ü7Â§©‰ºöÂëòÊùÉÁõäÔºåÊé®Ëçê‰∫∫‰πüËé∑Âæó‰∫Ü20Â§©Â•ñÂä±ÔºÅ');
                document.getElementById('referralCodeInput').value = '';
            }
            
            function copyReferralCode() {
                const code = membershipData.referralCode;
                navigator.clipboard.writeText(code).then(() => {
                    showSuccessMessage('Êé®ËçêÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                }).catch(() => {
                    // ÈôçÁ∫ßÊñπÊ°à
                    const input = document.getElementById('myReferralCode');
                    input.select();
                    document.execCommand('copy');
                    showSuccessMessage('Êé®ËçêÁ†ÅÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                });
            }
            
            function showSuccessMessage(message) {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            function isMember() {
                return membershipData.isMember && 
                       membershipData.expiryDate && 
                       new Date(membershipData.expiryDate) > new Date();
            }
            
            function getMemberDaysLeft() {
                if (!isMember()) return 0;
                const expiryDate = new Date(membershipData.expiryDate);
                const now = new Date();
                return Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
            }
            
            return {
                init: init,
                isMember: isMember,
                getMemberDaysLeft: getMemberDaysLeft,
                showPurchaseModal: showPurchaseModal,
                selectPackage: selectPackage,
                applyReferralCode: applyReferralCode,
                copyReferralCode: copyReferralCode
            };
        })();
        
        // ========== ËÆæÁΩÆÁ≥ªÁªü JavaScript ==========
        const Settings = (function() {
            let userData = {
                isLoggedIn: false,
                username: null,
                email: null,
                loginTime: null
            };
            
            let settingsData = {
                theme: 'light',
                fontSize: 'medium',
                autoSave: true,
                priceHint: true,
                vibration: false
            };
            
            function init() {
                loadUserData();
                loadSettings();
                updateUserInfo();
                applySettings();
                bindEvents();
                checkLoginStatus(); // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            }
            
            function loadUserData() {
                const saved = localStorage.getItem('user_data');
                if (saved) {
                    userData = JSON.parse(saved);
                }
            }
            
            function saveUserData() {
                localStorage.setItem('user_data', JSON.stringify(userData));
            }
            
            function loadSettings() {
                const saved = localStorage.getItem('settings_data');
                if (saved) {
                    settingsData = JSON.parse(saved);
                }
                updateSettingsUI();
            }
            
            function saveSettings() {
                localStorage.setItem('settings_data', JSON.stringify(settingsData));
            }
            
            function updateSettingsUI() {
                document.getElementById('themeSelect').value = settingsData.theme;
                document.getElementById('fontSizeSelect').value = settingsData.fontSize;
                document.getElementById('autoSave').checked = settingsData.autoSave;
                document.getElementById('priceHint').checked = settingsData.priceHint;
                document.getElementById('vibration').checked = settingsData.vibration;
            }
            
            function updateUserInfo() {
                const userName = document.getElementById('userName');
                const userStatus = document.getElementById('userStatus');
                const loginBtn = document.getElementById('loginBtn');
                
                if (userData.isLoggedIn) {
                    userName.textContent = userData.username;
                    userStatus.textContent = `ÁôªÂΩïÊó∂Èó¥Ôºö${new Date(userData.loginTime).toLocaleString()}`;
                    loginBtn.textContent = 'ÈÄÄÂá∫';
                    loginBtn.onclick = logout;
                } else {
                    userName.textContent = 'Êú™ÁôªÂΩï';
                    userStatus.textContent = 'ÁÇπÂáªÁôªÂΩï‰∫´ÂèóÊõ¥Â§öÂäüËÉΩ';
                    loginBtn.textContent = 'ÁôªÂΩï';
                    loginBtn.onclick = showLoginModal;
                }
            }
            
            function bindEvents() {
                // ÁôªÂΩïË°®Âçï
                document.getElementById('loginForm').addEventListener('submit', handleLogin);
                
                // Ê≥®ÂÜåË°®Âçï
                document.getElementById('registerForm').addEventListener('submit', handleRegister);
                
                // Ê®°ÊÄÅÊ°ÜÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠
                window.addEventListener('click', function(event) {
                    const loginModal = document.getElementById('loginModal');
                    const registerModal = document.getElementById('registerModal');
                    const helpModal = document.getElementById('helpModal');
                    
                    if (event.target === loginModal) {
                        closeLoginModal();
                    }
                    if (event.target === registerModal) {
                        closeRegisterModal();
                    }
                    if (helpModal && event.target === helpModal) {
                        closeHelpModal();
                    }
                });
            }
            
            function showLoginModal() {
                document.getElementById('loginModal').style.display = 'block';
            }
            
            function closeLoginModal() {
                document.getElementById('loginModal').style.display = 'none';
            }
            
            function showRegisterModal() {
                closeLoginModal();
                document.getElementById('registerModal').style.display = 'block';
            }
            
            function closeRegisterModal() {
                document.getElementById('registerModal').style.display = 'none';
            }
            
            function handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                // ÁÆÄÂçïÁöÑÊ®°ÊãüÁôªÂΩïÈ™åËØÅ
                if (username && password) {
                    userData.isLoggedIn = true;
                    userData.username = username;
                    userData.loginTime = new Date().toISOString();
                    
                    if (rememberMe) {
                        saveUserData();
                    }
                    
                    updateUserInfo();
                    closeLoginModal();
                    showSuccessMessage('ÁôªÂΩïÊàêÂäüÔºÅ');
                    
                    // Ê∏ÖÁ©∫Ë°®Âçï
                    document.getElementById('loginForm').reset();
                } else {
                    alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÂíåÂØÜÁ†Å');
                }
            }
            
            function handleRegister(e) {
                e.preventDefault();
                const username = document.getElementById('regUsername').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const email = document.getElementById('regEmail').value;
                
                if (password !== confirmPassword) {
                    alert('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
                    return;
                }
                
                if (username && password) {
                    // Ê®°ÊãüÊ≥®ÂÜåÊàêÂäü
                    showSuccessMessage('Ê≥®ÂÜåÊàêÂäüÔºÅËØ∑ÁôªÂΩï');
                    closeRegisterModal();
                    showLoginModal();
                    
                    // Ê∏ÖÁ©∫Ë°®Âçï
                    document.getElementById('registerForm').reset();
                } else {
                    alert('ËØ∑Â°´ÂÜôÂøÖË¶Å‰ø°ÊÅØ');
                }
            }
            
            function logout() {
                userData.isLoggedIn = false;
                userData.username = null;
                userData.email = null;
                userData.loginTime = null;
                
                localStorage.removeItem('user_data');
                updateUserInfo();
                showSuccessMessage('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
            }
            
            function changeTheme() {
                const theme = document.getElementById('themeSelect').value;
                settingsData.theme = theme;
                saveSettings();
                applyTheme(theme);
            }
            
            function applyTheme(theme) {
                const body = document.body;
                body.className = body.className.replace(/theme-\w+/g, '');
                
                if (theme === 'dark') {
                    body.classList.add('theme-dark');
                } else if (theme === 'auto') {
                    // Ë∑üÈöèÁ≥ªÁªü‰∏ªÈ¢ò
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        body.classList.add('theme-dark');
                    }
                }
            }
            
            function changeFontSize() {
                const fontSize = document.getElementById('fontSizeSelect').value;
                settingsData.fontSize = fontSize;
                saveSettings();
                applyFontSize(fontSize);
            }
            
            function applyFontSize(size) {
                const body = document.body;
                body.className = body.className.replace(/font-\w+/g, '');
                body.classList.add(`font-${size}`);
            }
            
            function toggleAutoSave() {
                settingsData.autoSave = document.getElementById('autoSave').checked;
                saveSettings();
            }
            
            function togglePriceHint() {
                settingsData.priceHint = document.getElementById('priceHint').checked;
                saveSettings();
            }
            
            function toggleVibration() {
                settingsData.vibration = document.getElementById('vibration').checked;
                saveSettings();
            }
            
            function applySettings() {
                applyTheme(settingsData.theme);
                applyFontSize(settingsData.fontSize);
            }
            
            function exportData() {
                const allData = {
                    userData: userData,
                    settingsData: settingsData,
                    membershipData: JSON.parse(localStorage.getItem('membership_data') || '{}'),
                    productManagerData: JSON.parse(localStorage.getItem('productManager_data') || '{}'),
                    priceAdjusterData: JSON.parse(localStorage.getItem('priceAdjuster_data') || '{}'),
                    symbolChangerData: JSON.parse(localStorage.getItem('symbolChanger_data') || '{}')
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `ÂÆ∂ÁîµÊä•‰ª∑Âä©Êâã_Êï∞ÊçÆÂ§á‰ªΩ_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showSuccessMessage('Êï∞ÊçÆÂØºÂá∫ÊàêÂäüÔºÅ');
            }
            
            function importData() {
                const file = document.getElementById('importFile').files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // ÊÅ¢Â§çÂêÑÁßçÊï∞ÊçÆ
                        if (data.userData) {
                            localStorage.setItem('user_data', JSON.stringify(data.userData));
                            userData = data.userData;
                        }
                        if (data.settingsData) {
                            localStorage.setItem('settings_data', JSON.stringify(data.settingsData));
                            settingsData = data.settingsData;
                        }
                        if (data.membershipData) {
                            localStorage.setItem('membership_data', JSON.stringify(data.membershipData));
                        }
                        if (data.productManagerData) {
                            localStorage.setItem('productManager_data', JSON.stringify(data.productManagerData));
                        }
                        if (data.priceAdjusterData) {
                            localStorage.setItem('priceAdjuster_data', JSON.stringify(data.priceAdjusterData));
                        }
                        if (data.symbolChangerData) {
                            localStorage.setItem('symbolChanger_data', JSON.stringify(data.symbolChangerData));
                        }
                        
                        // Êõ¥Êñ∞ÁïåÈù¢
                        updateUserInfo();
                        updateSettingsUI();
                        applySettings();
                        
                        showSuccessMessage('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                    } catch (error) {
                        alert('Êñá‰ª∂Ê†ºÂºèÈîôËØØÔºåËØ∑ÈÄâÊã©Ê≠£Á°ÆÁöÑÂ§á‰ªΩÊñá‰ª∂');
                    }
                };
                reader.readAsText(file);
            }
            
            function clearData() {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                    localStorage.clear();
                    location.reload();
                }
            }
            
            function showFeedback() {
                alert('ÊÑèËßÅÂèçÈ¶àÂäüËÉΩÂºÄÂèë‰∏≠ÔºåÊï¨ËØ∑ÊúüÂæÖÔºÅ');
            }
            
            // ‰∏ÄÈîÆÁôªÂΩïÂ§ÑÁêÜ
            function handlePhoneLogin() {
                console.log('‰∏ÄÈîÆÁôªÂΩïË¢´ÁÇπÂáª');
                console.log('ALIYUN_CONFIG:', ALIYUN_CONFIG);
                console.log('PhoneNumberServerÊòØÂê¶Âä†ËΩΩ:', typeof PhoneNumberServer);
                console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
                console.log('ÊâÄÊúâwindowÂ±ûÊÄß:', Object.keys(window).filter(key => key.includes('Phone') || key.includes('Aliyun')));
                
                // ÂÖàÊòæÁ§∫‰∏Ä‰∏™ÊòéÊòæÁöÑÊèêÁ§∫
                alert('‰∏ÄÈîÆÁôªÂΩïË¢´ÁÇπÂáªÔºÅ\n\nÊ≠£Âú®Ê£ÄÊü•SDKÁä∂ÊÄÅ...\n\nPhoneNumberServer: ' + (typeof PhoneNumberServer) + '\nwindow.PhoneNumberServer: ' + (typeof window.PhoneNumberServer));
                
                // Ê£ÄÊü•SDKÊòØÂê¶Âä†ËΩΩÊàêÂäü
                if (typeof PhoneNumberServer === 'undefined' && typeof window.PhoneNumberServer === 'undefined') {
                    console.log('ÈòøÈáå‰∫ëSDKÊú™Âä†ËΩΩÔºåÂõûÈÄÄÂà∞ÂºÄÂèëÊ®°Âºè');
                    alert('ÈòøÈáå‰∫ëSDKÊú™Âä†ËΩΩÔºåÂàáÊç¢Âà∞Ê®°ÊãüÊ®°Âºè');
                    showPhoneLoginModal();
                    return;
                }
                
                if (ALIYUN_CONFIG.isDevelopment) {
                    // ÂºÄÂèëÊ®°ÂºèÔºö‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                    console.log('‰ΩøÁî®ÂºÄÂèëÊ®°Âºè');
                    alert('ÂΩìÂâç‰∏∫ÂºÄÂèëÊ®°Âºè');
                    showPhoneLoginModal();
                } else {
                    // Áîü‰∫ßÊ®°ÂºèÔºöË∞ÉÁî®ÈòøÈáå‰∫ë SDK
                    console.log('‰ΩøÁî®Áîü‰∫ßÊ®°Âºè');
                    alert('ÂΩìÂâç‰∏∫Áîü‰∫ßÊ®°ÂºèÔºåÂáÜÂ§áË∞ÉÁî®ÈòøÈáå‰∫ëSDK');
                    callAliyunPhoneAuth();
                }
            }
            
            // ÊòæÁ§∫ÊâãÊú∫Âè∑ÁôªÂΩïÊ®°ÊÄÅÊ°ÜÔºàÂºÄÂèëÊ®°ÂºèÔºâ
            function showPhoneLoginModal() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2>üì± ‰∏ÄÈîÆÁôªÂΩï</h2>
                            <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 48px; margin-bottom: 16px;">‚è≥</div>
                                <h3 style="margin: 0 0 8px 0;">ÈòøÈáå‰∫ëÂÆ°Ê†∏‰∏≠</h3>
                                <p style="color: #666; margin: 0 0 20px 0;">ÊÇ®ÁöÑÂè∑Á†ÅËÆ§ËØÅÊñπÊ°àÊ≠£Âú®ÈòøÈáå‰∫ëÂÆ°Ê†∏‰∏≠ÔºåÈ¢ÑËÆ°1-2‰∏™Â∑•‰ΩúÊó•ÁîüÊïà</p>
                                <div style="background: #fff3cd; padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                                    <p style="margin: 0; font-size: 14px; color: #856404;">
                                        <strong>ÂΩìÂâçÁä∂ÊÄÅÔºö</strong>ÂÆ°Ê†∏‰∏≠<br>
                                        <strong>ÊñπÊ°à CodeÔºö</strong>${ALIYUN_CONFIG.sceneCode}<br>
                                        <strong>È¢ÑËÆ°ÁîüÊïàÔºö</strong>1-2‰∏™Â∑•‰ΩúÊó•
                                    </p>
                                </div>
                                <div style="background: #f0f8ff; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                                    <p style="margin: 0; font-size: 14px; color: #333;">
                                        <strong>‰∏¥Êó∂ÊµãËØïÔºö</strong>‰ΩøÁî®Ê®°ÊãüÁôªÂΩïÂäüËÉΩ
                                    </p>
                                </div>
                                <button class="btn btn-primary" onclick="Settings.simulatePhoneLogin()" style="width: 100%;">
                                    Ê®°ÊãüÁôªÂΩïÊµãËØï
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            // Ê®°ÊãüÊâãÊú∫Âè∑ÁôªÂΩï
            function simulatePhoneLogin() {
                // Ê®°ÊãüË∞ÉÁî®ÂêéÁ´ØÈ™åËØÅÊé•Âè£
                const mockToken = 'mock_token_' + Date.now();
                
                fetch('/.netlify/functions/auth/verify-phone', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: mockToken })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // ‰øùÂ≠ò JWT ÂíåÁî®Êà∑‰ø°ÊÅØ
                        localStorage.setItem('jwt', data.jwt);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        
                        // Êõ¥Êñ∞ UI
                        updateUserInfo(data.user);
                        
                        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                        document.querySelector('.modal').remove();
                        
                        showSuccessMessage('ÁôªÂΩïÊàêÂäüÔºÅ');
                    } else {
                        alert('ÁôªÂΩïÂ§±Ë¥•Ôºö' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    alert('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
                });
            }
            
            // Ë∞ÉÁî®ÈòøÈáå‰∫ëÂè∑Á†ÅËÆ§ËØÅ SDKÔºàÁîü‰∫ßÊ®°ÂºèÔºâ
            function callAliyunPhoneAuth() {
                if (typeof PhoneNumberServer === 'undefined') {
                    alert('ÈòøÈáå‰∫ëSDKÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                    return;
                }
                
                const phoneNumberServer = new PhoneNumberServer();
                
                // Á¨¨‰∏ÄÊ≠•ÔºöËé∑ÂèñaccessTokenÂíåjwtToken
                getAuthTokens()
                    .then(({ accessToken, jwtToken }) => {
                        // Á¨¨‰∫åÊ≠•ÔºöË∫´‰ªΩÈâ¥ÊùÉ
                        phoneNumberServer.checkLoginAvailable({
                            accessToken: accessToken,
                            jwtToken: jwtToken,
                            success: function (res) {
                                console.log('Èâ¥ÊùÉÊàêÂäü', res);
                                if (res.code === 600000) {
                                    // Á¨¨‰∏âÊ≠•ÔºöËé∑ÂèñÁôªÂΩïToken
                                    getLoginToken(phoneNumberServer);
                                } else {
                                    alert('Èâ¥ÊùÉÂ§±Ë¥•Ôºö' + (res.message || 'Êú™Áü•ÈîôËØØ'));
                                }
                            },
                            error: function (res) {
                                console.log('Èâ¥ÊùÉÂ§±Ë¥•', res);
                                alert('Èâ¥ÊùÉÂ§±Ë¥•ÔºåËØ∑ÂÖ≥Èó≠WiFi‰ΩøÁî®ÁßªÂä®ÁΩëÁªúÈáçËØï');
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Ëé∑ÂèñTokenÂ§±Ë¥•:', error);
                        alert('Ëé∑ÂèñËÆ§ËØÅTokenÂ§±Ë¥•Ôºö' + error.message);
                    });
            }
            
            // Ëé∑ÂèñËÆ§ËØÅToken
            function getAuthTokens() {
                console.log('ÂºÄÂßãËé∑ÂèñËÆ§ËØÅToken...');
                
                // ÂÖàÊµãËØïÁÆÄÂçïÂáΩÊï∞
                return fetch('/.netlify/functions/auth/simple-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: 'data' })
                })
                .then(response => {
                    console.log('simple-testÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('simple-testÂìçÂ∫îÁªìÊûú:', data);
                    
                    // Áé∞Âú®ÊµãËØïÁúüÂÆûÂáΩÊï∞
                    return fetch('/.netlify/functions/auth/get-auth-token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ sceneCode: ALIYUN_CONFIG.sceneCode })
                    });
                })
                .then(response => {
                    console.log('get-auth-tokenÂìçÂ∫îÁä∂ÊÄÅ:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('get-auth-tokenÂìçÂ∫îÁªìÊûú:', data);
                    if (data.success) {
                        return { accessToken: data.accessToken, jwtToken: data.jwtToken };
                    } else {
                        throw new Error(data.message || 'Ëé∑ÂèñTokenÂ§±Ë¥•');
                    }
                });
            }
            
            // Ëé∑ÂèñÁôªÂΩïToken
            function getLoginToken(phoneNumberServer) {
                phoneNumberServer.getLoginToken({
                    success: function (res) {
                        console.log('Ëé∑ÂèñÁôªÂΩïTokenÊàêÂäü', res);
                        // Á¨¨ÂõõÊ≠•ÔºöÊúçÂä°Á´ØÂèñÂè∑
                        getPhoneNumber(res.spToken);
                    },
                    error: function (res) {
                        console.log('Ëé∑ÂèñÁôªÂΩïTokenÂ§±Ë¥•', res);
                        alert('Ëé∑ÂèñÁôªÂΩïTokenÂ§±Ë¥•Ôºö' + (res.message || 'Êú™Áü•ÈîôËØØ'));
                    },
                    watch: function (status, data) {
                        console.log('ÊéàÊùÉÈ°µÁä∂ÊÄÅ:', status, data);
                    }
                });
            }
            
            // ÊúçÂä°Á´ØÂèñÂè∑
            function getPhoneNumber(spToken) {
                fetch('/.netlify/functions/auth/verify-phone', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ spToken: spToken })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        localStorage.setItem('jwt', data.jwt);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        updateUserInfo(data.user);
                        showSuccessMessage('ÁôªÂΩïÊàêÂäüÔºÅ');
                    } else {
                        alert('ÁôªÂΩïÂ§±Ë¥•Ôºö' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    alert('ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
                });
            }
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫
            function updateUserInfo(user) {
                const userName = document.getElementById('userName');
                const userStatus = document.getElementById('userStatus');
                const loginButtons = document.getElementById('loginButtons');
                
                if (user) {
                    userName.textContent = user.phone || 'Â∑≤ÁôªÂΩï';
                    userStatus.textContent = user.isMember ? 
                        `‰ºöÂëòÁî®Êà∑ | Âà∞ÊúüÔºö${new Date(user.memberExpireAt).toLocaleDateString()}` : 
                        'ÂÖçË¥πÁî®Êà∑';
                    
                    loginButtons.innerHTML = `
                        <button class="btn btn-danger" onclick="Settings.logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
                    `;
                } else {
                    userName.textContent = 'Êú™ÁôªÂΩï';
                    userStatus.textContent = 'ÁÇπÂáªÁôªÂΩï‰∫´ÂèóÊõ¥Â§öÂäüËÉΩ';
                    loginButtons.innerHTML = `
                        <button class="btn btn-primary" onclick="Settings.handlePhoneLogin()" id="phoneLoginBtn">üì± ‰∏ÄÈîÆÁôªÂΩï</button>
                        <button class="btn btn-secondary" onclick="Settings.showLoginModal()" id="otherLoginBtn">ÂÖ∂‰ªñÁôªÂΩï</button>
                    `;
                }
            }
            
            // ÈÄÄÂá∫ÁôªÂΩï
            function logout() {
                localStorage.removeItem('jwt');
                localStorage.removeItem('user');
                updateUserInfo(null);
                showSuccessMessage('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
            }
            
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            function checkLoginStatus() {
                const jwt = localStorage.getItem('jwt');
                const user = localStorage.getItem('user');
                
                if (jwt && user) {
                    try {
                        const userData = JSON.parse(user);
                        updateUserInfo(userData);
                    } catch (error) {
                        console.error('Parse user data error:', error);
                        logout();
                    }
                }
            }

            function showHelp() {
                let helpModal = document.getElementById('helpModal');
                if (!helpModal) {
                    helpModal = document.createElement('div');
                    helpModal.id = 'helpModal';
                    helpModal.className = 'modal';
                    helpModal.innerHTML = `
                        <div class="modal-content" style="max-width: 520px; width: 92%;">
                            <div class="modal-header">
                                <h2>‰ΩøÁî®Â∏ÆÂä©</h2>
                                <span class="close" onclick="Settings.closeHelpModal()">&times;</span>
                            </div>
                            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                                <div style="display: grid; gap: 16px;">
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üìå ÂØºËà™‰∏éÂàáÊç¢</h3>
                                        <p style="margin:0; color:#555; font-size:14px;">È°∂ÈÉ®Ê†áÁ≠æÊ†èÂú® <strong>‰∫ßÂìÅÁÆ°ÁêÜ / ‰ª∑Ê†ºË∞ÉÊï¥ / Á¨¶Âè∑Êõ¥Êç¢ / ‰ºöÂëò / ËÆæÁΩÆ</strong> ‰πãÈó¥ÂàáÊç¢„ÄÇ</p>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üóÇ ‰∫ßÂìÅÁÆ°ÁêÜ</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>Á≤òË¥¥ÊñáÊú¨ÂêéÁÇπ"Ëß£ÊûêÊñáÊú¨"„ÄÇ</li>
                                            <li>ÁÇπÊØèË°åÂèØÁõ¥Êé•ÁºñËæëÔºõÊîØÊåÅÊéíÂ∫è‰∏éÊâπÈáèÂà†Èô§„ÄÇ</li>
                                            <li>"Â§çÂà∂ÁªìÊûú"ÊåâÂΩìÂâçÊéíÂ∫èËæìÂá∫Ôºå‰øùÊåÅÊÆµËêΩÈ°∫Â∫è„ÄÇ</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üí∞ ‰ª∑Ê†ºË∞ÉÊï¥</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>ÊîØÊåÅÁôæÂàÜÊØî/Âõ∫ÂÆöÈ¢ùË∞É‰ª∑ÔºåÈªòËÆ§ <strong>+5%</strong>ÔºåÂπ∂ÂèØÂõõËàç‰∫îÂÖ•Âà∞ÂçÅ‰Ωç„ÄÇ</li>
                                            <li>ÂèØÂºÄÂêØÂå∫Èó¥Ë∞É‰ª∑Ôºö0-999„ÄÅ1000-1999„ÄÅ2000-4999„ÄÅ5000-9999„ÄÅ10000+„ÄÇ</li>
                                            <li>È¢úËâ≤ÊèêÁ§∫ÔºöÁ¥´-ÊâãÂä®„ÄÅÁ∫¢-‰∏äÊ∂®„ÄÅÁªø-‰∏ãÈôç„ÄÇ</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üîÑ Á¨¶Âè∑Êõ¥Êç¢</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>ÊâπÈáèÊõøÊç¢‰ª∑Ê†ºÂâçÁ¨¶Âè∑ÔºàÂ¶Ç üí∞„ÄÅ„ÄêÂèë„ÄëÔºâ„ÄÇ</li>
                                            <li>ÂãæÈÄâ"ÁªìÂ∞æËØ¥Êòé"ÂêéÔºåÂÜÖÂÆπ‰ªÖËøΩÂä†Âà∞Êï¥ÁØáÊú´Â∞æ‰∏ÄÊ¨°„ÄÇ</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üëë ‰ºöÂëò‰∏éÊé®Ëçê</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>Â•óÈ§êÔºöÊúà/ÂçäÂπ¥/Âπ¥ÔºåË¥≠‰π∞ÂêéËß£ÈîÅÊó†ÈôêÂà∂‰∏é‰ºòÂÖàÊîØÊåÅ„ÄÇ</li>
                                            <li>Êé®ËçêÁ†ÅÔºöA Ëé∑ 20 Â§©ÔºåB Ëé∑ 7 Â§©ÔºõB È¶ñË¥≠ÔºåA ÂÜçÂä† 40 Â§©„ÄÇ</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">‚öôÔ∏è ËÆæÁΩÆ‰∏éÊï∞ÊçÆ</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>‰∏ªÈ¢òÔºöÊµÖËâ≤/Ê∑±Ëâ≤/Ë∑üÈöèÁ≥ªÁªüÔºõÂ≠ó‰ΩìÔºöÂ∞è/‰∏≠/Â§ß„ÄÇ</li>
                                            <li>Êï∞ÊçÆÔºöÂØºÂÖ•/ÂØºÂá∫Â§á‰ªΩÔºå‰∏ÄÈîÆÊ∏ÖÈô§ÈáçÁΩÆ„ÄÇ</li>
                                            <li>ÁôªÂΩïÔºöÊîØÊåÅËÆ∞‰ΩèÊàë‰∏éËá™Âä®ÁôªÂΩï„ÄÇ</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">üì≤ ÂÆâË£Ö‰∏∫ÊâãÊú∫APP</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>Edge/Chrome ÊâìÂºÄÁ´ôÁÇπ ‚Üí ËèúÂçï ‚Üí Ê∑ªÂä†Âà∞‰∏ªÂ±èÔºàÂÆâË£ÖÔºâ„ÄÇ</li>
                                            <li>Êõ¥Êñ∞Ôºö‰∏ãÊãâÂà∑Êñ∞ÊàñÈáçÊñ∞ÊâìÂºÄÂç≥ÂèØËé∑ÂèñÊúÄÊñ∞Áâà„ÄÇ</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(helpModal);
                }
                helpModal.style.display = 'block';
            }

            function closeHelpModal() {
                const helpModal = document.getElementById('helpModal');
                if (helpModal) helpModal.style.display = 'none';
            }
            
            function showSuccessMessage(message) {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            return {
                init: init,
                showLoginModal: showLoginModal,
                closeLoginModal: closeLoginModal,
                showRegisterModal: showRegisterModal,
                closeRegisterModal: closeRegisterModal,
                changeTheme: changeTheme,
                changeFontSize: changeFontSize,
                toggleAutoSave: toggleAutoSave,
                togglePriceHint: togglePriceHint,
                toggleVibration: toggleVibration,
                exportData: exportData,
                importData: importData,
                clearData: clearData,
                showFeedback: showFeedback,
                showHelp: showHelp,
                closeHelpModal: closeHelpModal,
                handlePhoneLogin: handlePhoneLogin,
                simulatePhoneLogin: simulatePhoneLogin,
                logout: logout
            };
        })();
        
        // ========== ÂàùÂßãÂåñ ==========
        document.addEventListener('DOMContentLoaded', function() {
            ProductManager.init();
            PriceAdjuster.init();
            SymbolChanger.init();
            Membership.init();
            Settings.init();
        });
        
        // Ê≥®ÂÜåService Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(function(registration) {
                    console.log('Service Worker Ê≥®ÂÜåÊàêÂäü:', registration);
                })
                .catch(function(error) {
                    console.log('Service Worker Ê≥®ÂÜåÂ§±Ë¥•:', error);
                });
        }
    </script>
</body>
</html>

