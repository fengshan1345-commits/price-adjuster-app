<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®¶ç”µæŠ¥ä»·åŠ©æ‰‹</title>
    
    <!-- PWAæ”¯æŒ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æŠ¥ä»·åŠ©æ‰‹">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        /* ========== å…¨å±€æ ·å¼ ========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
            padding-top: 50px; /* ä¸ºé¡¶éƒ¨Tabæ ç•™å‡ºç©ºé—´ */
            padding-bottom: 70px; /* ä¸ºåº•éƒ¨å¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        }
        
        /* ========== é¡¶éƒ¨æ ‡é¢˜æ  ========== */
        .top-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 0 15px;
            padding-top: env(safe-area-inset-top); /* iOSåˆ˜æµ·å±é€‚é… */
        }
        
        .top-header .page-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        
        .top-header .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .header-icon-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .header-icon-btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }
        
        /* ========== åº•éƒ¨å¯¼èˆªæ  ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding-bottom: env(safe-area-inset-bottom); /* iOSå®‰å…¨åŒºåŸŸ */
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            gap: 4px;
        }
        
        .nav-item:active {
            transform: scale(0.95);
        }
        
        .nav-item-icon {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .nav-item-label {
            font-size: 12px;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .nav-item.active .nav-item-icon {
            color: #667eea;
            transform: scale(1.1);
        }
        
        .nav-item.active .nav-item-label {
            color: #667eea;
            font-weight: 600;
        }
        
        .nav-item.active.history .nav-item-icon {
            color: #ff6b35;
        }
        
        .nav-item.active.history .nav-item-label {
            color: #ff6b35;
        }
        
        /* ä¸­é—´çªå‡ºæŒ‰é’®æ ·å¼ */
        .nav-item.center-btn {
            flex: 0 0 auto;
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            position: relative;
            bottom: 15px;
            box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4);
        }
        
        .nav-item.center-btn .special-icon {
            font-size: 18px;
            color: white;
            font-weight: 600;
        }
        
        .nav-item.center-btn.active {
            background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);
            transform: scale(1.05);
        }
        
        .tab-bar {
            display: none; /* éšè—æ—§çš„é¡¶éƒ¨å¯¼èˆª */
        }
        
        /* ========== å†…å®¹åŒºåŸŸ ========== */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ========== ä¼šå‘˜é™åˆ¶æ ·å¼ ========== */
        .membership-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            border-radius: 8px;
        }
        
        .membership-lock-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: #f39c12;
        }
        
        .membership-lock-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .membership-lock-desc {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 24px;
            text-align: center;
        }
        
        .membership-upgrade-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }
        
        .membership-upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(243, 156, 18, 0.4);
        }
        
        .membership-restricted {
            position: relative;
        }
        
        .membership-restricted .control-input:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .membership-restricted .control-label {
            position: relative;
        }
        
        .membership-restricted .control-label::after {
            content: "ğŸ”’";
            margin-left: 8px;
            color: #f39c12;
            font-size: 14px;
        }
        
        .membership-badge {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        /* ========== äº§å“ç®¡ç†åˆ—è¡¨é¡¹ç§»åŠ¨åŠŸèƒ½æ ·å¼ ========== */
        .result-item {
            position: relative;
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }
        
        .result-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            z-index: 1000;
        }
        
        .result-item.drag-over {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        /* æ’å…¥æŒ‡ç¤ºçº¿æ ·å¼ */
        .insert-indicator {
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            margin: 4px 0;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            position: relative;
            z-index: 999;
        }
        
        .insert-indicator::before {
            content: '';
            position: absolute;
            left: -8px;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 8px solid #667eea;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }
        
        .insert-indicator::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -4px;
            width: 0;
            height: 0;
            border-right: 8px solid #667eea;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }
        
        .drag-handle {
            cursor: grab;
            padding: 8px;
            margin-right: 8px;
            color: #999;
            font-size: 18px;
            user-select: none;
            transition: color 0.2s;
        }
        
        .drag-handle:hover {
            color: #667eea;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .move-buttons {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-left: 8px;
        }
        
        .move-btn {
            width: 32px;
            height: 24px;
            border: none;
            background: #f8f9fa;
            color: #666;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .move-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .move-btn:disabled {
            background: #f0f0f0;
            color: #ccc;
            cursor: not-allowed;
        }
        
        .item-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 0;
        }
        
        .item-text {
            flex: 1;
            margin-right: 12px;
            word-break: break-word;
        }
        
        .price-display {
            flex-shrink: 0;
        }

        /* ========== ç•Œé¢1ï¼šäº§å“ç®¡ç† æ ·å¼ ========== */
        #productManager .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            margin-top: 20px;
            position: relative;
        }
        
        #productManager h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        #productManager .input-section {
            margin-bottom: 20px;
        }
        
        #productManager textarea {
            width: 100%;
            height: 200px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        #productManager textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        #productManager .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        #productManager button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #productManager button:hover {
            background-color: #2980b9;
        }
        
        #productManager button.secondary {
            background-color: #95a5a6;
        }
        
        #productManager button.secondary:hover {
            background-color: #7f8c8d;
        }
        
        #productManager button.danger {
            background-color: #e74c3c;
        }
        
        #productManager button.danger:hover {
            background-color: #c0392b;
        }
        
        #productManager .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        #productManager .stats-vertical {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
        }
        
        #productManager .stat-item {
            text-align: center;
        }
        
        #productManager .stat-item-vertical {
            text-align: center;
            flex: 1;
        }
        
        #productManager .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        #productManager .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        #productManager .results-container {
            margin-top: 20px;
            max-height: 60vh;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            -webkit-overflow-scrolling: touch;
        }
        
        #productManager .result-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            transition: background-color 0.2s;
            position: relative;
            cursor: default;
        }
        
        #productManager .result-item:last-child {
            border-bottom: none;
        }
        
        #productManager .result-item:hover {
            background-color: #f8f9fa;
        }
        
        #productManager .result-item.selected {
            background-color: #e8f4fd;
        }
        
        #productManager .checkbox {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        #productManager .checkbox.hidden {
            display: none;
        }
        
        #productManager .price {
            color: #e74c3c;
            font-weight: bold;
            margin-left: 5px;
        }
        
        #productManager .price-display {
            margin-left: auto;
            margin-right: 10px;
        }
        
        #productManager .blue-price {
            color: #2196F3;
            font-weight: bold;
            background-color: #f0f8ff;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #bbdefb;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šäº§å“ç®¡ç†çš„ä»·æ ¼æ ‡ç­¾æ”¹ä¸ºè“è‰²æ–‡å­—ã€æµ…ç°è‰²èƒŒæ™¯ã€æµ…è“è‰²è¾¹æ¡† */
        .theme-dark #productManager .blue-price {
            color: #2196F3 !important;  /* è“è‰²æ–‡å­— */
            background-color: #e0e0e0 !important;  /* æµ…ç°è‰²èƒŒæ™¯ */
            border-color: #90caf9 !important;  /* æµ…è“è‰²è¾¹æ¡† */
        }
        
        #productManager .no-price {
            color: #999;
            font-style: italic;
        }
        
        #productManager .sort-controls {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #productManager select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        #productManager .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        #productManager .copy-success.show {
            opacity: 1;
        }
        
        /* ========== ç•Œé¢2ï¼šä»·æ ¼è°ƒæ•´ æ ·å¼ ========== */
        #priceAdjuster .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 4vw;
        }
        
        #priceAdjuster .header { 
            text-align: center; 
            margin-bottom: 6vw; 
        }
        
        #priceAdjuster .title { 
            font-size: 6vw; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 2vw; 
        }
        
        #priceAdjuster .subtitle { 
            font-size: 4vw; 
            color: #666; 
        }
        
        #priceAdjuster .test-section { 
            background: white; 
            border-radius: 12px; 
            padding: 4vw; 
            margin-bottom: 4vw; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        
        #priceAdjuster .test-title { 
            font-size: 4.5vw; 
            font-weight: 600; 
            margin-bottom: 3vw; 
            color: #333; 
        }
        
        #priceAdjuster .input-area { 
            margin-bottom: 4vw; 
        }
        
        #priceAdjuster .input-text { 
            width: 100%; 
            min-height: 200px; 
            padding: 3vw; 
            font-size: 4vw; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            resize: vertical; 
        }
        
        #priceAdjuster .input-text:focus { 
            outline: none; 
            border-color: #667eea; 
        }
        
        #priceAdjuster .btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 3vw 6vw; 
            border-radius: 8px; 
            font-size: 4vw; 
            font-weight: 600; 
            cursor: pointer; 
            margin: 2vw; 
        }
        
        #priceAdjuster .btn:hover { 
            background: #5a6fd8; 
        }
        
        #priceAdjuster .btn-success { 
            background: #4caf50; 
        }
        
        #priceAdjuster .result-area { 
            margin-top: 4vw; 
        }
        
        #priceAdjuster .result-item { 
            background: #f9f9f9; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 3vw; 
            margin-bottom: 2vw; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        
        #priceAdjuster .result-item.has-price { 
            border-color: #4caf50; 
            background: #f0f8f0; 
        }
        
        #priceAdjuster .result-item.no-price { 
            border-color: #ff9800; 
            background: #fff8f0; 
        }
        
        #priceAdjuster .result-content { 
            flex: 1; 
            font-size: 3.5vw; 
            color: #333; 
        }
        
        #priceAdjuster .result-price { 
            font-size: 4.5vw; 
            font-weight: 700; 
            color: #4caf50; 
            margin-left: 2vw; 
        }
        
        #priceAdjuster .result-price.original { 
            color: #666; 
            text-decoration: line-through; 
        }
        
        #priceAdjuster .result-price.new { 
            color: #f44336; 
        }
        
        #priceAdjuster .stats { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 2vw; 
            margin-top: 4vw; 
        }
        
        #priceAdjuster .stat-item { 
            text-align: center; 
            padding: 3vw; 
            background: #f0f0f0; 
            border-radius: 8px; 
        }
        
        #priceAdjuster .stat-number { 
            font-size: 6vw; 
            font-weight: 700; 
        }
        
        #priceAdjuster .stat-label { 
            font-size: 3vw; 
            color: #666; 
            margin-top: 1vw; 
        }
        
        #priceAdjuster .price-controls { 
            background: #e8f5e8; 
            padding: 3vw; 
            border-radius: 8px; 
            margin-bottom: 4vw; 
        }
        
        #priceAdjuster .control-row { 
            display: flex; 
            align-items: center; 
            margin-bottom: 2vw; 
        }
        
        #priceAdjuster .control-label { 
            font-size: 3.5vw; 
            margin-right: 2vw; 
            min-width: 120px; 
        }
        
        #priceAdjuster .control-input { 
            flex: 1; 
            padding: 2vw; 
            font-size: 3.5vw; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
        }
        
        /* ========== ç•Œé¢3ï¼šç¬¦å·æ›´æ¢ æ ·å¼ ========== */
        #symbolChanger .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 4vw;
        }
        
        #symbolChanger .header { 
            text-align: center; 
            margin-bottom: 6vw; 
        }
        
        #symbolChanger .title { 
            font-size: 6vw; 
            font-weight: 700; 
            color: #333; 
            margin-bottom: 2vw; 
        }
        
        #symbolChanger .subtitle { 
            font-size: 4vw; 
            color: #666; 
        }
        
        #symbolChanger .test-section { 
            background: white; 
            border-radius: 12px; 
            padding: 4vw; 
            margin-bottom: 4vw; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        
        #symbolChanger .test-title { 
            font-size: 4.5vw; 
            font-weight: 600; 
            margin-bottom: 3vw; 
            color: #333; 
        }
        
        #symbolChanger .input-area { 
            margin-bottom: 4vw; 
        }
        
        #symbolChanger .input-text { 
            width: 100%; 
            min-height: 200px; 
            padding: 3vw; 
            font-size: 4vw; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            resize: vertical; 
        }
        
        #symbolChanger .input-text:focus { 
            outline: none; 
            border-color: #667eea; 
        }
        
        #symbolChanger .btn { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 3vw 6vw; 
            border-radius: 8px; 
            font-size: 4vw; 
            font-weight: 600; 
            cursor: pointer; 
            margin: 2vw; 
        }
        
        #symbolChanger .btn:hover { 
            background: #5a6fd8; 
        }
        
        #symbolChanger .btn-success { 
            background: #4caf50; 
        }
        
        #symbolChanger .result-area { 
            margin-top: 4vw; 
            max-height: 60vh; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
        }
        
        #symbolChanger .result-area::-webkit-scrollbar {
            width: 6px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        #symbolChanger .result-area::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        #symbolChanger .result-area {
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }
        
        #symbolChanger .result-item { 
            background: #f9f9f9; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            padding: 3vw; 
            margin-bottom: 2vw; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            cursor: default;
        }
        
        #symbolChanger .result-item.has-price { 
            border-color: #4caf50; 
            background: #f0f8f0; 
        }
        
        #symbolChanger .result-item.no-price { 
            border-color: #ff9800; 
            background: #fff8f0; 
        }
        
        #symbolChanger .result-content { 
            flex: 1; 
            font-size: 3.5vw; 
            color: #333; 
        }
        
        #symbolChanger .result-price { 
            font-size: 4.5vw; 
            font-weight: 700; 
            color: #4caf50; 
            margin-left: 2vw; 
        }
        
        #symbolChanger .stats { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 2vw; 
            margin-top: 4vw; 
        }
        
        #symbolChanger .stat-item { 
            text-align: center; 
            padding: 3vw; 
            background: #f0f0f0; 
            border-radius: 8px; 
        }
        
        #symbolChanger .stat-number { 
            font-size: 6vw; 
            font-weight: 700; 
        }
        
        #symbolChanger .stat-label { 
            font-size: 3vw; 
            color: #666; 
            margin-top: 1vw; 
        }
        
        /* ========== ä¼šå‘˜ç³»ç»Ÿæ ·å¼ ========== */
        #membership .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .membership-status-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-info {
            display: flex;
            align-items: center;
        }
        
        .status-icon {
            font-size: 40px;
            margin-right: 15px;
        }
        
        .status-text h3 {
            margin: 0 0 5px 0;
            font-size: 24px;
        }
        
        .status-text p {
            margin: 0;
            opacity: 0.9;
        }
        
        .section-title {
            font-size: 20px;
            color: #333;
            margin: 30px 0 20px 0;
            text-align: center;
        }
        
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .package-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .package-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .package-card.popular {
            border-color: #ff6b35;
            transform: scale(1.05);
        }
        
        .popular-badge {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff6b35;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .package-header h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: #333;
        }
        
        .package-price {
            margin-bottom: 20px;
        }
        
        .price-new {
            font-size: 32px;
            font-weight: bold;
            color: #ff6b35;
        }
        
        .price-original {
            font-size: 16px;
            color: #999;
            text-decoration: line-through;
            margin-left: 10px;
        }
        
        .package-features {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .package-features p {
            margin: 8px 0;
            font-size: 14px;
            color: #666;
        }
        
        .btn-package {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .btn-package:hover {
            background: #5a6fd8;
        }
        
        .referral-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .referral-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .referral-code {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .referral-code input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            font-size: 16px;
        }
        
        .btn-small {
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .referral-desc {
            font-size: 14px;
            color: #666;
            margin: 10px 0 0 0;
        }
        
        .referral-input {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        
        .referral-code-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .referral-code-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .benefit-item {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .benefit-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .benefit-item h4 {
            margin: 10px 0;
            color: #333;
        }
        
        .benefit-item p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }
        
        /* ========== è®¾ç½®ç•Œé¢æ ·å¼ ========== */
        #settings .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .user-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .user-avatar {
            font-size: 40px;
            margin-right: 15px;
        }
        
        .user-details h3 {
            margin: 0 0 5px 0;
            font-size: 20px;
        }
        
        .user-details p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .login-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .login-buttons .btn {
            flex: 1;
            min-width: 120px;
        }
        
        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .settings-section .section-title {
            font-size: 18px;
            color: #333;
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè®¾ç½®ç•Œé¢æ ‡é¢˜æ–‡å­—æ”¹ä¸ºæµ…è‰² */
        .theme-dark .settings-section .section-title {
            color: #e0e0e0 !important;
        }
        
        .theme-dark .setting-item label {
            color: #e0e0e0 !important;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-item label {
            font-weight: 500;
            color: #333;
        }
        
        .setting-item select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #667eea;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .checkmark {
            margin-left: 8px;
        }
        
        .about-info {
            text-align: center;
        }
        
        .about-info p {
            margin: 10px 0;
            color: #666;
        }
        
        .contact-links {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn-link {
            background: none;
            border: none;
            color: #667eea;
            text-decoration: underline;
            cursor: pointer;
            padding: 5px 10px;
        }
        
        .btn-link:hover {
            color: #5a6fd8;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .form-actions .btn {
            flex: 1;
        }
        
        /* ========== ä¸»é¢˜å’Œå­—ä½“æ ·å¼ ========== */
        .theme-dark {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        .theme-dark .tab-bar {
            background-color: #2d2d2d;
            border-bottom-color: #444;
        }
        
        .theme-dark .tab-item {
            color: #e0e0e0;
        }
        
        .theme-dark .tab-item.active {
            color: #667eea;
        }
        
        .theme-dark .container {
            background-color: #1a1a1a;
        }
        
        .theme-dark .settings-section {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        .theme-dark .setting-item {
            border-bottom-color: #444;
        }
        
        .theme-dark .setting-item label {
            color: #e0e0e0;
        }
        
        .theme-dark .setting-item select {
            background-color: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }
        
        .theme-dark .modal-content {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }
        
        .theme-dark .modal-header {
            border-bottom-color: #444;
        }
        
        .theme-dark .form-group input {
            background-color: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }
        
        .theme-dark .form-group input:focus {
            border-color: #667eea;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè§£æç•Œé¢ã€è¾“å…¥æ¡†ã€å®¹å™¨ */
        .theme-dark #pm_inputText,
        .theme-dark #pa_productInput,
        .theme-dark .input-text {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šæ‰€æœ‰è¾“å…¥æ¡†å’Œæ–‡æœ¬åŒºåŸŸ */
        .theme-dark textarea,
        .theme-dark input[type="text"],
        .theme-dark input[type="number"] {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        .theme-dark #pm_resultsContainer,
        .theme-dark .result-item,
        .theme-dark .test-section,
        .theme-dark .container {
            background-color: #1a1a1a !important;
        }
        
        .theme-dark #pm_resultsContainer .result-item {
            background-color: #2d2d2d !important;
            border-color: #444 !important;
            color: #e0e0e0 !important;
        }
        
        .theme-dark .result-text {
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç­›é€‰æ ã€å†å²è®°å½•å¡ç‰‡ */
        .theme-dark .history-filter-bar,
        .theme-dark .history-card,
        .theme-dark .settings-section {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }
        
        .theme-dark .history-filter-bar select {
            background-color: #3d3d3d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç»Ÿè®¡å¡ç‰‡ */
        .theme-dark .stat-item-vertical,
        .theme-dark .stat-item {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }
        
        .theme-dark .stat-number {
            color: #667eea !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šæŒ‰é’® */
        .theme-dark .btn {
            background-color: #3d3d3d !important;
            color: #e0e0e0 !important;
            border-color: #555 !important;
        }
        
        .theme-dark .btn.btn-primary {
            background-color: #667eea !important;
            color: white !important;
        }
        
        .theme-dark .btn.danger {
            background-color: #e74c3c !important;
            color: white !important;
        }
        
        .theme-dark .btn.btn-secondary {
            background-color: #3d3d3d !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè§£æç»“æœåŒºåŸŸ - è¾¹æ¡†å˜ç»†ï¼Œæ–‡å­—æ›´äº®ï¼ˆç»Ÿä¸€æ‰€æœ‰ç•Œé¢ï¼‰ */
        .theme-dark #pa_resultArea .result-item,
        .theme-dark #sc_resultArea .result-item,
        .theme-dark .result-item {
            border: 1px solid #444 !important;  /* è¾¹æ¡†å˜ç»† */
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
        }
        
        /* ç»Ÿä¸€æ‰€æœ‰è§£ææ–‡å­—çš„é¢œè‰²ï¼Œä½¿ç”¨æµ…è‰²ä¿è¯å¯è¯»æ€§ */
        .theme-dark #pa_resultArea .result-text,
        .theme-dark #sc_resultArea .result-text,
        .theme-dark .result-text {
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè§£æç»“æœæ˜¾ç¤ºåŒºåŸŸèƒŒæ™¯ */
        .theme-dark #pa_resultArea,
        .theme-dark #sc_resultArea {
            background-color: #1a1a1a !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè§£ææ–‡æœ¬å†…å®¹ - æ’é™¤ä»·æ ¼æ ‡ç­¾ï¼Œè®©ä»·æ ¼å¯ä»¥æ˜¾ç¤ºçº¢è‰²å’Œç»¿è‰² */
        .theme-dark #pa_resultArea *:not(.result-price):not(.price-increase):not(.price-decrease):not(.result-price.new),
        .theme-dark #sc_resultArea * {
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šè“è‰²ä»·æ ¼æ ‡ç­¾é‡Œçš„ç™½è‰²æ–‡å­—è°ƒä¸ºç°é»‘ */
        .theme-dark .price-tag,
        .theme-dark .btn[style*="blue"],
        .theme-dark .btn-primary {
            color: #4a4a4a !important;  /* ç°é»‘è‰²ï¼Œä¸å†ç”¨ç™½è‰² */
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šæ‰€æœ‰è“è‰²æŒ‰é’®çš„æ–‡å­—éƒ½å˜ç°é»‘ */
        .theme-dark .btn.btn-primary {
            color: #4a4a4a !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç¬¦å·æ›´æ¢çš„æ‰€æœ‰è¾“å…¥æ¡† */
        .theme-dark #sc_inputText,
        .theme-dark #sc_separatorInput,
        .theme-dark textarea#sc_footerText {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šä»·æ ¼è°ƒæ•´çš„è®¾ç½®é¢æ¿ - å°†æµ…ç»¿è‰²èƒŒæ™¯æ”¹ä¸ºç°é»‘è‰² */
        .theme-dark .price-controls {
            background-color: #2d2d2d !important;
            border-color: #444 !important;
        }
        
        .theme-dark .price-controls * {
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šä¸‹æ‹‰èœå•å’Œè¾“å…¥æ¡†èƒŒæ™¯ */
        .theme-dark select,
        .theme-dark select.control-input {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        .theme-dark input[type="number"],
        .theme-dark input.control-input {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æµ…è‰²æ¨¡å¼ï¼šæ¶¨ä»·çº¢è‰²å’Œé™ä»·ç»¿è‰² - åªæ”¹å­—ä½“é¢œè‰²ï¼Œä¸è¦èƒŒæ™¯é˜´å½± */
        .price-increase,
        [class*="price-up"],
        [style*="red"],
        .result-price.new.price-increase {  /* æ¶¨ä»·ï¼šåªæ”¹å­—ä½“ä¸ºçº¢è‰² */
            color: #e74c3c !important;  /* æ¶¨ä»·çº¢è‰² */
        }
        
        .price-decrease,
        [class*="price-down"],
        [style*="green"],
        .result-price.new.price-decrease {  /* é™ä»·ï¼šåªæ”¹å­—ä½“ä¸ºç»¿è‰² */
            color: #27ae60 !important;  /* é™ä»·ç»¿è‰² */
        }
        
        .result-price.original {  /* åŸä»·ï¼ˆåˆ é™¤çº¿ï¼‰ */
            color: #999 !important;
            text-decoration: line-through !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šä¿æŒæ¶¨ä»·çº¢è‰²å’Œé™ä»·ç»¿è‰² - åªæ”¹å­—ä½“é¢œè‰²ï¼Œä¸è¦èƒŒæ™¯é˜´å½± */
        .theme-dark .price-increase,
        .theme-dark [class*="price-up"],
        .theme-dark [style*="red"],
        .theme-dark .result-price.new.price-increase,
        .theme-dark .result-price.new.price-increase * {
            color: #ff6666 !important;  /* æ¶¨ä»·çº¢è‰²ï¼ˆæ·±è‰²æ¨¡å¼ç¨å¾®äº®ä¸€ç‚¹ï¼‰ */
        }
        
        .theme-dark .price-decrease,
        .theme-dark [class*="price-down"],
        .theme-dark [style*="green"],
        .theme-dark .result-price.new.price-decrease,
        .theme-dark .result-price.new.price-decrease * {
            color: #66ff66 !important;  /* é™ä»·ç»¿è‰²ï¼ˆæ·±è‰²æ¨¡å¼ç¨å¾®äº®ä¸€ç‚¹ï¼‰ */
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šåŸä»·åˆ é™¤çº¿ - ä½¿ç”¨æ›´æš—çš„ç°è‰² */
        .theme-dark .result-price.original {
            color: #666 !important;  /* æ·±è‰²æ¨¡å¼ä¸‹æ›´æš—çš„ç°è‰² */
            text-decoration: line-through !important;
            text-decoration-color: #666 !important;  /* åˆ é™¤çº¿ä¹Ÿæ˜¯ç°è‰² */
        }
        
        /* ç¡®ä¿æ·±è‰²æ¨¡å¼ä¸‹æ–°ä»·æ ¼æ ‡ç­¾çš„é¢œè‰²ä¸è¢«è¦†ç›– */
        .theme-dark div.result-price span.result-price.new.price-increase {
            color: #ff6666 !important;
        }
        
        .theme-dark div.result-price span.result-price.new.price-decrease {
            color: #66ff66 !important;
        }
        
        /* åŸä»·åˆ é™¤çº¿æ ·å¼ */
        del,
        [style*="text-decoration: line-through"] {
            color: #999 !important;
            text-decoration-color: #999 !important;
        }
        
        .theme-dark del,
        .theme-dark [style*="text-decoration: line-through"] {
            color: #888 !important;
            text-decoration-color: #888 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç¬¦å·æ›´æ¢é¡µé¢çš„ç»“å°¾è¯´æ˜æ¡† */
        .theme-dark .test-section textarea {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç¡®ä¿ç¬¦å·æ›´æ¢çš„ç»“å°¾è¯´æ˜è¾“å…¥æ¡†åŠå…¶çˆ¶å®¹å™¨ä¹Ÿæ˜¯æ·±ç°è‰² */
        .theme-dark #sc_footerText,
        .theme-dark #symbolChanger textarea,
        .theme-dark #symbolChanger .input-area {
            background-color: #2d2d2d !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç»Ÿè®¡å¡ç‰‡è¾¹æ¡†å˜ç»†ä¸”å˜æš— */
        .theme-dark .stat-item,
        .theme-dark .stat-item-vertical {
            border: 1px solid #3d3d3d !important;  /* æ›´æš—çš„è¾¹æ¡† */
            background-color: #2d2d2d !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šæ‰€æœ‰ç™½è‰²å¤§è¾¹æ¡†å˜æš— */
        .theme-dark .stats,
        .theme-dark .stats-vertical,
        .theme-dark .test-section {
            background-color: #1a1a1a !important;
            border: 1px solid #3d3d3d !important;
        }
        
        .theme-dark .stats .stat-item,
        .theme-dark .stats-vertical .stat-item-vertical {
            border-color: #3d3d3d !important;
            background-color: #2d2d2d !important;
        }
        
        /* æ·±è‰²æ¨¡å¼ï¼šç¬¦å·æ›´æ¢ç»“å°¾è¯´æ˜åŒºåŸŸçš„çˆ¶å®¹å™¨ - è¦†ç›–å†…è”æ ·å¼ */
        .theme-dark #symbolChanger .input-area[style*="background"] {
            background: #1a1a1a !important;
            border-color: #444 !important;
        }
        
        /* å­—ä½“å¤§å°æ ·å¼ */
        .font-small {
            font-size: 14px;
        }
        
        .font-small .tab-item {
            font-size: 14px;
        }
        
        .font-small .container h1 {
            font-size: 24px;
        }
        
        .font-small .btn {
            font-size: 14px;
            padding: 8px 16px;
        }
        
        .font-large {
            font-size: 18px;
        }
        
        .font-large .tab-item {
            font-size: 18px;
        }
        
        .font-large .container h1 {
            font-size: 32px;
        }
        
        .font-large .btn {
            font-size: 18px;
            padding: 12px 24px;
        }
        
        /* ========== å­—ä½“å¤§å°åº”ç”¨åˆ°è§£æå†…å®¹ ========== */
        /* å°å­—ä½“ï¼šä»·æ ¼è°ƒæ•´ */
        .font-small #priceAdjuster .result-content {
            font-size: 14px !important;
        }
        .font-small #priceAdjuster .result-price {
            font-size: 16px !important;
        }
        
        /* å°å­—ä½“ï¼šç¬¦å·æ›´æ¢ */
        .font-small #symbolChanger .result-content {
            font-size: 14px !important;
        }
        .font-small #symbolChanger .result-price {
            font-size: 16px !important;
        }
        
        /* å¤§å­—ä½“ï¼šä»·æ ¼è°ƒæ•´ */
        .font-large #priceAdjuster .result-content {
            font-size: 18px !important;
        }
        .font-large #priceAdjuster .result-price {
            font-size: 20px !important;
        }
        
        /* å¤§å­—ä½“ï¼šç¬¦å·æ›´æ¢ */
        .font-large #symbolChanger .result-content {
            font-size: 18px !important;
        }
        .font-large #symbolChanger .result-price {
            font-size: 20px !important;
        }
        
        /* ========== è¶…å¤§å­—ä½“æ ·å¼ ========== */
        .font-extra-large {
            font-size: 24px;
        }
        
        .font-extra-large .tab-item {
            font-size: 24px;
        }
        
        .font-extra-large .container h1 {
            font-size: 40px;
        }
        
        .font-extra-large .btn {
            font-size: 24px;
            padding: 16px 32px;
        }
        
        /* è¶…å¤§å­—ä½“ï¼šä»·æ ¼è°ƒæ•´ */
        .font-extra-large #priceAdjuster .result-content {
            font-size: 24px !important;
        }
        .font-extra-large #priceAdjuster .result-price {
            font-size: 28px !important;
        }
        
        /* è¶…å¤§å­—ä½“ï¼šç¬¦å·æ›´æ¢ */
        .font-extra-large #symbolChanger .result-content {
            font-size: 24px !important;
        }
        .font-extra-large #symbolChanger .result-price {
            font-size: 28px !important;
        }
        
        /* ========== ç¼–è¾‘å¼¹çª—å­—ä½“å¤§å° ========== */
        /* å°å­—ä½“ï¼šäº§å“ç®¡ç†ç¼–è¾‘å¼¹çª—çš„textarea */
        .font-small .modal-content textarea {
            font-size: 14px !important;
        }
        
        /* å¤§å­—ä½“ï¼šäº§å“ç®¡ç†ç¼–è¾‘å¼¹çª—çš„textarea */
        .font-large .modal-content textarea {
            font-size: 18px !important;
        }
        
        /* è¶…å¤§å­—ä½“ï¼šäº§å“ç®¡ç†ç¼–è¾‘å¼¹çª—çš„textarea */
        .font-extra-large .modal-content textarea {
            font-size: 24px !important;
        }
        
        /* ========== æ·±è‰²æ¨¡å¼ï¼šç¼–è¾‘å¼¹çª—æ ·å¼ ========== */
        .theme-dark .modal-content {
            background-color: #2d2d2d !important;
        }
        
        .theme-dark .modal-content h3,
        .theme-dark .modal-content textarea {
            color: #e0e0e0 !important;
        }
        
        /* æ—¥æœŸåˆ†ç»„æ ‡é¢˜æ ·å¼ */
        .date-group-header {
            background: #f5f5f5;
            padding: 8px 12px;
            margin: 8px 0;
            border-radius: 8px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .date-group-header h3 {
            margin: 0;
            font-size: 16px;
            color: #333;
            font-weight: 600;
        }
        
        .theme-dark .date-group-header {
            background: #2d2d2d;
        }
        
        .theme-dark .date-group-header h3 {
            color: #e0e0e0;
        }
        
        /* ========== å†å²è®°å½•æ ·å¼ ========== */
        .history-filter-bar {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .history-filter-bar .filter-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .history-filter-bar label {
            font-size: 14px;
            color: #666;
        }
        
        .history-filter-bar select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .history-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .history-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .history-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .history-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .history-card.comparing {
            border: 2px solid #ff6b35;
        }
        
        .history-card.comparing::before {
            content: "âœ“";
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b35;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        /* è§†å›¾åˆ‡æ¢å™¨ */
        .view-switcher {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 4px;
        }
        
        .view-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .view-btn.active {
            background: #2196F3;
            color: white;
        }
        
        /* æ¥æºç­›é€‰æ ‡ç­¾æ  */
        .history-filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-tab {
            flex: 1;
            padding: 10px 16px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            color: #666;
            font-weight: 500;
        }
        
        .filter-tab.active {
            background: #e3f2fd;
            color: #2196F3;
            font-weight: 600;
        }
        
        /* æ—¥å†å¼æ—¥æœŸé€‰æ‹©å™¨ */
        .calendar-picker {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .calendar-header button {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .calendar-header button:hover {
            background: #f5f5f5;
        }
        
        .current-month {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .calendar-weekdays span {
            text-align: center;
            font-size: 12px;
            color: #999;
            font-weight: 500;
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            padding: 4px;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            background: #f5f5f5;
        }
        
        .calendar-day-number {
            font-size: 14px;
            font-weight: 500;
        }
        
        .calendar-day-count {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
        }
        
        .calendar-day.selected {
            background: #2196F3;
            color: white;
        }
        
        .calendar-day.selected .calendar-day-count {
            color: white;
        }
        
        .calendar-day.has-records {
            background: #f0f8ff;
        }
        
        .calendar-day.has-records.selected {
            background: #2196F3;
        }
        
        /* å®«æ ¼è§†å›¾ */
        .history-list.grid-view {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
            box-sizing: border-box;
            width: 100%;
        }
        
        .history-list.grid-view .history-card {
            padding: 15px;
            min-width: 0; /* é˜²æ­¢å†…å®¹æ’‘ç ´åˆ—å®½ */
            box-sizing: border-box;
        }

        /* ç½‘æ ¼è§†å›¾ä¸‹çš„æ—¥æœŸæ ‡é¢˜ï¼šå æ»¡æ•´è¡Œï¼Œä¸æ‚¬æµ® */
        .history-list.grid-view ~ .date-group-header,
        .history-list.grid-view .date-group-header {
            position: static;
            top: auto;
            margin: 8px 0;
            grid-column: 1 / -1;
            z-index: 1;
        }

        /* è‹¥æ—¥æœŸæ ‡é¢˜åœ¨ç½‘æ ¼å®¹å™¨å†…åˆ›å»ºï¼Œç¡®ä¿æ¨ªè·¨ä¸¤åˆ— */
        .history-list.grid-view .date-group-header {
            grid-column: 1 / -1;
        }
        
        .history-list.grid-view .history-card-thumbnail {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        /* åˆ—è¡¨è§†å›¾ */
        .history-list.list-view {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .history-list.list-view .history-card {
            display: flex;
            flex-direction: row;
            padding: 12px;
        }
        
        .history-list.list-view .history-card-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .history-card-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: contain;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .history-card-thumbnail:hover {
            border-color: #667eea;
        }
        
        /* æ–‡æœ¬é¢„è§ˆç¼©ç•¥å›¾æ ·å¼ */
        .history-card-thumbnail-text {
            width: 100%;
            min-height: 150px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-sizing: border-box;
        }
        
        .history-card-thumbnail-text:hover {
            border-color: #667eea;
            background: #f0f8ff;
        }
        
        .preview-line {
            font-size: 13px;
            color: #333;
            line-height: 1.6;
            margin: 3px 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .preview-line:first-child {
            font-weight: 500;
            color: #555;
        }
        
        .preview-line:last-child {
            color: #666;
        }
        
        /* å®«æ ¼è§†å›¾ä¸­çš„æ–‡æœ¬é¢„è§ˆ */
        .history-list.grid-view .history-card-thumbnail-text {
            min-height: 150px;
            height: 150px;
        }
        
        /* åˆ—è¡¨è§†å›¾ä¸­çš„æ–‡æœ¬é¢„è§ˆ */
        .history-list.list-view .history-card-thumbnail-text {
            width: 100px;
            min-height: 100px;
            height: 100px;
            padding: 8px;
            font-size: 11px;
        }
        
        .history-list.list-view .preview-line {
            font-size: 11px;
            line-height: 1.4;
            margin: 2px 0;
        }
        
        /* åˆ—è¡¨è§†å›¾ä¸­å¦‚æœåªæœ‰ä¸€è¡Œï¼Œå±…ä¸­æ˜¾ç¤º */
        .history-list.list-view .history-card-thumbnail-text:has(.preview-line:only-child) {
            justify-content: center;
        }
        
        .theme-dark .history-card-thumbnail-text {
            background: #2d2d2d;
            border-color: #444;
        }
        
        .theme-dark .history-card-thumbnail-text:hover {
            background: #3a3a3a;
            border-color: #667eea;
        }
        
        .theme-dark .preview-line {
            color: #e0e0e0;
        }
        
        .theme-dark .preview-line:first-child {
            color: #f0f0f0;
        }
        
        .theme-dark .preview-line:last-child {
            color: #b0b0b0;
        }
        
        .history-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .history-card-date {
            font-size: 13px;
            color: #999;
            margin-bottom: 12px;
        }
        
        .history-card-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .history-card-actions {
            display: flex;
            gap: 8px;
        }
        
        .history-card-actions .btn {
            flex: 1;
            padding: 8px;
            font-size: 13px;
        }
        
        .compare-floating-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4);
            z-index: 999;
            transition: all 0.3s ease;
        }
        
        .compare-floating-btn:active {
            transform: scale(0.95);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .empty-desc {
            font-size: 14px;
            color: #999;
        }
        
        .image-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .image-viewer-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            touch-action: none;
        }
        
        .image-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10001;
        }
        
        .image-viewer-close:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* ========== å“åº”å¼è®¾è®¡ ========== */
        @media (max-width: 768px) {
            #productManager .container {
                margin: 10px;
                padding: 15px;
            }
            
            #productManager .stats {
                flex-direction: column;
                gap: 10px;
            }
            
            #productManager .stat-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .packages-grid {
                grid-template-columns: 1fr;
            }
            
            .package-card.popular {
                transform: none;
            }
            
            .membership-status-card {
                flex-direction: column;
                text-align: center;
            }
            
            .status-info {
                margin-bottom: 15px;
            }
        }
    </style>
    
    <!-- å·²ç§»é™¤ html2canvas ä¾èµ–ï¼Œä¿å­˜å†å²é‡‡ç”¨çº¯æ–‡æœ¬ï¼Œé¿å…å¤–éƒ¨åŠ è½½è¶…æ—¶å¯¼è‡´å»¶è¿Ÿ -->
</head>
<body>
    <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
    <div class="top-header">
        <div class="page-title" id="topPageTitle">ä»·æ ¼è°ƒæ•´</div>
        <div class="header-actions">
            <button class="header-icon-btn" onclick="openCurrentPageMenu()">â‹®</button>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆªæ  -->
    <div class="bottom-nav">
        <div class="nav-item" data-tab="historyViewer" onclick="switchTab('historyViewer')">
            <div class="nav-item-icon">æ˜ç»†</div>
            <div class="nav-item-label">å†å²</div>
        </div>
        <div class="nav-item active" data-tab="productManager" onclick="switchTab('productManager')">
            <div class="nav-item-icon">äº§å“</div>
            <div class="nav-item-label">äº§å“ç®¡ç†</div>
        </div>
        <div class="nav-item center-btn" data-tab="priceAdjuster" onclick="switchTab('priceAdjuster')">
            <div class="nav-item-icon special-icon">è®°è´¦</div>
        </div>
        <div class="nav-item" data-tab="symbolChanger" onclick="switchTab('symbolChanger')">
            <div class="nav-item-icon">ç¬¦å·</div>
            <div class="nav-item-label">ç¬¦å·æ›´æ¢</div>
        </div>
        <div class="nav-item" data-tab="settings" onclick="switchTab('settings')">
            <div class="nav-item-icon">æˆ‘çš„</div>
            <div class="nav-item-label">æˆ‘çš„</div>
        </div>
    </div>
    
    <!-- ç•Œé¢1ï¼šäº§å“ç®¡ç† -->
    <div id="productManager" class="tab-content">
        <div class="container">
            <h1>äº§å“åˆ—è¡¨ç®¡ç†å™¨</h1>
            
            <div class="input-section">
                <textarea id="pm_inputText" placeholder="è¯·åœ¨æ­¤ç²˜è´´åŒ…å«äº§å“ä¿¡æ¯çš„æ–‡æœ¬..."></textarea>
            </div>
            
            <div class="action-buttons">
                <button id="pm_parseBtn">è§£ææ–‡æœ¬</button>
                <button id="pm_batchDeleteBtn" class="danger">æ‰¹é‡åˆ é™¤</button>
                <button id="pm_deleteSelectedBtn" class="danger" style="display: none;">åˆ é™¤é€‰ä¸­</button>
                <button id="pm_cancelDeleteBtn" class="secondary" style="display: none;">å–æ¶ˆ</button>
                <button id="pm_copyBtn">å¤åˆ¶ç»“æœ</button>
                <button id="pm_saveHistoryBtn" onclick="HistoryManager.showSaveDialog()" style="background: #ff6b35;">ğŸ“… ä¿å­˜å†å²</button>
            </div>
            
            <div class="sort-controls">
                <label>æ’åºæ–¹å¼ï¼š</label>
                <select id="pm_sortSelect">
                    <option value="original">åŸå§‹é¡ºåº</option>
                    <option value="priceAsc">ä»·æ ¼å‡åº</option>
                    <option value="priceDesc">ä»·æ ¼é™åº</option>
                    <option value="nameAsc">åç§°å‡åº</option>
                </select>
            </div>
            
            <div class="stats-vertical">
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_totalLines">0</div>
                    <div class="stat-label">æ€»è¡Œæ•°</div>
                </div>
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_priceLines">0</div>
                    <div class="stat-label">å«ä»·æ ¼è¡Œ</div>
                </div>
                <div class="stat-item-vertical">
                    <div class="stat-number" id="pm_textLines">0</div>
                    <div class="stat-label">çº¯æ–‡æœ¬è¡Œ</div>
                </div>
            </div>
            
            <div class="results-container" id="pm_resultsContainer"></div>
        </div>
        
        <div class="copy-success" id="pm_copySuccess">å¤åˆ¶æˆåŠŸï¼</div>
    </div>
    
    <!-- ç•Œé¢2ï¼šä»·æ ¼è°ƒæ•´ -->
    <div id="priceAdjuster" class="tab-content active">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ’° ä»·æ ¼è°ƒæ•´å™¨</h1>
                <p class="subtitle">æ™ºèƒ½è¯†åˆ«ä»·æ ¼å¹¶ç²¾å‡†è°ƒæ•´</p>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">ğŸ“ è¾“å…¥äº§å“ä¿¡æ¯</h2>
                <div class="input-area">
                    <textarea class="input-text" id="pa_productInput" placeholder="è¯·ç²˜è´´å®¢æˆ·çš„äº§å“ä¿¡æ¯..."></textarea>
                </div>
                <div style="text-align: center;">
                    <button class="btn" onclick="PriceAdjuster.parseProducts()">ğŸ” è§£æä»·æ ¼</button>
                    <button class="btn btn-success" onclick="PriceAdjuster.applyPricing()">ğŸ“ˆ åº”ç”¨è°ƒä»·</button>
                    <button class="btn" onclick="PriceAdjuster.copyResults()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                    <button class="btn" onclick="HistoryManager.showSaveDialog('priceAdjuster')" style="background: #ff6b35;">ğŸ“… ä¿å­˜å†å²</button>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">âš™ï¸ è°ƒä»·è®¾ç½®</h2>
                <div class="price-controls">
                    <div class="control-row">
                        <span class="control-label">è°ƒä»·æ–¹å¼:</span>
                        <select class="control-input" id="pa_pricingType">
                            <option value="percentage">ç™¾åˆ†æ¯”è°ƒä»·</option>
                            <option value="fixed">å›ºå®šé‡‘é¢è°ƒä»·</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">è°ƒä»·å¹…åº¦:</span>
                        <input type="number" class="control-input" id="pa_pricingValue" value="5" placeholder="5">
                        <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                    </div>
                    <div class="control-row">
                        <span class="control-label">è°ƒä»·æ–¹å‘:</span>
                        <select class="control-input" id="pa_pricingDirection">
                            <option value="increase">æ¶¨ä»·</option>
                            <option value="decrease">é™ä»·</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">ä»·æ ¼å–æ•´:</span>
                        <select class="control-input" id="pa_priceRounding">
                            <option value="none">ä¸å–æ•´</option>
                            <option value="ones" selected>ä¸ªä½å–æ•´</option>
                            <option value="tens">åä½å–æ•´</option>
                            <option value="hundreds">ç™¾ä½å–æ•´</option>
                        </select>
                    </div>
                    <div class="control-row">
                        <span class="control-label">è°ƒä»·æ¨¡å¼:</span>
                        <select class="control-input" id="pa_pricingMode" onchange="PriceAdjuster.togglePricingMode()">
                            <option value="uniform">ç»Ÿä¸€è°ƒä»·</option>
                            <option value="range" selected>åŒºé—´è°ƒä»·</option>
                        </select>
                    </div>
                    <!-- åŒºé—´è°ƒä»·è®¾ç½® -->
                    <div id="pa_rangePricingSection" style="display: block; margin-top: 3vw; padding: 3vw; background: #f0f8ff; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 2vw; font-size: 4vw;">ä»·æ ¼åŒºé—´è®¾ç½®:</div>
                        <div class="control-row">
                            <span class="control-label">0-999:</span>
                            <input type="number" class="control-input" id="pa_range0_999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">1000-1999:</span>
                            <input type="number" class="control-input" id="pa_range1000_1999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">2000-4999:</span>
                            <input type="number" class="control-input" id="pa_range2000_4999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">5000-9999:</span>
                            <input type="number" class="control-input" id="pa_range5000_9999" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                        <div class="control-row">
                            <span class="control-label">10000+:</span>
                            <input type="number" class="control-input" id="pa_range10000_plus" value="5" placeholder="5">
                            <span style="font-size: 3.5vw; margin-left: 1vw;">%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">ğŸ“Š è§£æç»“æœ <button class="btn" onclick="PriceAdjuster.copyResults()" style="float: right; font-size: 3vw; padding: 1.5vw 3vw; margin: 0;">ğŸ“‹ å¤åˆ¶</button></h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="pa_totalLines">0</div>
                        <div class="stat-label">æ€»è¡Œæ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number success" id="pa_priceLines">0</div>
                        <div class="stat-label">å«ä»·æ ¼è¡Œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number warning" id="pa_textLines">0</div>
                        <div class="stat-label">çº¯æ–‡æœ¬è¡Œ</div>
                    </div>
                </div>
                <div class="result-area" id="pa_resultArea"></div>
            </div>
        </div>
    </div>
    
    <!-- ç•Œé¢3ï¼šç¬¦å·æ›´æ¢ -->
    <div id="symbolChanger" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ”„ ç¬¦å·æ›´æ¢å™¨</h1>
                <p class="subtitle">æ‰¹é‡æ›´æ¢ä»·æ ¼å‰çš„ç¬¦å·</p>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">ğŸ“ è¾“å…¥äº§å“ä¿¡æ¯</h2>
                <div class="input-area">
                    <textarea class="input-text" id="sc_productInput" placeholder="è¯·ç²˜è´´å®¢æˆ·çš„äº§å“ä¿¡æ¯..."></textarea>
                </div>
                
                <div class="input-area" style="margin-top: 3vw;">
                    <label style="font-size: 3.5vw; color: #666; margin-bottom: 1vw; display: block;">ğŸ’° ä»·æ ¼å‰æ›¿æ¢ç¬¦å·ï¼š</label>
                    <input type="text" id="sc_priceSeparator" placeholder="è¾“å…¥æ›¿æ¢ç¬¦å·ï¼ˆå¦‚ğŸ’°ã€ã€å‘ã€‘ç­‰ï¼‰" value="" style="width: 100%; padding: 3vw; font-size: 4vw; border: 2px solid #e0e0e0; border-radius: 8px;">
                    <p style="font-size: 3vw; color: #999; margin-top: 1vw;">æç¤ºï¼šç•™ç©ºè¡¨ç¤ºä¸æ›¿æ¢ï¼Œæ”¯æŒè¡¨æƒ…ç¬¦å·</p>
                </div>
                
                <!-- ç»“å°¾è¯´æ˜è®¾ç½® -->
                <div class="input-area" style="margin-top: 3vw; padding: 3vw; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                    <div style="display: flex; align-items: center; margin-bottom: 2vw;">
                        <input type="checkbox" id="sc_enableFooter" style="margin-right: 2vw; transform: scale(1.2);">
                        <label for="sc_enableFooter" style="font-size: 3.5vw; color: #333; font-weight: 600;">è‡ªåŠ¨æ·»åŠ ç»“å°¾è¯´æ˜</label>
                    </div>
                    <textarea id="sc_footerText" placeholder="è¾“å…¥ç»“å°¾è¯´æ˜å†…å®¹..." style="width: 100%; padding: 3vw; font-size: 3.5vw; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 80px; resize: vertical;">å¹³å°ç°æŸ¥ï¼Œä»·æ ¼å¯èƒ½ä¼šæœ‰æ³¢åŠ¨ï¼Œæ„Ÿè°¢ç†è§£ï¼éƒ¨åˆ†äº§å“ç§èŠè¯¢ä»·ä¸‹å•ï¼ŒæœŸå¾…åˆä½œ[æ¡æ‰‹]</textarea>
                    <p style="font-size: 3vw; color: #999; margin-top: 1vw;">æç¤ºï¼šå‹¾é€‰åï¼Œæ­¤å†…å®¹å°†è‡ªåŠ¨æ·»åŠ åˆ°æ–‡ç« æœ«å°¾ã€‚</p>
                </div>
                
                <div style="text-align: center;">
                    <button class="btn" onclick="SymbolChanger.parseProducts()">ğŸ” è§£æä»·æ ¼</button>
                    <button class="btn btn-primary" onclick="SymbolChanger.applyPriceSeparator()" style="margin-top: 2vw;">âœ¨ åº”ç”¨æ›´æ¢</button>
                    <button class="btn btn-success" onclick="SymbolChanger.copyResults()" style="margin-top: 2vw;">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                    <button class="btn" onclick="HistoryManager.showSaveDialog('symbolChanger')" style="background: #ff6b35; margin-top: 2vw;">ğŸ“… ä¿å­˜å†å²</button>
                </div>
            </div>
            
            <div class="test-section">
                <h2 class="test-title">ğŸ“Š è§£æç»“æœ <button class="btn" onclick="SymbolChanger.copyResults()" style="float: right; font-size: 3vw; padding: 1.5vw 3vw; margin: 0;">ğŸ“‹ å¤åˆ¶</button></h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="sc_totalLines">0</div>
                        <div class="stat-label">æ€»è¡Œæ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number success" id="sc_priceLines">0</div>
                        <div class="stat-label">å«ä»·æ ¼è¡Œ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number warning" id="sc_textLines">0</div>
                        <div class="stat-label">çº¯æ–‡æœ¬è¡Œ</div>
                    </div>
                </div>
                <div class="result-area" id="sc_resultArea"></div>
            </div>
        </div>
    </div>
    
    <!-- ç•Œé¢4ï¼šä¼šå‘˜ä¸­å¿ƒ -->
    <div id="membership" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ‘‘ ä¼šå‘˜ä¸­å¿ƒ</h1>
                <p class="subtitle">è§£é”æ›´å¤šåŠŸèƒ½ï¼Œäº«å—ä¸“ä¸šæœåŠ¡</p>
            </div>
            
            <!-- ä¼šå‘˜çŠ¶æ€å¡ç‰‡ -->
            <div class="membership-status-card" id="membershipStatusCard">
                <div class="status-info">
                    <div class="status-icon">ğŸ‘‘</div>
                    <div class="status-text">
                        <h3 id="membershipStatus">å…è´¹ç”¨æˆ·</h3>
                        <p id="membershipExpiry">ç«‹å³å¼€é€šä¼šå‘˜ï¼Œäº«å—æ›´å¤šåŠŸèƒ½</p>
                    </div>
                </div>
                <div class="status-actions">
                    <button class="btn btn-primary" onclick="Membership.showPurchaseModal()">å¼€é€šä¼šå‘˜</button>
                </div>
            </div>
            
            <!-- ä¼šå‘˜å¥—é¤é€‰æ‹© -->
            <div class="membership-packages" id="membershipPackages" style="display: none;">
                <h2 class="section-title">é€‰æ‹©ä¼šå‘˜å¥—é¤</h2>
                <div class="packages-grid">
                    <!-- æœˆåº¦å¥—é¤ -->
                    <div class="package-card" data-package="monthly">
                        <div class="package-header">
                            <h3>æœˆåº¦ä¼šå‘˜</h3>
                            <div class="package-price">
                                <span class="price-new">Â¥19</span>
                                <span class="price-original">Â¥33</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>âœ… 30å¤©ä¼šå‘˜æƒç›Š</p>
                            <p>âœ… æ— é™åˆ¶ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½</p>
                            <p>âœ… ä¼˜å…ˆå®¢æœæ”¯æŒ</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('monthly')">ç«‹å³è´­ä¹°</button>
                    </div>
                    
                    <!-- åŠå¹´å¥—é¤ -->
                    <div class="package-card popular" data-package="halfyear">
                        <div class="popular-badge">æœ€åˆ’ç®—</div>
                        <div class="package-header">
                            <h3>åŠå¹´ä¼šå‘˜</h3>
                            <div class="package-price">
                                <span class="price-new">Â¥99</span>
                                <span class="price-original">Â¥198</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>âœ… 120å¤©ä¼šå‘˜æƒç›Šï¼ˆä¹°3é€3ï¼‰</p>
                            <p>âœ… æ— é™åˆ¶ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½</p>
                            <p>âœ… ä¼˜å…ˆå®¢æœæ”¯æŒ</p>
                            <p>âœ… ä¸“å±ä¼šå‘˜æ ‡è¯†</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('halfyear')">ç«‹å³è´­ä¹°</button>
                    </div>
                    
                    <!-- å¹´åº¦å¥—é¤ -->
                    <div class="package-card" data-package="yearly">
                        <div class="package-header">
                            <h3>å¹´åº¦ä¼šå‘˜</h3>
                            <div class="package-price">
                                <span class="price-new">Â¥188</span>
                                <span class="price-original">Â¥396</span>
                            </div>
                        </div>
                        <div class="package-features">
                            <p>âœ… 360å¤©ä¼šå‘˜æƒç›Šï¼ˆä¹°6é€6ï¼‰</p>
                            <p>âœ… æ— é™åˆ¶ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½</p>
                            <p>âœ… ä¼˜å…ˆå®¢æœæ”¯æŒ</p>
                            <p>âœ… ä¸“å±ä¼šå‘˜æ ‡è¯†</p>
                            <p>âœ… æ¨èå¥–åŠ±ç‰¹æƒ</p>
                        </div>
                        <button class="btn btn-package" onclick="Membership.selectPackage('yearly')">ç«‹å³è´­ä¹°</button>
                    </div>
                </div>
            </div>
            
            <!-- æ¨èç³»ç»Ÿ -->
            <div class="referral-section">
                <h2 class="section-title">æ¨èå¥½å‹</h2>
                <div class="referral-card">
                    <div class="referral-info">
                        <h3>æˆ‘çš„æ¨èç </h3>
                        <div class="referral-code">
                            <input type="text" id="myReferralCode" readonly>
                            <button class="btn btn-small" onclick="Membership.copyReferralCode()">å¤åˆ¶</button>
                        </div>
                        <p class="referral-desc">å¥½å‹ä½¿ç”¨æ‚¨çš„æ¨èç æ³¨å†Œï¼ŒåŒæ–¹éƒ½èƒ½è·å¾—ä¼šå‘˜å¤©æ•°å¥–åŠ±ï¼</p>
                    </div>
                </div>
                
                <div class="referral-input">
                    <h3>è¾“å…¥æ¨èç </h3>
                    <div class="referral-code-input">
                        <input type="text" id="referralCodeInput" placeholder="è¯·è¾“å…¥æ¨èç ">
                        <button class="btn btn-primary" onclick="Membership.applyReferralCode()">ä½¿ç”¨æ¨èç </button>
                    </div>
                </div>
            </div>
            
            <!-- ä¼šå‘˜ç‰¹æƒè¯´æ˜ -->
            <div class="member-benefits">
                <h2 class="section-title">ä¼šå‘˜ç‰¹æƒ</h2>
                <div class="benefits-grid">
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸš€</div>
                        <h4>æ— é™åˆ¶ä½¿ç”¨</h4>
                        <p>è§£é™¤æ‰€æœ‰åŠŸèƒ½é™åˆ¶ï¼Œç•…äº«å®Œæ•´ä½“éªŒ</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">âš¡</div>
                        <h4>ä¼˜å…ˆå¤„ç†</h4>
                        <p>äº«å—æ›´å¿«çš„å¤„ç†é€Ÿåº¦å’Œä¼˜å…ˆå®¢æœ</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ</div>
                        <h4>æ¨èå¥–åŠ±</h4>
                        <p>æ¨èå¥½å‹è·å¾—é¢å¤–ä¼šå‘˜å¤©æ•°å¥–åŠ±</p>
                    </div>
                    <div class="benefit-item">
                        <div class="benefit-icon">ğŸ’</div>
                        <h4>ä¸“å±æ ‡è¯†</h4>
                        <p>æ˜¾ç¤ºä¸“å±ä¼šå‘˜æ ‡è¯†ï¼Œå½°æ˜¾èº«ä»½</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç•Œé¢5ï¼šå†å²è®°å½• -->
    <div id="historyViewer" class="tab-content">
        <div class="container">
            <div class="header" style="position: relative;">
                <h1 class="title">ğŸ“… å†å²è®°å½•</h1>
                <p class="subtitle">æŸ¥çœ‹å’Œå¯¹æ¯”å†å²æŠ¥ä»·</p>
                
                <!-- è§†å›¾åˆ‡æ¢å™¨ -->
                <div class="view-switcher">
                    <button class="view-btn active" data-view="grid" onclick="HistoryManager.switchView('grid')">
                        <span class="icon">âŠ</span>
                    </button>
                    <button class="view-btn" data-view="list" onclick="HistoryManager.switchView('list')">
                        <span class="icon">â˜°</span>
                    </button>
                </div>
            </div>
            
            <!-- æ¥æºç­›é€‰æ ‡ç­¾æ  -->
            <div class="history-filter-tabs">
                <button class="filter-tab active" data-filter="all" onclick="HistoryManager.filterBySource('all')">
                    â­ å…¨éƒ¨
                </button>
                <button class="filter-tab" data-filter="productManager" onclick="HistoryManager.filterBySource('productManager')">
                    ğŸ“¦ äº§å“ç®¡ç†
                </button>
                <button class="filter-tab" data-filter="priceAdjuster" onclick="HistoryManager.filterBySource('priceAdjuster')">
                    ğŸ’° ä»·æ ¼è°ƒæ•´
                </button>
                <button class="filter-tab" data-filter="symbolChanger" onclick="HistoryManager.filterBySource('symbolChanger')">
                    ğŸ”„ ç¬¦å·æ›´æ¢
                </button>
            </div>
            
            <!-- æ—¥å†å¼æ—¥æœŸé€‰æ‹©å™¨ -->
            <div class="calendar-picker">
                <div class="calendar-header">
                    <button class="prev-month" onclick="HistoryManager.changeMonth(-1)">â€¹</button>
                    <span class="current-month" id="calendarCurrentMonth">2025 / 10</span>
                    <button class="next-month" onclick="HistoryManager.changeMonth(1)">â€º</button>
                </div>
                <div class="calendar-weekdays">
                    <span>æ—¥</span><span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span>
                </div>
                <div class="calendar-days" id="calendarDays">
                    <!-- åŠ¨æ€ç”Ÿæˆæ—¥æœŸæ ¼å­ -->
                </div>
            </div>
            
            <!-- ç­›é€‰å·¥å…·æ  -->
            <div class="history-filter-bar" style="display: none;">
                <div class="filter-row">
                    <label>å¹´ä»½ï¼š</label>
                    <select id="historyYearSelect">
                        <option value="all">å…¨éƒ¨</option>
                    </select>
                </div>
                <div class="filter-row">
                    <label>æœˆä»½ï¼š</label>
                    <select id="historyMonthSelect">
                        <option value="all">å…¨éƒ¨</option>
                        <option value="1">1æœˆ</option>
                        <option value="2">2æœˆ</option>
                        <option value="3">3æœˆ</option>
                        <option value="4">4æœˆ</option>
                        <option value="5">5æœˆ</option>
                        <option value="6">6æœˆ</option>
                        <option value="7">7æœˆ</option>
                        <option value="8">8æœˆ</option>
                        <option value="9">9æœˆ</option>
                        <option value="10">10æœˆ</option>
                        <option value="11">11æœˆ</option>
                        <option value="12">12æœˆ</option>
                    </select>
                </div>
                <div class="filter-row">
                    <button class="btn btn-secondary" onclick="HistoryManager.filterRecords()">ç­›é€‰</button>
                    <button class="btn" onclick="HistoryManager.clearFilter()">é‡ç½®</button>
                </div>
            </div>
            
            <!-- æ“ä½œå·¥å…·æ  -->
            <div class="history-actions">
                <button class="btn btn-primary" onclick="HistoryManager.enterCompareMode()">é€‰æ‹©å¯¹æ¯”</button>
                <button class="btn btn-danger" onclick="HistoryManager.deleteAll()" style="display: none;">æ¸…ç©ºå†å²</button>
            </div>
            
            <!-- å†å²è®°å½•åˆ—è¡¨ -->
            <div class="history-list grid-view" id="historyListContainer">
                <!-- ç©ºçŠ¶æ€æç¤º -->
                <div class="empty-state" id="historyEmptyState">
                    <div class="empty-icon">ğŸ“…</div>
                    <div class="empty-title">æš‚æ— å†å²è®°å½•</div>
                    <div class="empty-desc">åœ¨äº§å“ç®¡ç†ç•Œé¢ä¿å­˜è®°å½•åï¼Œå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
                </div>
            </div>
            
            <!-- å¯¹æ¯”æ¨¡å¼æµ®åŠ¨æŒ‰é’® -->
            <button class="compare-floating-btn" id="compareFloatingBtn" style="display: none;" onclick="HistoryManager.startCompare()">
                å¼€å§‹å¯¹æ¯”ï¼ˆ<span id="compareCount">0</span>ï¼‰
            </button>
        </div>
    </div>
    
    <!-- ç•Œé¢6ï¼šæˆ‘çš„ï¼ˆæ•´åˆä¼šå‘˜ã€ç™»å½•ã€å¸®åŠ©ã€è®¾ç½®ï¼‰ -->
    <div id="settings" class="tab-content">
        <div class="container">
            <div class="header">
                <h1 class="title">ğŸ‘¤ æˆ‘çš„</h1>
                <p class="subtitle">ä¸ªäººä¸­å¿ƒ</p>
            </div>
            
            <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
            <div class="user-info-card" id="userInfoCard">
                <div class="user-avatar">ğŸ‘¤</div>
                <div class="user-details">
                    <h3 id="userName">æœªç™»å½•</h3>
                    <p id="userStatus">ç‚¹å‡»ç™»å½•äº«å—æ›´å¤šåŠŸèƒ½</p>
                </div>
                <div class="login-buttons" id="loginButtons">
                    <button class="btn btn-primary" onclick="Settings.handlePhoneLogin()" id="phoneLoginBtn">ğŸ“± ç™»å½•</button>
                </div>
            </div>
            
            <!-- å¿«æ·åŠŸèƒ½åŒº -->
            <div class="settings-sections">
                <!-- ä¼šå‘˜ä¸­å¿ƒ -->
                <div class="settings-section">
                    <h3 class="section-title">ğŸ‘‘ ä¼šå‘˜ä¸å¢å€¼</h3>
                    <div class="setting-item">
                        <span>ä¼šå‘˜ä¸­å¿ƒ</span>
                        <button class="btn btn-small" onclick="switchTab('membership')">å‰å¾€</button>
                    </div>
                    <div class="setting-item">
                        <span>ä¼šå‘˜çŠ¶æ€</span>
                        <span id="membershipStatusInSettings" style="color: #999;">å…è´¹ç”¨æˆ·</span>
                    </div>
                </div>
                
                <!-- å¸®åŠ©ä¸æ”¯æŒ -->
                <div class="settings-section">
                    <h3 class="section-title">ğŸ“š å¸®åŠ©ä¸æ”¯æŒ</h3>
                    <div class="setting-item">
                        <span>ä½¿ç”¨å¸®åŠ©</span>
                        <button class="btn btn-secondary" onclick="Settings.showHelp()">æŸ¥çœ‹</button>
                    </div>
                    <div class="setting-item">
                        <span>æ„è§åé¦ˆ</span>
                        <button class="btn btn-secondary" onclick="Settings.showFeedback()">æäº¤</button>
                    </div>
                </div>
                
                <!-- å¤–è§‚è®¾ç½® -->
                <div class="settings-section">
                    <h3 class="section-title">ğŸ¨ å¤–è§‚è®¾ç½®</h3>
                    <div class="setting-item">
                        <label>ä¸»é¢˜æ¨¡å¼</label>
                        <select id="themeSelect" onchange="Settings.changeTheme()">
                            <option value="light">æµ…è‰²æ¨¡å¼</option>
                            <option value="dark">æ·±è‰²æ¨¡å¼</option>
                            <option value="auto">è·Ÿéšç³»ç»Ÿ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>å­—ä½“å¤§å°</label>
                        <select id="fontSizeSelect" onchange="Settings.changeFontSize()">
                            <option value="small">å°</option>
                            <option value="medium" selected>ä¸­</option>
                            <option value="large">å¤§</option>
                            <option value="extra-large">è¶…å¤§</option>
                        </select>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½è®¾ç½® -->
                <div class="settings-section">
                    <h3 class="section-title">ğŸ”§ åŠŸèƒ½è®¾ç½®</h3>
                    <div class="setting-item">
                        <label>è‡ªåŠ¨ä¿å­˜</label>
                        <label class="switch">
                            <input type="checkbox" id="autoSave" checked onchange="Settings.toggleAutoSave()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>ä»·æ ¼è¯†åˆ«æç¤º</label>
                        <label class="switch">
                            <input type="checkbox" id="priceHint" checked onchange="Settings.togglePriceHint()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>éœ‡åŠ¨åé¦ˆ</label>
                        <label class="switch">
                            <input type="checkbox" id="vibration" onchange="Settings.toggleVibration()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                
                <!-- æ•°æ®ç®¡ç† -->
                <div class="settings-section">
                    <h3 class="section-title">ğŸ“Š æ•°æ®ç®¡ç†</h3>
                    <div class="setting-item">
                        <label>å¯¼å‡ºæ•°æ®</label>
                        <button class="btn btn-secondary" onclick="Settings.exportData()">å¯¼å‡º</button>
                    </div>
                    <div class="setting-item">
                        <label>å¯¼å…¥æ•°æ®</label>
                        <input type="file" id="importFile" accept=".json" onchange="Settings.importData()" style="display: none;">
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">å¯¼å…¥</button>
                    </div>
                    <div class="setting-item">
                        <label>æ¸…é™¤æ•°æ®</label>
                        <button class="btn btn-danger" onclick="Settings.clearData()">æ¸…é™¤</button>
                    </div>
                </div>
                
                <!-- å…³äºæˆ‘ä»¬ -->
                <div class="settings-section">
                    <h3 class="section-title">â„¹ï¸ å…³äºæˆ‘ä»¬</h3>
                    <div class="about-info">
                        <p><strong>å®¶ç”µæŠ¥ä»·åŠ©æ‰‹</strong></p>
                        <p>ç‰ˆæœ¬ï¼š1.0.0</p>
                        <p>ä¸“ä¸ºå®¶ç”µè¡Œä¸šæ‰“é€ çš„æ™ºèƒ½æŠ¥ä»·å·¥å…·</p>
                        <div class="contact-links">
                            <button class="btn btn-link" onclick="Settings.showFeedback()">æ„è§åé¦ˆ</button>
                            <button class="btn btn-link" onclick="Settings.showHelp()">ä½¿ç”¨å¸®åŠ©</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç”¨æˆ·ç™»å½•</h2>
                <span class="close" onclick="Settings.closeLoginModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å</label>
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="rememberMe">
                            <span class="checkmark"></span>
                            è®°ä½æˆ‘
                        </label>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ç™»å½•</button>
                        <button type="button" class="btn btn-secondary" onclick="Settings.showRegisterModal()">æ³¨å†Œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç”¨æˆ·æ³¨å†Œ</h2>
                <span class="close" onclick="Settings.closeRegisterModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="regUsername">ç”¨æˆ·å</label>
                        <input type="text" id="regUsername" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">å¯†ç </label>
                        <input type="password" id="regPassword" placeholder="è¯·è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                        <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                    </div>
                    <div class="form-group">
                        <label for="regEmail">é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="email" id="regEmail" placeholder="è¯·è¾“å…¥é‚®ç®±">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">æ³¨å†Œ</button>
                        <button type="button" class="btn btn-secondary" onclick="Settings.showLoginModal()">è¿”å›ç™»å½•</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- é˜¿é‡Œäº‘å·ç è®¤è¯ H5 SDK - ä½¿ç”¨å®˜æ–¹CDN -->
    <script type="text/javascript" charset="utf-8" src="https://g.alicdn.com/dingding/h5-phone-number-verification/1.0.0/numberAuth-web-sdk.js" 
            onload="console.log('é˜¿é‡Œäº‘SDKåŠ è½½æˆåŠŸï¼ŒPhoneNumberServer:', typeof PhoneNumberServer)" 
            onerror="console.log('é˜¿é‡Œäº‘SDKåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨é“¾æ¥')"></script>
    
    <!-- å¤‡ç”¨SDKé“¾æ¥ - ä½¿ç”¨ä¸åŒçš„CDN -->
    <script type="text/javascript" charset="utf-8" src="https://g.alicdn.com/dingding/h5-phone-number-verification/latest/numberAuth-web-sdk.js" 
            onload="console.log('å¤‡ç”¨SDKåŠ è½½æˆåŠŸï¼ŒPhoneNumberServer:', typeof PhoneNumberServer)" 
            onerror="console.log('å¤‡ç”¨SDKä¹ŸåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼')"></script>
    
    <!-- å¦‚æœSDKåŠ è½½å¤±è´¥ï¼Œæä¾›æ¨¡æ‹Ÿå®ç° -->
    <script>
        // å¦‚æœSDKåŠ è½½å¤±è´¥ï¼Œæä¾›æ¨¡æ‹Ÿå®ç°
        if (typeof PhoneNumberServer === 'undefined') {
            console.log('SDKåŠ è½½å¤±è´¥ï¼Œåˆ›å»ºæ¨¡æ‹ŸPhoneNumberServer');
            window.PhoneNumberServer = function() {
                this.checkLoginAvailable = function(options) {
                    console.log('æ¨¡æ‹ŸcheckLoginAvailableè¢«è°ƒç”¨');
                    if (options.success) {
                        options.success({ code: 600000, message: 'æ¨¡æ‹Ÿé‰´æƒæˆåŠŸ' });
                    }
                };
                this.getLoginToken = function(options) {
                    console.log('æ¨¡æ‹ŸgetLoginTokenè¢«è°ƒç”¨');
                    if (options.success) {
                        options.success({ spToken: 'mock_sp_token_' + Date.now() });
                    }
                };
            };
            console.log('æ¨¡æ‹ŸPhoneNumberServerå·²åˆ›å»º');
        }
    </script>
    
    <script>
        // ========== é˜¿é‡Œäº‘å·ç è®¤è¯é…ç½® ==========
        const ALIYUN_CONFIG = {
            sceneCode: 'FC220000012450005', // æ‚¨çš„æ–¹æ¡ˆ Code
            // ç”Ÿäº§æ¨¡å¼ï¼šå¯ç”¨çœŸå®çš„é˜¿é‡Œäº‘å·ç è®¤è¯
            isDevelopment: false
        };
        
        // ========== é¡µé¢åŠ è½½å®Œæˆåçš„SDKæ£€æŸ¥ ==========
        window.addEventListener('load', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œæ£€æŸ¥SDKçŠ¶æ€...');
            console.log('PhoneNumberServer:', typeof PhoneNumberServer);
            console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
            
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿SDKæœ‰æ—¶é—´åŠ è½½
            setTimeout(function() {
                console.log('å»¶è¿Ÿæ£€æŸ¥SDKçŠ¶æ€...');
                console.log('PhoneNumberServer:', typeof PhoneNumberServer);
                console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
            }, 2000);
        });
        
        // ========== ä¼šå‘˜æƒé™æ£€æŸ¥ç³»ç»Ÿ ==========
        function checkMembershipStatus() {
            // ä»ä¼šå‘˜ç³»ç»Ÿè·å–çŠ¶æ€
            return Membership && Membership.isMember ? Membership.isMember() : false;
        }
        
        function updateMembershipBadge() {
            const badge = document.getElementById('membershipStatusBadge');
            if (checkMembershipStatus()) {
                badge.style.display = 'inline-block';
                badge.textContent = 'ğŸ‘‘ ä¼šå‘˜';
            } else {
                badge.style.display = 'none';
            }
        }
        
        function showMembershipUpgradePrompt(featureName) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    padding: 30px;
                    border-radius: 12px;
                    text-align: center;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ”’</div>
                    <h3 style="margin: 0 0 8px 0; color: #2c3e50;">${featureName}</h3>
                    <p style="margin: 0 0 24px 0; color: #7f8c8d;">æ­¤åŠŸèƒ½ä¸ºä¼šå‘˜ä¸“äº«ï¼Œç«‹å³å¼€é€šäº«å—æ›´å¤šç‰¹æƒï¼</p>
                    <button class="membership-upgrade-btn" onclick="Membership.showPurchaseModal(); this.closest('.modal')?.remove();">
                        ç«‹å³å¼€é€šä¼šå‘˜
                    </button>
                    <button onclick="this.closest('.modal')?.remove();" style="
                        background: #95a5a6;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        margin-left: 12px;
                        cursor: pointer;
                    ">å–æ¶ˆ</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function createMembershipOverlay(featureName) {
            const overlay = document.createElement('div');
            overlay.className = 'membership-overlay';
            overlay.innerHTML = `
                <div class="membership-lock-icon">ğŸ”’</div>
                <div class="membership-lock-title">${featureName}</div>
                <div class="membership-lock-desc">æ­¤åŠŸèƒ½ä¸ºä¼šå‘˜ä¸“äº«<br>ç«‹å³å¼€é€šäº«å—æ›´å¤šç‰¹æƒï¼</div>
                <button class="membership-upgrade-btn" onclick="Membership.showPurchaseModal()">
                    ç«‹å³å¼€é€šä¼šå‘˜
                </button>
            `;
            return overlay;
        }
        
        // ========== å„æ¨¡å—ä¼šå‘˜é™åˆ¶åˆå§‹åŒ–å‡½æ•° ==========
        function initProductManagerRestrictions() {
            const container = document.getElementById('productManager').querySelector('.container');
            if (!checkMembershipStatus()) {
                // å¦‚æœå·²ç»æœ‰é®ç½©å±‚ï¼Œå…ˆç§»é™¤
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
                
                // æ·»åŠ é®ç½©å±‚
                const overlay = createMembershipOverlay('äº§å“ç®¡ç†');
                container.appendChild(overlay);
            } else {
                // ä¼šå‘˜ç”¨æˆ·ï¼Œç§»é™¤é®ç½©å±‚
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
            }
        }
        
        function initPriceAdjusterRestrictions() {
            const container = document.getElementById('priceAdjuster').querySelector('.container');
            
            // ä»·æ ¼å–æ•´é€‰é¡¹é™åˆ¶
            const priceRoundingSelect = document.getElementById('pa_priceRounding');
            const priceRoundingLabel = priceRoundingSelect.previousElementSibling;
            
            // è°ƒä»·æ¨¡å¼é€‰é¡¹é™åˆ¶
            const pricingModeSelect = document.getElementById('pa_pricingMode');
            const pricingModeLabel = pricingModeSelect.previousElementSibling;
            
            if (!checkMembershipStatus()) {
                // éä¼šå‘˜ï¼šç¦ç”¨é«˜çº§é€‰é¡¹
                priceRoundingSelect.disabled = true;
                priceRoundingLabel.classList.add('membership-restricted');
                
                // éšè—åŒºé—´è°ƒä»·é€‰é¡¹
                const rangeOption = pricingModeSelect.querySelector('option[value="range"]');
                if (rangeOption) {
                    rangeOption.style.display = 'none';
                }
                pricingModeSelect.value = 'uniform';
                pricingModeSelect.disabled = true;
                pricingModeLabel.classList.add('membership-restricted');
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ˜¾ç¤ºå‡çº§æç¤º
                priceRoundingSelect.addEventListener('click', function() {
                    if (this.disabled) {
                        showMembershipUpgradePrompt('ä»·æ ¼å–æ•´åŠŸèƒ½');
                    }
                });
                
                pricingModeSelect.addEventListener('click', function() {
                    if (this.disabled) {
                        showMembershipUpgradePrompt('åŒºé—´è°ƒä»·åŠŸèƒ½');
                    }
                });
            } else {
                // ä¼šå‘˜ï¼šå¯ç”¨æ‰€æœ‰é€‰é¡¹
                priceRoundingSelect.disabled = false;
                priceRoundingLabel.classList.remove('membership-restricted');
                
                const rangeOption = pricingModeSelect.querySelector('option[value="range"]');
                if (rangeOption) {
                    rangeOption.style.display = 'block';
                }
                pricingModeSelect.disabled = false;
                pricingModeLabel.classList.remove('membership-restricted');
            }
        }
        
        function initSymbolChangerRestrictions() {
            const container = document.getElementById('symbolChanger').querySelector('.container');
            if (!checkMembershipStatus()) {
                // å¦‚æœå·²ç»æœ‰é®ç½©å±‚ï¼Œå…ˆç§»é™¤
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
                
                // æ·»åŠ é®ç½©å±‚
                const overlay = createMembershipOverlay('ç¬¦å·æ›´æ¢');
                container.appendChild(overlay);
            } else {
                // ä¼šå‘˜ç”¨æˆ·ï¼Œç§»é™¤é®ç½©å±‚
                const existingOverlay = container.querySelector('.membership-overlay');
                if (existingOverlay) {
                    existingOverlay.remove();
                }
            }
        }

        // ========== Tabåˆ‡æ¢é€»è¾‘ ==========
        document.addEventListener('DOMContentLoaded', function() {
            const tabItems = document.querySelectorAll('.tab-item');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // æ£€æŸ¥ä¼šå‘˜æƒé™
                    if (targetTab === 'productManager' || targetTab === 'symbolChanger') {
                        if (!checkMembershipStatus()) {
                            showMembershipUpgradePrompt(targetTab === 'productManager' ? 'äº§å“ç®¡ç†' : 'ç¬¦å·æ›´æ¢');
                            return;
                        }
                    }
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabItems.forEach(tab => tab.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰é¡¹
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // åˆå§‹åŒ–å¯¹åº”æ¨¡å—çš„ä¼šå‘˜é™åˆ¶
                    if (targetTab === 'productManager') {
                        initProductManagerRestrictions();
                    } else if (targetTab === 'priceAdjuster') {
                        initPriceAdjusterRestrictions();
                    } else if (targetTab === 'symbolChanger') {
                        initSymbolChangerRestrictions();
                    }
                });
            });
            
            // åˆå§‹åŒ–å„ä¸ªç•Œé¢
            ProductManager.init();
            PriceAdjuster.init();
            SymbolChanger.init();
            
            // åˆå§‹åŒ–ä»·æ ¼è°ƒæ•´çš„ä¼šå‘˜é™åˆ¶ï¼ˆå› ä¸ºé»˜è®¤æ˜¾ç¤ºä»·æ ¼è°ƒæ•´ç•Œé¢ï¼‰
            initPriceAdjusterRestrictions();
            
            // æ›´æ–°ä¼šå‘˜çŠ¶æ€å¾½ç« 
            updateMembershipBadge();
        });
        
        // ========== ç•Œé¢1ï¼šäº§å“ç®¡ç† JavaScript ==========
        const ProductManager = (function() {
            let parsedItems = [];
            let batchDeleteMode = false;
            
            function init() {
                const parseBtn = document.getElementById('pm_parseBtn');
                const batchDeleteBtn = document.getElementById('pm_batchDeleteBtn');
                const deleteSelectedBtn = document.getElementById('pm_deleteSelectedBtn');
                const cancelDeleteBtn = document.getElementById('pm_cancelDeleteBtn');
                const copyBtn = document.getElementById('pm_copyBtn');
                const sortSelect = document.getElementById('pm_sortSelect');
                const inputText = document.getElementById('pm_inputText');
                
                parseBtn.addEventListener('click', parseText);
                batchDeleteBtn.addEventListener('click', enterBatchDeleteMode);
                deleteSelectedBtn.addEventListener('click', deleteSelectedItems);
                cancelDeleteBtn.addEventListener('click', exitBatchDeleteMode);
                copyBtn.addEventListener('click', copyResults);
                sortSelect.addEventListener('change', sortAndDisplayItems);
                inputText.addEventListener('keydown', handleEnterKey);
            }
            
            function handleEnterKey(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    parseText();
                }
            }
            
            function parseText() {
                const text = document.getElementById('pm_inputText').value.trim();
                if (!text) return;
                
                const lines = text.split('\n');
                parsedItems = [];
                
                lines.forEach((line, index) => {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) return;
                    
                    const result = parseProducts(trimmedLine);
                    
                    if (result && result.hasPrice && result.prices && result.prices.length > 0) {
                        // æœ‰ä»·æ ¼çš„äº§å“
                        parsedItems.push({
                            id: index,
                            originalLine: trimmedLine,
                            name: result.content || 'æœªçŸ¥äº§å“',
                            price: result.prices[0].price,
                            hasPrice: true,
                            selected: false
                        });
                    } else {
                        // æ— ä»·æ ¼çš„è¡Œ
                        parsedItems.push({
                            id: index,
                            originalLine: trimmedLine,
                            name: trimmedLine,
                            price: null,
                            hasPrice: false,
                            selected: false
                        });
                    }
                });
                
                updateStats();
                sortAndDisplayItems();
            }
            
            function parseProducts(line) {
                // ä½¿ç”¨ä»·æ ¼è°ƒæ•´ç•Œé¢çš„é«˜ç²¾åº¦ç®—æ³•
                return purePriceParse(line);
            }
            
            // çº¯ä»·æ ¼è§£æ - é«˜å‡†ç¡®ç‡ç‰ˆæœ¬ï¼ˆä»ä»·æ ¼è°ƒæ•´ç•Œé¢å¤åˆ¶ï¼‰
            function purePriceParse(line) {
                // è·³è¿‡æ˜æ˜¾çš„éäº§å“è¡Œ
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text',
                        debug: { method: 'non-product' }
                    };
                }
                
                // å¯»æ‰¾æ‰€æœ‰ä»·æ ¼
                let allPrices = [];
                
                // ç¬¬ä¸€æ­¥ï¼šå¯»æ‰¾æ˜ç¡®çš„ä»·æ ¼æ ‡è¯†
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                // ç¬¬äºŒæ­¥ï¼šå¯»æ‰¾ä¸Šä¸‹æ–‡ä»·æ ¼
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                // å»é‡å¹¶æ’åº
                allPrices = removeDuplicatePrices(allPrices);
                
                // åªé€‰æ‹©æœ€é åçš„ä¸€ä¸ªä»·æ ¼
                if (allPrices.length > 0) {
                    // æŒ‰ä½ç½®æ’åºï¼Œé€‰æ‹©æœ€é åçš„
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]]; // åªå–æœ€é åçš„ä¸€ä¸ª
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product',
                        debug: { method: 'single-price', count: 1 }
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text',
                    debug: { method: 'no-price' }
                };
            }
            
            // éäº§å“è¡Œè¿‡æ»¤å‡½æ•°ï¼ˆä»ä»·æ ¼è°ƒæ•´ç•Œé¢å¤åˆ¶ï¼‰
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^â€”â€”â€”â€”+$/, 
                    /^\[çº¢åŒ…\].*\[çº¢åŒ…\]$/,
                    /^[\s\-_=]+$/,
                    /å¹³å°ç°æŸ¥|ä»·æ ¼å¯èƒ½ä¼šæ³¢åŠ¨/,
                    /å…¨å›½åŒ…é‚®|æ·±åœ³|æ²³æº|æƒ å·/,
                    /ç°è´§ç§’å‘|å…¶ä»–æœºå‹è¯¢ä»·/,
                    /æ›´å¤šå…¶ä»–å“ç‰Œå‹å·/,
                    /å¤‡æ³¨ï¼š|ä»¥ä¸Šå‡ æ¬¾|ä»¥å®é™…å¼€å•ä¸ºå‡†/,
                    /^\.+$/,
                    /^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+ã€/,
                    /æˆ‘å¸äº§å“å¯å¼€ç¥¨/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                
                // è´§å¸ç¬¦å·ä»·æ ¼
                let currencyPattern = /[Â¥$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                // å¸¦å•ä½çš„ä»·æ ¼
                let unitPattern = /(\d+(?:\.\d+)?)\s*(å…ƒ|å—|å°|å¤š|èµ·|é™|ç‰¹)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // å¸¦è¡¨æƒ…ç¬¦å·çš„ä»·æ ¼è¯†åˆ«å·²ç§»é™¤ï¼Œé¿å…6XXXä»·æ ¼è¯†åˆ«é”™è¯¯
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                
                // ä»åå¾€å‰å¯»æ‰¾ä»·æ ¼ - ä¼˜å…ˆè¯†åˆ«è¡Œæœ«çš„ä»·æ ¼
                const numbers = line.match(/\d{3,}/g);
                if (!numbers) return prices;
                
                // ä¿®å¤ä½ç½®è®¡ç®—ï¼šä½¿ç”¨æ­£åˆ™çš„match.indexç²¾ç¡®å®šä½ï¼Œé¿å…lastIndexOfæ­§ä¹‰
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                // æŒ‰ä½ç½®ä»åå¾€å‰æ’åº
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) { // é™åˆ¶åœ¨199-99999ä¹‹é—´
                        // æ£€æŸ¥ä¸Šä¸‹æ–‡ï¼ˆä½ç½®å› ç´ å·²åœ¨getPriceContextä¸­è€ƒè™‘ï¼‰
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        
                        // ä½¿ç”¨getPriceContextè¿”å›çš„ç½®ä¿¡åº¦
                        let confidence = context.confidence;
                        
                        // æ£€æŸ¥æ˜¯å¦åœ¨æ–œæ åï¼ˆé€šå¸¸æ˜¯ä»·æ ¼ï¼‰
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2; // æ–œæ åé€šå¸¸æ˜¯ä»·æ ¼
                        }
                        
                        // æ£€æŸ¥æ˜¯å¦åœ¨æ‹¬å·å‰ï¼ˆé€šå¸¸æ˜¯ä»·æ ¼ï¼‰
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1; // æ‹¬å·å‰å¯èƒ½æ˜¯ä»·æ ¼
                        }
                        
                        if (confidence >= 0.3) { // æé«˜é˜ˆå€¼è‡³0.3ï¼Œé¿å…è¯¯è¯†åˆ«å‹å·ä¸­çš„æ•°å­—
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'å‰åå­—æ¯åµŒå…¥ ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'åé¢å­—æ¯ ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'å‰é¢å­—æ¯ ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'åé¢æ¨ªæ  ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'åé¢åŠ å· ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'å‰é¢åŠ å· ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'å‰é¢æ¨ªæ  ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'æœ‰åˆ†éš”ç¬¦ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'æœ‰ç©ºæ ¼ ';
                }
                
                if (before.match(/(å«ç¥¨|ä»·æ ¼|æŠ¥ä»·|ï¿¥|\$)/)) {
                    confidence += 0.4;
                    context += 'æœ‰ä»·æ ¼å…³é”®è¯ ';
                }
                
                if (after.match(/^(å…ƒ|å—|åŒ…é‚®|èµ·|\()/)) {
                    confidence += 0.3;
                    context += 'æœ‰ä»·æ ¼å•ä½ ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'è¡Œæœ« ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'æ¥è¿‘è¡Œæœ« ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'æ‹¬å·å†… ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function processPrices(line, prices) {
                if (!prices || prices.length === 0) return null;
                
                const uniquePrices = removeDuplicatePrices(prices);
                
                let productName = line;
                uniquePrices.forEach(priceInfo => {
                    const priceStr = priceInfo.price.toString();
                    
                    if (priceInfo.method === 'currency') {
                        productName = productName.replace(new RegExp(`[Â¥ï¿¥]\\s*${priceStr}`, 'g'), '').trim();
                    } else if (priceInfo.method === 'unit') {
                        productName = productName.replace(new RegExp(`${priceStr}\\s*(å…ƒ|å—|å°|å¤š|èµ·|é™|ç‰¹)`, 'g'), '').trim();
                    } else {
                        productName = productName.replace(new RegExp(`(?<!\\w)${priceStr}(?!\\w)`, 'g'), '').trim();
                    }
                });
                
                return uniquePrices.map(priceInfo => {
                    return {
                        name: productName,
                        price: priceInfo.price
                    };
                });
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function updateStats() {
                const total = parsedItems.length;
                const priceLines = parsedItems.filter(item => item.hasPrice).length;
                const textLines = total - priceLines;
                
                document.getElementById('pm_totalLines').textContent = total;
                document.getElementById('pm_priceLines').textContent = priceLines;
                document.getElementById('pm_textLines').textContent = textLines;
            }
            
            function enterBatchDeleteMode() {
                batchDeleteMode = true;
                document.getElementById('pm_batchDeleteBtn').style.display = 'none';
                document.getElementById('pm_deleteSelectedBtn').style.display = 'inline-block';
                document.getElementById('pm_cancelDeleteBtn').style.display = 'inline-block';
                document.getElementById('pm_copyBtn').disabled = true;
                document.getElementById('pm_parseBtn').disabled = true;
                document.getElementById('pm_sortSelect').disabled = true;
                
                displayItems(parsedItems);
            }
            
            function exitBatchDeleteMode() {
                batchDeleteMode = false;
                document.getElementById('pm_batchDeleteBtn').style.display = 'inline-block';
                document.getElementById('pm_deleteSelectedBtn').style.display = 'none';
                document.getElementById('pm_cancelDeleteBtn').style.display = 'none';
                document.getElementById('pm_copyBtn').disabled = false;
                document.getElementById('pm_parseBtn').disabled = false;
                document.getElementById('pm_sortSelect').disabled = false;
                
                parsedItems.forEach(item => {
                    item.selected = false;
                });
                
                displayItems(parsedItems);
            }
            
            function deleteSelectedItems() {
                const remainingItems = parsedItems.filter(item => !item.selected);
                
                if (remainingItems.length === parsedItems.length) {
                    alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®');
                    return;
                }
                
                parsedItems = remainingItems;
                updateStats();
                exitBatchDeleteMode();
                sortAndDisplayItems();
            }
            
            function sortAndDisplayItems() {
                const sortMethod = document.getElementById('pm_sortSelect').value;
                let sortedItems = [...parsedItems];
                
                switch (sortMethod) {
                    case 'priceAsc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return a.price - b.price;
                            return 0;
                        });
                        break;
                    case 'priceDesc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return b.price - a.price;
                            return 0;
                        });
                        break;
                    case 'nameAsc':
                        sortedItems.sort((a, b) => {
                            return a.name.localeCompare(b.name, 'zh-CN');
                        });
                        break;
                    default:
                        break;
                }
                
                displayItems(sortedItems);
            }
            
            function displayItems(items) {
                const resultsContainer = document.getElementById('pm_resultsContainer');
                resultsContainer.innerHTML = '';
                
                resultsContainer.style.overflowY = 'auto';
                resultsContainer.style.maxHeight = '60vh';
                
                items.forEach((item, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = `result-item ${item.selected ? 'selected' : ''}`;
                    resultItem.dataset.index = index;
                    
                    // å¤é€‰æ¡†
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = `checkbox ${batchDeleteMode ? '' : 'hidden'}`;
                    checkbox.checked = item.selected;
                    checkbox.addEventListener('change', (e) => {
                        parsedItems.forEach(pItem => {
                            if (pItem.originalLine === item.originalLine) {
                                pItem.selected = e.target.checked;
                            }
                        });
                        resultItem.classList.toggle('selected', e.target.checked);
                    });
                    
                    // æ‹–æ‹½æ‰‹æŸ„
                    const dragHandle = document.createElement('div');
                    dragHandle.className = 'drag-handle';
                    dragHandle.innerHTML = 'â‰¡';
                    dragHandle.title = 'æ‹–æ‹½ç§»åŠ¨';
                    
                    // ç§»åŠ¨æŒ‰é’®
                    const moveButtons = document.createElement('div');
                    moveButtons.className = 'move-buttons';
                    
                    const moveUpBtn = document.createElement('button');
                    moveUpBtn.className = 'move-btn';
                    moveUpBtn.innerHTML = 'â†‘';
                    moveUpBtn.title = 'å‘ä¸Šç§»åŠ¨';
                    moveUpBtn.disabled = index === 0;
                    moveUpBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        moveItemUp(index);
                    });
                    
                    const moveDownBtn = document.createElement('button');
                    moveDownBtn.className = 'move-btn';
                    moveDownBtn.innerHTML = 'â†“';
                    moveDownBtn.title = 'å‘ä¸‹ç§»åŠ¨';
                    moveDownBtn.disabled = index === items.length - 1;
                    moveDownBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        moveItemDown(index);
                    });
                    
                    moveButtons.appendChild(moveUpBtn);
                    moveButtons.appendChild(moveDownBtn);
                    
                    // å†…å®¹åŒºåŸŸ
                    const itemContent = document.createElement('div');
                    itemContent.className = 'item-content';
                    
                    const itemText = document.createElement('div');
                    itemText.className = 'item-text';
                    itemText.style.cursor = 'pointer';
                    itemText.style.padding = '8px';
                    itemText.style.borderRadius = '4px';
                    itemText.style.transition = 'background-color 0.2s';
                    
                    // æ·»åŠ æ‚¬åœæ•ˆæœ
                    itemText.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = '#f0f8ff';
                    });
                    itemText.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'transparent';
                    });
                    
                    // æ·»åŠ ç‚¹å‡»ç¼–è¾‘åŠŸèƒ½
                    itemText.addEventListener('click', function() {
                        editItemContent(item, index, this);
                    });
                    
                    const priceDisplayDiv = document.createElement('div');
                    priceDisplayDiv.className = 'price-display';
                    
                    if (item.hasPrice) {
                        itemText.textContent = item.originalLine;
                        
                        const bluePriceSpan = document.createElement('span');
                        bluePriceSpan.className = 'blue-price';
                        bluePriceSpan.textContent = `Â¥${item.price}`;
                        priceDisplayDiv.appendChild(bluePriceSpan);
                    } else {
                        itemText.textContent = item.name;
                        
                        const noPriceSpan = document.createElement('span');
                        noPriceSpan.className = 'no-price';
                        noPriceSpan.textContent = 'æ— ä»·æ ¼';
                        priceDisplayDiv.appendChild(noPriceSpan);
                    }
                    
                    itemContent.appendChild(itemText);
                    itemContent.appendChild(priceDisplayDiv);
                    
                    // ç»„è£…å…ƒç´ 
                    resultItem.appendChild(checkbox);
                    resultItem.appendChild(dragHandle);
                    resultItem.appendChild(itemContent);
                    resultItem.appendChild(moveButtons);
                    
                    // æ‹–æ‹½åŠŸèƒ½
                    setupDragAndDrop(resultItem, index);
                    
                    // æ‰¹é‡åˆ é™¤æ¨¡å¼
                    if (batchDeleteMode) {
                        resultItem.addEventListener('click', (e) => {
                            if (e.target !== checkbox && !e.target.closest('.price-display') && 
                                !e.target.closest('.move-buttons') && !e.target.closest('.drag-handle')) {
                                checkbox.checked = !checkbox.checked;
                                const event = new Event('change');
                                checkbox.dispatchEvent(event);
                            }
                        });
                    }
                    
                    resultsContainer.appendChild(resultItem);
                });
            }
            
            // ========== åˆ—è¡¨é¡¹ç§»åŠ¨åŠŸèƒ½ ==========
            function moveItemUp(index) {
                if (index === 0) return;
                
                // äº¤æ¢æ•°ç»„å…ƒç´ 
                [parsedItems[index], parsedItems[index - 1]] = [parsedItems[index - 1], parsedItems[index]];
                
                // é‡æ–°æ˜¾ç¤ºåˆ—è¡¨
                sortAndDisplayItems();
            }
            
            function moveItemDown(index) {
                if (index === parsedItems.length - 1) return;
                
                // äº¤æ¢æ•°ç»„å…ƒç´ 
                [parsedItems[index], parsedItems[index + 1]] = [parsedItems[index + 1], parsedItems[index]];
                
                // é‡æ–°æ˜¾ç¤ºåˆ—è¡¨
                sortAndDisplayItems();
            }
            
            function setupDragAndDrop(element, index) {
                const dragHandle = element.querySelector('.drag-handle');
                let draggedElement = null;
                let draggedIndex = null;
                let isDragging = false;
                let autoScrollInterval = null;
                let scrollSpeed = 0;
                
                // å¼€å§‹æ‹–æ‹½
                const startDrag = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    draggedElement = element;
                    draggedIndex = index;
                    isDragging = true;
                    
                    // åˆ›å»ºæ‹–æ‹½æ—¶çš„è§†è§‰å…ƒç´ ï¼ˆå…‹éš†ï¼‰
                    const dragClone = element.cloneNode(true);
                    const rect = element.getBoundingClientRect();
                    
                    dragClone.style.position = 'fixed';
                    dragClone.style.top = rect.top + 'px';
                    dragClone.style.left = rect.left + 'px';
                    dragClone.style.width = rect.width + 'px';
                    dragClone.style.height = rect.height + 'px';
                    dragClone.style.opacity = '0.8';
                    dragClone.style.zIndex = '1000';
                    dragClone.style.pointerEvents = 'none';
                    dragClone.style.transform = 'rotate(2deg)';
                    dragClone.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
                    dragClone.style.transition = 'none';
                    dragClone.id = 'drag-clone';
                    
                    // éšè—åŸå§‹å…ƒç´ 
                    element.style.opacity = '0.3';
                    
                    // æ·»åŠ åˆ°body
                    document.body.appendChild(dragClone);
                    
                    console.log('å¼€å§‹æ‹–æ‹½:', index);
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬
                    document.addEventListener('mousemove', handleMove);
                    document.addEventListener('mouseup', handleEnd);
                    document.addEventListener('touchmove', handleTouchMove, { passive: false });
                    document.addEventListener('touchend', handleTouchEnd);
                    document.addEventListener('touchcancel', handleTouchEnd);
                };
                
                // è§¦æ‘¸ç§»åŠ¨å¤„ç†
                function handleTouchMove(e) {
                    if (!isDragging) return;
                    
                    const clientX = e.touches[0].clientX;
                    const clientY = e.touches[0].clientY;
                    
                    // è®©æ‹–æ‹½å…ƒç´ è·Ÿéšæ‰‹æŒ‡ç§»åŠ¨
                    updateDragElementPosition(clientX, clientY);
                    
                    // æ›´æ–°ç›®æ ‡é«˜äº®ï¼ˆç²¾ç¡®è·Ÿéšæ‰‹æŒ‡ä½ç½®ï¼‰
                    updateTargetHighlightAtPosition(clientX, clientY);
                    
                    // æ£€æµ‹è¾¹ç¼˜å¹¶è‡ªåŠ¨æ»šåŠ¨
                    checkAutoScroll(clientY);
                    
                    // å…è®¸é¡µé¢æ»šåŠ¨ï¼Œä½†é˜»æ­¢é»˜è®¤è¡Œä¸º
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                // é¼ æ ‡ç§»åŠ¨å¤„ç†
                function handleMove(e) {
                    if (!isDragging) return;
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const clientX = e.clientX;
                    const clientY = e.clientY;
                    
                    // è®©æ‹–æ‹½å…ƒç´ è·Ÿéšé¼ æ ‡ç§»åŠ¨
                    updateDragElementPosition(clientX, clientY);
                    
                    // æ›´æ–°ç›®æ ‡é«˜äº®ï¼ˆç²¾ç¡®è·Ÿéšé¼ æ ‡ä½ç½®ï¼‰
                    updateTargetHighlightAtPosition(clientX, clientY);
                    
                    // æ£€æµ‹è¾¹ç¼˜å¹¶è‡ªåŠ¨æ»šåŠ¨
                    checkAutoScroll(clientY);
                }
                
                // è¾¹ç¼˜æ£€æµ‹å’Œè‡ªåŠ¨æ»šåŠ¨ï¼ˆä»¥è§£ææ¡†ä¸ºåŸºå‡†ï¼‰
                function checkAutoScroll(clientY) {
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    const containerRect = resultsContainer.getBoundingClientRect();
                    
                    // è®¡ç®—è§¦æ‘¸ç‚¹ç›¸å¯¹äºè§£ææ¡†çš„ä½ç½®
                    const relativeY = clientY - containerRect.top;
                    const containerHeight = containerRect.height;
                    
                    // å¦‚æœè§¦æ‘¸ç‚¹ä¸åœ¨è§£ææ¡†å†…ï¼Œåœæ­¢æ»šåŠ¨
                    if (relativeY < 0 || relativeY > containerHeight) {
                        if (autoScrollInterval) {
                            clearInterval(autoScrollInterval);
                            autoScrollInterval = null;
                            scrollSpeed = 0;
                        }
                        return;
                    }
                    
                    // è®¡ç®—ç›¸å¯¹äºè§£ææ¡†çš„ç™¾åˆ†æ¯”ä½ç½®
                    const percentage = relativeY / containerHeight;
                    
                    // åœæ­¢ä¹‹å‰çš„è‡ªåŠ¨æ»šåŠ¨
                    if (autoScrollInterval) {
                        clearInterval(autoScrollInterval);
                        autoScrollInterval = null;
                        scrollSpeed = 0;
                    }
                    
                    // æ£€æµ‹æ˜¯å¦åœ¨è¾¹ç¼˜åŒºåŸŸï¼ˆè§£ææ¡†é¡¶éƒ¨0%-30%æˆ–åº•éƒ¨60%-100%ï¼‰
                    // é¡¶éƒ¨ä¸ä¿ç•™ï¼Œåº•éƒ¨ä¹Ÿä¸ä¿ç•™ï¼Œè§£ææ¡†ä¸­é—´ä¸ºåŸºå‡†ï¼Œä¸Šç§»æˆ–ä¸‹ç§»30%å°±å¯ä»¥æ»‘åŠ¨å¾ˆå¿«
                    if (percentage >= 0 && percentage < 0.30) {
                        // è§£ææ¡†é¡¶éƒ¨0%-30%åŒºåŸŸï¼Œå‘ä¸Šæ»šåŠ¨
                        const speed = Math.max(3, Math.round((0.30 - percentage) * 25 + 4)); // 4-9åƒç´ /å¸§
                        startAutoScroll(-speed);
                        console.log('å‘ä¸Šæ»šåŠ¨ï¼Œé€Ÿåº¦:', speed, 'ä½ç½®ç™¾åˆ†æ¯”:', (percentage * 100).toFixed(1) + '%');
                    } else if (percentage > 0.60) {
                        // è§£ææ¡†åº•éƒ¨60%-100%åŒºåŸŸï¼Œå‘ä¸‹æ»šåŠ¨
                        const speed = Math.max(3, Math.round((percentage - 0.60) * 25 + 4)); // 4-9åƒç´ /å¸§
                        startAutoScroll(speed);
                        console.log('å‘ä¸‹æ»šåŠ¨ï¼Œé€Ÿåº¦:', speed, 'ä½ç½®ç™¾åˆ†æ¯”:', (percentage * 100).toFixed(1) + '%');
                    }
                }
                
                // å¼€å§‹è‡ªåŠ¨æ»šåŠ¨
                function startAutoScroll(speed) {
                    if (autoScrollInterval) return;
                    
                    scrollSpeed = speed;
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    
                    autoScrollInterval = setInterval(() => {
                        if (!isDragging) {
                            clearInterval(autoScrollInterval);
                            autoScrollInterval = null;
                            return;
                        }
                        
                        // æ‰§è¡Œæ»šåŠ¨
                        resultsContainer.scrollTop += scrollSpeed;
                        
                        // æ›´æ–°ç›®æ ‡é«˜äº®
                        updateTargetHighlight();
                    }, 16); // çº¦60fps
                }
                
                // æ›´æ–°æ‹–æ‹½å…ƒç´ ä½ç½®ï¼ˆè®©å…ƒç´ è·Ÿéšæ‰‹æŒ‡/é¼ æ ‡ç§»åŠ¨ï¼‰
                function updateDragElementPosition(clientX, clientY) {
                    const dragClone = document.getElementById('drag-clone');
                    if (!dragClone || !draggedElement) return;
                    
                    // è·å–æ‹–æ‹½æŒ‰é’®çš„ä½ç½®
                    const dragHandle = draggedElement.querySelector('.drag-handle');
                    if (!dragHandle) return;
                    
                    const handleRect = dragHandle.getBoundingClientRect();
                    
                    // è®¡ç®—æ‰‹æŒ‡ç›¸å¯¹äºæ‹–æ‹½æŒ‰é’®çš„åç§»
                    const offsetX = clientX - handleRect.left;
                    const offsetY = clientY - handleRect.top;
                    
                    // è®¾ç½®å…‹éš†å…ƒç´ ä½ç½®ï¼Œä¿æŒä¸æ‹–æ‹½æŒ‰é’®çš„ç›¸å¯¹ä½ç½®
                    dragClone.style.left = (handleRect.left + offsetX - handleRect.width) + 'px';
                    dragClone.style.top = (handleRect.top + offsetY) + 'px';
                }
                
                
                // æ›´æ–°ç›®æ ‡é«˜äº®ï¼ˆç²¾ç¡®è·Ÿéšæ‰‹æŒ‡/é¼ æ ‡ä½ç½®ï¼‰
                function updateTargetHighlightAtPosition(clientX, clientY) {
                    if (!isDragging) return;
                    
                    // æ¸…é™¤ä¹‹å‰çš„é«˜äº®å’ŒæŒ‡ç¤ºçº¿
                    clearAllHighlights();
                    
                    // åœ¨æ‰‹æŒ‡/é¼ æ ‡ä½ç½®æ£€æµ‹ç›®æ ‡å…ƒç´ 
                    const elementBelow = document.elementFromPoint(clientX, clientY);
                    const resultItem = elementBelow?.closest('.result-item');
                    
                    if (resultItem && resultItem !== draggedElement) {
                        // åˆ›å»ºæ’å…¥æŒ‡ç¤ºçº¿
                        createInsertIndicator(resultItem, clientY);
                    }
                }
                
                // æ¸…é™¤æ‰€æœ‰é«˜äº®å’ŒæŒ‡ç¤ºçº¿
                function clearAllHighlights() {
                    // æ¸…é™¤è¡Œé«˜äº®
                    document.querySelectorAll('.result-item').forEach(item => {
                        item.classList.remove('drag-over');
                    });
                    
                    // æ¸…é™¤æ’å…¥æŒ‡ç¤ºçº¿
                    const existingIndicator = document.querySelector('.insert-indicator');
                    if (existingIndicator) {
                        existingIndicator.remove();
                    }
                }
                
                // åˆ›å»ºæ’å…¥æŒ‡ç¤ºçº¿
                function createInsertIndicator(targetItem, clientY) {
                    const targetRect = targetItem.getBoundingClientRect();
                    const targetCenterY = targetRect.top + targetRect.height / 2;
                    
                    // åˆ¤æ–­æ’å…¥ä½ç½®ï¼šåœ¨ç›®æ ‡å…ƒç´ ä¸Šæ–¹è¿˜æ˜¯ä¸‹æ–¹
                    const insertAbove = clientY < targetCenterY;
                    
                    // åˆ›å»ºæŒ‡ç¤ºçº¿å…ƒç´ 
                    const indicator = document.createElement('div');
                    indicator.className = 'insert-indicator';
                    
                    // æ’å…¥åˆ°ç›®æ ‡ä½ç½®
                    if (insertAbove) {
                        targetItem.parentNode.insertBefore(indicator, targetItem);
                    } else {
                        targetItem.parentNode.insertBefore(indicator, targetItem.nextSibling);
                    }
                }
                
                // æ›´æ–°ç›®æ ‡é«˜äº®
                function updateTargetHighlight() {
                    if (!isDragging) return;
                    
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    const containerRect = resultsContainer.getBoundingClientRect();
                    const centerX = containerRect.left + containerRect.width / 2;
                    const centerY = containerRect.top + containerRect.height / 2;
                    
                    const elementBelow = document.elementFromPoint(centerX, centerY);
                    const resultItem = elementBelow?.closest('.result-item');
                    
                    if (resultItem && resultItem !== draggedElement) {
                        // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                        document.querySelectorAll('.result-item').forEach(item => {
                            item.classList.remove('drag-over');
                        });
                        
                        // é«˜äº®ç›®æ ‡å…ƒç´ 
                        resultItem.classList.add('drag-over');
                    }
                }
                
                // æ£€æŸ¥æœ€ç»ˆä½ç½®
                function checkFinalPosition() {
                    if (!isDragging) return;
                    
                    const resultsContainer = document.getElementById('pm_resultsContainer');
                    const containerRect = resultsContainer.getBoundingClientRect();
                    const centerX = containerRect.left + containerRect.width / 2;
                    const centerY = containerRect.top + containerRect.height / 2;
                    
                    const elementBelow = document.elementFromPoint(centerX, centerY);
                    const targetElement = elementBelow?.closest('.result-item');
                    
                    if (targetElement && targetElement !== draggedElement) {
                        const targetIndex = parseInt(targetElement.dataset.index);
                        
                        if (targetIndex !== draggedIndex) {
                            // ç§»åŠ¨å…ƒç´ 
                            const item = parsedItems.splice(draggedIndex, 1)[0];
                            parsedItems.splice(targetIndex, 0, item);
                            
                            // é‡æ–°æ˜¾ç¤º
                            sortAndDisplayItems();
                        }
                    }
                }
                
                // è§¦æ‘¸ç»“æŸå¤„ç†
                function handleTouchEnd(e) {
                    if (!isDragging) return;
                    handleEnd(e);
                }
                
                // ç»“æŸæ‹–æ‹½
                function handleEnd(e) {
                    if (!isDragging) return;
                    
                    console.log('ç»“æŸæ‹–æ‹½');
                    
                    // åœæ­¢è‡ªåŠ¨æ»šåŠ¨
                    if (autoScrollInterval) {
                        clearInterval(autoScrollInterval);
                        autoScrollInterval = null;
                    }
                    
                    // åŸºäºæ’å…¥æŒ‡ç¤ºçº¿ä½ç½®è¿›è¡Œäº¤æ¢
                    const insertIndicator = document.querySelector('.insert-indicator');
                    if (insertIndicator) {
                        // è·å–æ’å…¥æŒ‡ç¤ºçº¿çš„ä½ç½®
                        const indicatorNextSibling = insertIndicator.nextSibling;
                        const indicatorPreviousSibling = insertIndicator.previousSibling;
                        
                        let targetIndex;
                        
                        if (indicatorNextSibling && indicatorNextSibling.classList && indicatorNextSibling.classList.contains('result-item')) {
                            // æŒ‡ç¤ºçº¿åœ¨ç›®æ ‡å…ƒç´ ä¸Šæ–¹ï¼Œæ’å…¥åˆ°ç›®æ ‡å…ƒç´ çš„ä½ç½®
                            targetIndex = parseInt(indicatorNextSibling.dataset.index);
                        } else if (indicatorPreviousSibling && indicatorPreviousSibling.classList && indicatorPreviousSibling.classList.contains('result-item')) {
                            // æŒ‡ç¤ºçº¿åœ¨ç›®æ ‡å…ƒç´ ä¸‹æ–¹ï¼Œæ’å…¥åˆ°ç›®æ ‡å…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®
                            targetIndex = parseInt(indicatorPreviousSibling.dataset.index) + 1;
                        } else {
                            // å¦‚æœæ‰¾ä¸åˆ°ç›¸é‚»å…ƒç´ ï¼Œå°è¯•é€šè¿‡çˆ¶å®¹å™¨æŸ¥æ‰¾
                            const container = insertIndicator.parentNode;
                            const allItems = container.querySelectorAll('.result-item');
                            
                            // æ‰¾åˆ°æŒ‡ç¤ºçº¿åœ¨DOMä¸­çš„ä½ç½®
                            let indicatorPosition = -1;
                            for (let i = 0; i < container.children.length; i++) {
                                if (container.children[i] === insertIndicator) {
                                    indicatorPosition = i;
                                    break;
                                }
                            }
                            
                            if (indicatorPosition >= 0) {
                                // è®¡ç®—åº”è¯¥æ’å…¥åˆ°å“ªä¸ªä½ç½®
                                let itemCount = 0;
                                for (let i = 0; i < indicatorPosition; i++) {
                                    if (container.children[i].classList.contains('result-item')) {
                                        itemCount++;
                                    }
                                }
                                targetIndex = itemCount;
                            }
                        }
                        
                        if (targetIndex !== undefined && targetIndex !== draggedIndex) {
                            // ç§»åŠ¨æ•°ç»„å…ƒç´ 
                            const item = parsedItems.splice(draggedIndex, 1)[0];
                            
                            // å‘ä¸‹æ‹–æ‹½æ—¶éœ€è¦è°ƒæ•´ç›®æ ‡ç´¢å¼•ï¼ˆå› ä¸ºspliceåˆ é™¤åï¼Œåç»­ç´¢å¼•å‡1ï¼‰
                            let adjustedTargetIndex = targetIndex;
                            if (draggedIndex < targetIndex) {
                                adjustedTargetIndex = targetIndex - 1;
                            }
                            
                            parsedItems.splice(adjustedTargetIndex, 0, item);
                            
                            // é‡æ–°æ˜¾ç¤ºåˆ—è¡¨
                            sortAndDisplayItems();
                            
                            console.log('å…ƒç´ å·²æ’å…¥åˆ°ä½ç½®:', adjustedTargetIndex, '(åŸç›®æ ‡:', targetIndex, ', æ‹–æ‹½èµ·å§‹:', draggedIndex, ')');
                        }
                    } else {
                        // å¦‚æœæ²¡æœ‰æ’å…¥æŒ‡ç¤ºçº¿ï¼Œä½¿ç”¨åŸæ¥çš„é€»è¾‘ä½œä¸ºå¤‡ç”¨
                        let clientX, clientY;
                        if (e.type === 'touchend' && e.changedTouches && e.changedTouches.length > 0) {
                            clientX = e.changedTouches[0].clientX;
                            clientY = e.changedTouches[0].clientY;
                        } else if (e.type === 'mouseup') {
                            clientX = e.clientX;
                            clientY = e.clientY;
                        }
                        
                        if (clientX && clientY) {
                            const elementBelow = document.elementFromPoint(clientX, clientY);
                            const targetElement = elementBelow?.closest('.result-item');
                            
                            if (targetElement && targetElement !== draggedElement) {
                                const targetIndex = parseInt(targetElement.dataset.index);
                                const draggedIndex = parseInt(draggedElement.dataset.index);
                                
                                if (targetIndex !== draggedIndex) {
                                    // äº¤æ¢æ•°ç»„å…ƒç´ 
                                    const item = parsedItems.splice(draggedIndex, 1)[0];
                                    parsedItems.splice(targetIndex, 0, item);
                                    
                                    // é‡æ–°æ˜¾ç¤ºåˆ—è¡¨
                                    sortAndDisplayItems();
                                    
                                    console.log('å…ƒç´ å·²ç§»åŠ¨åˆ°ä½ç½®:', targetIndex);
                                }
                            }
                        }
                    }
                    
                    // æ¸…ç†
                    cleanup();
                }
                
                // æ¸…ç†
                function cleanup() {
                    // ç§»é™¤å…‹éš†å…ƒç´ 
                    const dragClone = document.getElementById('drag-clone');
                    if (dragClone) {
                        dragClone.remove();
                    }
                    
                    // é‡ç½®åŸå§‹å…ƒç´ æ ·å¼
                    if (draggedElement) {
                        draggedElement.style.opacity = '';
                    }
                    
                    // æ¸…é™¤æ‰€æœ‰é«˜äº®å’ŒæŒ‡ç¤ºçº¿
                    clearAllHighlights();
                    
                    // é‡ç½®çŠ¶æ€
                    draggedElement = null;
                    draggedIndex = null;
                    isDragging = false;
                    
                    // åœæ­¢è‡ªåŠ¨æ»šåŠ¨
                    if (autoScrollInterval) {
                        clearInterval(autoScrollInterval);
                        autoScrollInterval = null;
                    }
                    
                    // ç§»é™¤äº‹ä»¶ç›‘å¬
                    document.removeEventListener('mousemove', handleMove);
                    document.removeEventListener('mouseup', handleEnd);
                    document.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                    document.removeEventListener('touchcancel', handleTouchEnd);
                }
                
                // ç»‘å®šäº‹ä»¶
                dragHandle.addEventListener('mousedown', startDrag);
                dragHandle.addEventListener('touchstart', startDrag, { passive: false });
                
                // é˜²æ­¢é»˜è®¤è¡Œä¸º
                dragHandle.addEventListener('dragstart', (e) => {
                    e.preventDefault();
                });
            }
            
            function copyResults() {
                // è·å–å½“å‰æ’åºåçš„æ•°æ®ï¼Œè€Œä¸æ˜¯åŸå§‹æ•°æ®
                const sortMethod = document.getElementById('pm_sortSelect').value;
                let sortedItems = [...parsedItems];
                
                // åº”ç”¨ä¸æ˜¾ç¤ºæ—¶ç›¸åŒçš„æ’åºé€»è¾‘
                switch (sortMethod) {
                    case 'priceAsc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return a.price - b.price;
                            return 0;
                        });
                        break;
                    case 'priceDesc':
                        sortedItems.sort((a, b) => {
                            if (!a.hasPrice && b.hasPrice) return 1;
                            if (a.hasPrice && !b.hasPrice) return -1;
                            if (a.hasPrice && b.hasPrice) return b.price - a.price;
                            return 0;
                        });
                        break;
                    case 'nameAsc':
                        sortedItems.sort((a, b) => {
                            return a.name.localeCompare(b.name, 'zh-CN');
                        });
                        break;
                    default:
                        // åŸå§‹é¡ºåºï¼Œä¸éœ€è¦æ’åº
                        break;
                }
                
                const resultText = sortedItems.map(item => item.originalLine).join('\n');
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(resultText)
                        .then(() => {
                            showCopySuccess();
                        })
                        .catch(err => {
                            fallbackCopy(resultText);
                        });
                } else {
                    fallbackCopy(resultText);
                }
            }
            
            function showCopySuccess() {
                const copySuccess = document.getElementById('pm_copySuccess');
                copySuccess.classList.add('show');
                setTimeout(() => {
                    copySuccess.classList.remove('show');
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥: ', err);
                } finally {
                    document.body.removeChild(textArea);
                }
            }
            
            // ç¼–è¾‘é¡¹ç›®å†…å®¹åŠŸèƒ½
            function editItemContent(item, index, contentElement) {
                // åˆ›å»ºç¼–è¾‘æ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10000;
                    padding: 20px;
                `;
                
                const modalContent = document.createElement('div');
                modalContent.className = 'modal-content';
                modalContent.style.cssText = `
                    background: white;
                    border-radius: 12px;
                    padding: 20px;
                    width: 100%;
                    max-width: 500px;
                    max-height: 80vh;
                    overflow-y: auto;
                `;
                
                const title = document.createElement('h3');
                title.textContent = 'ç¼–è¾‘å†…å®¹';
                title.style.cssText = `
                    margin: 0 0 15px 0;
                    color: #333;
                    font-size: 18px;
                `;
                
                const textarea = document.createElement('textarea');
                textarea.value = item.originalLine;
                
                // æ ¹æ®å½“å‰å­—ä½“å¤§å°è®¾ç½®åŠ¨æ€è°ƒæ•´
                let fontSize = '16px'; // é»˜è®¤ä¸­å­—ä½“
                if (document.body.classList.contains('font-small')) {
                    fontSize = '14px';
                } else if (document.body.classList.contains('font-large')) {
                    fontSize = '18px';
                } else if (document.body.classList.contains('font-extra-large')) {
                    fontSize = '24px';
                }
                
                textarea.style.cssText = `
                    width: 100%;
                    min-height: 120px;
                    padding: 12px;
                    border: 2px solid #e0e0e0;
                    border-radius: 8px;
                    font-size: ${fontSize};
                    resize: vertical;
                    box-sizing: border-box;
                `;
                textarea.focus();
                textarea.select();
                
                const buttonContainer = document.createElement('div');
                buttonContainer.style.cssText = `
                    display: flex;
                    gap: 10px;
                    margin-top: 15px;
                    justify-content: flex-end;
                `;
                
                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'å–æ¶ˆ';
                cancelBtn.style.cssText = `
                    padding: 10px 20px;
                    background: #95a5a6;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                const saveBtn = document.createElement('button');
                saveBtn.textContent = 'ä¿å­˜';
                saveBtn.style.cssText = `
                    padding: 10px 20px;
                    background: #3498db;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                `;
                
                // äº‹ä»¶å¤„ç†
                const closeModal = () => {
                    document.body.removeChild(modal);
                };
                
                cancelBtn.addEventListener('click', closeModal);
                
                saveBtn.addEventListener('click', () => {
                    const newContent = textarea.value.trim();
                    if (newContent && newContent !== item.originalLine) {
                        // æ›´æ–°åŸå§‹æ•°æ®
                        item.originalLine = newContent;
                        item.name = newContent;
                        
                        // é‡æ–°è§£æä»·æ ¼
                        const result = parseProducts(newContent);
                        if (result && result.hasPrice && result.prices && result.prices.length > 0) {
                            item.hasPrice = true;
                            item.price = result.prices[0].price;
                        } else {
                            item.hasPrice = false;
                            item.price = null;
                        }
                        
                        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                        updateStats();
                        
                        // é‡æ–°æ˜¾ç¤ºåˆ—è¡¨
                        sortAndDisplayItems();
                        
                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        showEditSuccess();
                    }
                    closeModal();
                });
                
                // ç‚¹å‡»èƒŒæ™¯å…³é—­
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
                
                // ESCé”®å…³é—­
                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleKeyDown);
                    }
                };
                document.addEventListener('keydown', handleKeyDown);
                
                // ç»„è£…æ¨¡æ€æ¡†
                buttonContainer.appendChild(cancelBtn);
                buttonContainer.appendChild(saveBtn);
                modalContent.appendChild(title);
                modalContent.appendChild(textarea);
                modalContent.appendChild(buttonContainer);
                modal.appendChild(modalContent);
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                document.body.appendChild(modal);
            }
            
            // æ˜¾ç¤ºç¼–è¾‘æˆåŠŸæç¤º
            function showEditSuccess() {
                const toast = document.createElement('div');
                toast.textContent = 'âœ“ å†…å®¹å·²æ›´æ–°';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            return {
                init: init
            };
        })();
        
        // ========== ç•Œé¢2ï¼šä»·æ ¼è°ƒæ•´ JavaScript ==========
        const PriceAdjuster = (function() {
            let parsedData = [];
            let isPricingApplied = false;
            
            function init() {
                // åˆå§‹åŒ–å®Œæˆ
            }
            
            function parseProducts() {
                const input = document.getElementById('pa_productInput').value.trim();
                if (!input) {
                    alert('è¯·è¾“å…¥äº§å“ä¿¡æ¯');
                    return;
                }
                
                const lines = input.split('\n').filter(line => line.trim());
                parsedData = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const result = purePriceParse(line);
                    parsedData.push(result);
                }
                
                displayResults();
                updateStats();
            }
            
            function purePriceParse(line) {
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text',
                        debug: { method: 'non-product' }
                    };
                }
                
                let allPrices = [];
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                allPrices = removeDuplicatePrices(allPrices);
                
                if (allPrices.length > 0) {
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]];
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product',
                        debug: { method: 'single-price', count: 1 }
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text',
                    debug: { method: 'no-price' }
                };
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                let currencyPattern = /[Â¥$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                let unitPattern = /(\d+(?:\.\d+)?)\s*(å…ƒ|å—|å°|å¤š|èµ·|é™|ç‰¹)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // å¸¦è¡¨æƒ…ç¬¦å·çš„ä»·æ ¼è¯†åˆ«å·²ç§»é™¤ï¼Œé¿å…6XXXä»·æ ¼è¯†åˆ«é”™è¯¯
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) {
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        let confidence = context.confidence;
                        
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2;
                        }
                        
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1;
                        }
                        
                        if (confidence >= 0.3) {
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'å‰åå­—æ¯åµŒå…¥ ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'åé¢å­—æ¯ ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'å‰é¢å­—æ¯ ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'åé¢æ¨ªæ  ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'åé¢åŠ å· ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'å‰é¢åŠ å· ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'å‰é¢æ¨ªæ  ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'æœ‰åˆ†éš”ç¬¦ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'æœ‰ç©ºæ ¼ ';
                }
                
                if (before.match(/(å«ç¥¨|ä»·æ ¼|æŠ¥ä»·|ï¿¥|\$)/)) {
                    confidence += 0.4;
                    context += 'æœ‰ä»·æ ¼å…³é”®è¯ ';
                }
                
                if (after.match(/^(å…ƒ|å—|åŒ…é‚®|èµ·|\()/)) {
                    confidence += 0.3;
                    context += 'æœ‰ä»·æ ¼å•ä½ ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'è¡Œæœ« ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'æ¥è¿‘è¡Œæœ« ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'æ‹¬å·å†… ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function applyPricing() {
                if (parsedData.length === 0) {
                    alert('è¯·å…ˆè§£æäº§å“');
                    return;
                }
                
                const pricingType = document.getElementById('pa_pricingType').value;
                const pricingMode = document.getElementById('pa_pricingMode').value;
                const pricingDirection = document.getElementById('pa_pricingDirection').value;
                const priceRounding = document.getElementById('pa_priceRounding').value;
                
                // åªæœ‰åœ¨ç»Ÿä¸€è°ƒä»·æ¨¡å¼ä¸‹æ‰éœ€è¦è·å–ç»Ÿä¸€çš„è°ƒä»·å€¼
                let pricingValue = 0;
                if (pricingMode === 'uniform') {
                    pricingValue = parseFloat(document.getElementById('pa_pricingValue').value);
                }
                
                for (let item of parsedData) {
                    if (item.hasPrice && item.prices && item.prices.length > 0) {
                        item.newPrices = [];
                        
                        for (let priceInfo of item.prices) {
                            let newPrice = priceInfo.price;
                            let currentPricingValue = pricingValue;
                            
                            // å¦‚æœæ˜¯åŒºé—´è°ƒä»·æ¨¡å¼ï¼Œæ ¹æ®ä»·æ ¼åŒºé—´è·å–å¯¹åº”çš„è°ƒä»·ç™¾åˆ†æ¯”
                            if (pricingMode === 'range') {
                                currentPricingValue = getPriceRangePercentage(priceInfo.price);
                            }
                            
                            if (pricingType === 'percentage') {
                                if (pricingDirection === 'increase') {
                                    newPrice = priceInfo.price * (1 + currentPricingValue / 100);
                                } else {
                                    newPrice = priceInfo.price * (1 - currentPricingValue / 100);
                                }
                            } else {
                                if (pricingDirection === 'increase') {
                                    newPrice = priceInfo.price + currentPricingValue;
                                } else {
                                    newPrice = priceInfo.price - currentPricingValue;
                                }
                            }
                            
                            newPrice = applyRounding(newPrice, priceRounding);
                            item.newPrices.push(newPrice);
                        }
                    }
                }
                
                isPricingApplied = true;
                displayResults();
            }
            
            function applyRounding(price, roundingType) {
                switch (roundingType) {
                    case 'ones':
                        return Math.round(price);
                    case 'tens':
                        return Math.round(price / 10) * 10;
                    case 'hundreds':
                        return Math.round(price / 100) * 100;
                    case 'none':
                    default:
                        return Math.round(price);
                }
            }
            
            // åˆ‡æ¢è°ƒä»·æ¨¡å¼æ˜¾ç¤º
            function togglePricingMode() {
                const mode = document.getElementById('pa_pricingMode').value;
                const rangeSection = document.getElementById('pa_rangePricingSection');
                
                if (mode === 'range') {
                    rangeSection.style.display = 'block';
                } else {
                    rangeSection.style.display = 'none';
                }
            }
            
            // æ ¹æ®ä»·æ ¼è·å–å¯¹åº”çš„åŒºé—´è°ƒä»·ç™¾åˆ†æ¯”
            function getPriceRangePercentage(price) {
                // è·å–å„åŒºé—´çš„è°ƒä»·ç™¾åˆ†æ¯”
                const range0_999 = parseFloat(document.getElementById('pa_range0_999').value);
                const range1000_1999 = parseFloat(document.getElementById('pa_range1000_1999').value);
                const range2000_4999 = parseFloat(document.getElementById('pa_range2000_4999').value);
                const range5000_9999 = parseFloat(document.getElementById('pa_range5000_9999').value);
                const range10000_plus = parseFloat(document.getElementById('pa_range10000_plus').value);
                
                // æ ¹æ®ä»·æ ¼åŒºé—´è¿”å›å¯¹åº”çš„ç™¾åˆ†æ¯”
                if (price >= 0 && price <= 999) {
                    return range0_999;
                } else if (price >= 1000 && price <= 1999) {
                    return range1000_1999;
                } else if (price >= 2000 && price <= 4999) {
                    return range2000_4999;
                } else if (price >= 5000 && price <= 9999) {
                    return range5000_9999;
                } else if (price >= 10000) {
                    return range10000_plus;
                }
                return 0; // é»˜è®¤å€¼
            }
            
            function displayResults() {
                const resultArea = document.getElementById('pa_resultArea');
                resultArea.innerHTML = '';
                
                for (let item of parsedData) {
                    const itemDiv = document.createElement('div');
                    let itemClass = 'result-item';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        itemClass += ' has-price';
                    } else {
                        itemClass += ' no-price';
                    }
                    
                    itemDiv.className = itemClass;
                    
                    let content = item.content;
                    let priceDisplay = '';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        if (isPricingApplied && item.newPrices) {
                            priceDisplay = item.prices.map((priceInfo, index) => {
                                const newPrice = item.newPrices[index] || priceInfo.price;
                                const priceChange = newPrice - priceInfo.price;
                                const priceClass = priceChange > 0 ? 'price-increase' : (priceChange < 0 ? 'price-decrease' : '');
                                
                                return `
                                    <span class="result-price original">Â¥${priceInfo.price}</span>
                                    <span class="result-price new ${priceClass}">Â¥${newPrice}</span>
                                `;
                            }).join(' ');
                        } else {
                            priceDisplay = item.prices.map(priceInfo => 
                                `<span class="result-price">Â¥${priceInfo.price}</span>`
                            ).join(' ');
                        }
                    } else {
                        priceDisplay = '<span style="color: #999; font-size: 3vw;">æ— ä»·æ ¼</span>';
                    }
                    
                    itemDiv.innerHTML = `
                        <div class="result-content">${content}</div>
                        <div class="result-price">${priceDisplay}</div>
                    `;
                    
                    resultArea.appendChild(itemDiv);
                }
            }
            
            function updateStats() {
                const totalLines = parsedData.length;
                const priceLines = parsedData.filter(item => item.hasPrice).length;
                const textLines = parsedData.filter(item => !item.hasPrice).length;
                
                document.getElementById('pa_totalLines').textContent = totalLines;
                document.getElementById('pa_priceLines').textContent = priceLines;
                document.getElementById('pa_textLines').textContent = textLines;
            }
            
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^â€”â€”â€”â€”+$/, 
                    /^\[çº¢åŒ…\].*\[çº¢åŒ…\]$/,
                    /^[\s\-_=]+$/,
                    /å¹³å°ç°æŸ¥|ä»·æ ¼å¯èƒ½ä¼šæ³¢åŠ¨/,
                    /å…¨å›½åŒ…é‚®|æ·±åœ³|æ²³æº|æƒ å·/,
                    /ç°è´§ç§’å‘|å…¶ä»–æœºå‹è¯¢ä»·/,
                    /æ›´å¤šå…¶ä»–å“ç‰Œå‹å·/,
                    /å¤‡æ³¨ï¼š|ä»¥ä¸Šå‡ æ¬¾|ä»¥å®é™…å¼€å•ä¸ºå‡†/,
                    /^\.+$/,
                    /^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+ã€/,
                    /æˆ‘å¸äº§å“å¯å¼€ç¥¨/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function copyResults() {
                if (parsedData.length === 0) {
                    alert('è¯·å…ˆè§£æäº§å“');
                    return;
                }
                
                let output = [];
                
                for (let item of parsedData) {
                    if (item.hasPrice && item.prices.length > 0) {
                        let content = item.original;
                        let newPrice = item.newPrices && item.newPrices[0] 
                            ? item.newPrices[0] 
                            : item.prices[0].price;
                        
                        content = replacePriceInOriginal(content, item.prices[0], newPrice);
                        output.push(content);
                    } else {
                        output.push(item.original);
                    }
                }
                
                const textToCopy = output.join('\n');
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    fallbackCopy(textToCopy);
                });
            }
            
            function replacePriceInOriginal(content, priceInfo, newPrice) {
                const oldPriceStr = priceInfo.price.toString();
                const position = priceInfo.position;
                const newPriceStr = newPrice.toString();
                
                let start = position;
                let end = position + oldPriceStr.length;
                
                const actualNumber = content.substring(start, end);
                if (actualNumber !== oldPriceStr) {
                    const priceRegex = new RegExp('\\b' + oldPriceStr + '\\b');
                    const match = content.match(priceRegex);
                    if (match) {
                        start = content.indexOf(match[0]);
                        end = start + match[0].length;
                    } else {
                        return content;
                    }
                }
                
                const beforePrice = content.substring(0, start);
                const afterPrice = content.substring(end);
                const result = beforePrice + newPriceStr + afterPrice;
                
                return result;
            }
            
            function showCopySuccess() {
                const toast = document.createElement('div');
                toast.textContent = 'âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
                
                document.body.removeChild(textarea);
            }
            
            return {
                init: init,
                parseProducts: parseProducts,
                applyPricing: applyPricing,
                copyResults: copyResults,
                togglePricingMode: togglePricingMode
            };
        })();
        
        // ========== ç•Œé¢3ï¼šç¬¦å·æ›´æ¢ JavaScript ==========
        const SymbolChanger = (function() {
            let parsedData = [];
            let currentPriceSeparator = 'Â¥';
            let enableFooter = false;
            let footerText = '';
            
            function init() {
                // åŠ è½½ä¿å­˜çš„è®¾ç½®
                loadSettings();
                
                // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
                document.getElementById('sc_enableFooter').addEventListener('change', function() {
                    enableFooter = this.checked;
                    saveSettings();
                    if (parsedData.length > 0) {
                        displayResults();
                    }
                });
                
                document.getElementById('sc_footerText').addEventListener('input', function() {
                    footerText = this.value;
                    saveSettings();
                });
            }
            
            function loadSettings() {
                // ä»localStorageåŠ è½½è®¾ç½®
                const savedEnableFooter = localStorage.getItem('symbolChanger_enableFooter');
                const savedFooterText = localStorage.getItem('symbolChanger_footerText');
                
                if (savedEnableFooter !== null) {
                    enableFooter = savedEnableFooter === 'true';
                    document.getElementById('sc_enableFooter').checked = enableFooter;
                }
                
                if (savedFooterText !== null) {
                    footerText = savedFooterText;
                    document.getElementById('sc_footerText').value = footerText;
                } else {
                    // è®¾ç½®é»˜è®¤å€¼
                    footerText = 'å¹³å°ç°æŸ¥ï¼Œä»·æ ¼å¯èƒ½ä¼šæœ‰æ³¢åŠ¨ï¼Œæ„Ÿè°¢ç†è§£ï¼éƒ¨åˆ†äº§å“ç§èŠè¯¢ä»·ä¸‹å•ï¼ŒæœŸå¾…åˆä½œ[æ¡æ‰‹]';
                    document.getElementById('sc_footerText').value = footerText;
                }
            }
            
            function saveSettings() {
                // ä¿å­˜è®¾ç½®åˆ°localStorage
                localStorage.setItem('symbolChanger_enableFooter', enableFooter.toString());
                localStorage.setItem('symbolChanger_footerText', footerText);
            }
            
            function parseProducts() {
                const input = document.getElementById('sc_productInput').value.trim();
                if (!input) {
                    alert('è¯·è¾“å…¥äº§å“ä¿¡æ¯');
                    return;
                }
                
                const lines = input.split('\n').filter(line => line.trim());
                parsedData = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const result = purePriceParse(line);
                    parsedData.push(result);
                }
                
                displayResults();
                updateStats();
            }
            
            function purePriceParse(line) {
                if (isNonProductLine(line)) {
                    return {
                        original: line,
                        hasPrice: false,
                        prices: [],
                        content: line,
                        type: 'text'
                    };
                }
                
                let allPrices = [];
                let explicitPrices = findExplicitPrices(line);
                allPrices = allPrices.concat(explicitPrices);
                
                let contextPrices = findContextPrices(line);
                allPrices = allPrices.concat(contextPrices);
                
                allPrices = removeDuplicatePrices(allPrices);
                
                if (allPrices.length > 0) {
                    allPrices.sort((a, b) => b.position - a.position);
                    const singlePrice = [allPrices[0]];
                    
                    return {
                        original: line,
                        hasPrice: true,
                        prices: singlePrice,
                        content: line,
                        type: 'product'
                    };
                }
                
                return {
                    original: line,
                    hasPrice: false,
                    prices: [],
                    content: line,
                    type: 'text'
                };
            }
            
            function findExplicitPrices(line) {
                let prices = [];
                let currencyPattern = /[Â¥$]\s*(\d+(?:\.\d+)?)/g;
                let match;
                while ((match = currencyPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'currency', position: match.index });
                    }
                }
                
                let unitPattern = /(\d+(?:\.\d+)?)\s*(å…ƒ|å—|å°|å¤š|èµ·|é™|ç‰¹)/g;
                while ((match = unitPattern.exec(line)) !== null) {
                    const price = parseFloat(match[1]);
                    if (price >= 199 && price <= 99999) {
                        prices.push({ price: price, method: 'unit', position: match.index });
                    }
                }
                
                // å¸¦è¡¨æƒ…ç¬¦å·çš„ä»·æ ¼è¯†åˆ«å·²ç§»é™¤ï¼Œé¿å…6XXXä»·æ ¼è¯†åˆ«é”™è¯¯
                
                return prices;
            }
            
            function findContextPrices(line) {
                let prices = [];
                const numbersWithPosition = [];
                let regex = /\d{3,}/g;
                let match;
                while ((match = regex.exec(line)) !== null) {
                    numbersWithPosition.push({
                        num: match[0],
                        value: parseInt(match[0]),
                        position: match.index
                    });
                }
                
                numbersWithPosition.sort((a, b) => b.position - a.position);
                
                for (let i = 0; i < numbersWithPosition.length; i++) {
                    const numInfo = numbersWithPosition[i];
                    const num = numInfo.value;
                    
                    if (num >= 199 && num <= 99999) {
                        const context = getPriceContext(line, numInfo.num, numInfo.position);
                        let confidence = context.confidence;
                        
                        const beforeNum = line.substring(Math.max(0, numInfo.position - 5), numInfo.position);
                        if (beforeNum.includes('/')) {
                            confidence += 0.2;
                        }
                        
                        const afterNum = line.substring(numInfo.position + numInfo.num.length, Math.min(line.length, numInfo.position + numInfo.num.length + 5));
                        if (afterNum.includes('(') || afterNum.includes(')')) {
                            confidence += 0.1;
                        }
                        
                        if (confidence >= 0.3) {
                            prices.push({ 
                                price: num, 
                                method: 'context', 
                                confidence: confidence,
                                position: numInfo.position
                            });
                        }
                    }
                }
                
                return prices;
            }
            
            function getPriceContext(line, number, position) {
                const index = position;
                const before = line.substring(Math.max(0, index - 40), index);
                const after = line.substring(index + number.length, Math.min(line.length, index + number.length + 40));
                
                let confidence = 0.2;
                let context = '';
                
                const charBefore = line[index - 1] || '';
                const charAfter = line[index + number.length] || '';
                const next5Chars = line.substring(index + number.length, index + number.length + 5);
                const hasChinese = /[\u4e00-\u9fa5]/.test(next5Chars);
                
                const isLetterBefore = /[A-Z]/i.test(charBefore);
                const isLetterAfter = /[A-Z]/i.test(charAfter);
                
                const shouldPenalizeAfter = isLetterAfter || (!hasChinese && /[A-Z]/i.test(next5Chars));
                
                if (isLetterBefore && shouldPenalizeAfter) {
                    confidence -= 0.7;
                    context += 'å‰åå­—æ¯åµŒå…¥ ';
                } else if (shouldPenalizeAfter) {
                    confidence -= 0.6;
                    context += 'åé¢å­—æ¯ ';
                } else if (isLetterBefore) {
                    confidence -= 0.4;
                    context += 'å‰é¢å­—æ¯ ';
                }
                
                if (charAfter === '-') {
                    confidence -= 0.4;
                    context += 'åé¢æ¨ªæ  ';
                }
                
                if (charAfter === '+') {
                    confidence -= 0.4;
                    context += 'åé¢åŠ å· ';
                }
                
                if (charBefore === '+') {
                    confidence -= 0.2;
                    context += 'å‰é¢åŠ å· ';
                }
                if (charBefore === '-') {
                    confidence -= 0.1;
                    context += 'å‰é¢æ¨ªæ  ';
                }
                
                if (before.match(/[\/:]$/)) {
                    confidence += 0.4;
                    context += 'æœ‰åˆ†éš”ç¬¦ ';
                } else if (before.match(/\s$/)) {
                    confidence += 0.3;
                    context += 'æœ‰ç©ºæ ¼ ';
                }
                
                if (before.match(/(å«ç¥¨|ä»·æ ¼|æŠ¥ä»·|ï¿¥|\$)/)) {
                    confidence += 0.4;
                    context += 'æœ‰ä»·æ ¼å…³é”®è¯ ';
                }
                
                if (after.match(/^(å…ƒ|å—|åŒ…é‚®|èµ·|\()/)) {
                    confidence += 0.3;
                    context += 'æœ‰ä»·æ ¼å•ä½ ';
                }
                
                const distanceFromEnd = line.length - index - number.length;
                if (distanceFromEnd < 10) {
                    confidence += 0.5;
                    context += 'è¡Œæœ« ';
                } else if (distanceFromEnd < 100) {
                    confidence += 0.3;
                    context += 'æ¥è¿‘è¡Œæœ« ';
                }
                
                const beforeBracket = line.substring(0, index);
                const afterBracket = line.substring(index);
                if (beforeBracket.includes('(') && afterBracket.includes(')')) {
                    confidence -= 0.2;
                    context += 'æ‹¬å·å†… ';
                }
                
                return {
                    confidence: Math.max(0, Math.min(1, confidence)),
                    context: context.trim()
                };
            }
            
            function removeDuplicatePrices(prices) {
                prices.sort((a, b) => a.position - b.position);
                
                let uniquePrices = [];
                for (let i = 0; i < prices.length; i++) {
                    const current = prices[i];
                    const isDuplicate = uniquePrices.some(existing => 
                        Math.abs(existing.price - current.price) < 1 && 
                        Math.abs(existing.position - current.position) < 5
                    );
                    
                    if (!isDuplicate) {
                        uniquePrices.push(current);
                    }
                }
                
                return uniquePrices;
            }
            
            function applyPriceSeparator() {
                const replaceSymbol = document.getElementById('sc_priceSeparator').value;
                currentPriceSeparator = replaceSymbol || 'Â¥';
                redisplayResultsWithSeparator();
                
                const toast = document.createElement('div');
                toast.textContent = 'âœ“ ä»·æ ¼ç¬¦å·å·²æ›´æ–°';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function redisplayResultsWithSeparator() {
                const resultItems = document.querySelectorAll('#symbolChanger .result-item');
                
                parsedData.forEach((item, index) => {
                    if (index < resultItems.length && item.hasPrice && item.prices.length > 0) {
                        const priceElement = resultItems[index].querySelector('.result-price');
                        if (priceElement) {
                            priceElement.textContent = currentPriceSeparator + item.prices[0].price;
                        }
                    }
                });
            }
            
            function displayResults() {
                const resultArea = document.getElementById('sc_resultArea');
                resultArea.innerHTML = '';
                
                updateStats();
                
                for (let item of parsedData) {
                    const itemDiv = document.createElement('div');
                    let itemClass = 'result-item';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        itemClass += ' has-price';
                    } else {
                        itemClass += ' no-price';
                    }
                    
                    itemDiv.className = itemClass;
                    
                    let content = item.content;
                    
                    const originalText = document.createElement('div');
                    originalText.className = 'result-content';
                    originalText.textContent = content;
                    
                    const priceDisplay = document.createElement('div');
                    priceDisplay.className = 'result-price';
                    
                    if (item.hasPrice && item.prices.length > 0) {
                        priceDisplay.textContent = currentPriceSeparator + item.prices[0].price;
                    } else {
                        priceDisplay.textContent = '';
                    }
                    
                    itemDiv.appendChild(originalText);
                    itemDiv.appendChild(priceDisplay);
                    resultArea.appendChild(itemDiv);
                }
                
                // åœ¨æœ€åæ·»åŠ ç»“å°¾è¯´æ˜ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
                if (enableFooter && footerText.trim()) {
                    const footerDiv = document.createElement('div');
                    footerDiv.className = 'result-item';
                    footerDiv.style.background = '#f0f8ff';
                    footerDiv.style.border = '2px solid #2196F3';
                    footerDiv.style.fontStyle = 'italic';
                    footerDiv.style.color = '#666';
                    footerDiv.style.textAlign = 'center';
                    footerDiv.style.padding = '2vw';
                    footerDiv.style.marginTop = '2vw';
                    
                    const footerTextDiv = document.createElement('div');
                    footerTextDiv.className = 'result-content';
                    footerTextDiv.textContent = footerText.trim();
                    footerTextDiv.style.width = '100%';
                    footerTextDiv.style.textAlign = 'center';
                    
                    footerDiv.appendChild(footerTextDiv);
                    resultArea.appendChild(footerDiv);
                }
            }
            
            function updateStats() {
                const totalLines = parsedData.length;
                const priceLines = parsedData.filter(item => item.hasPrice).length;
                const textLines = parsedData.filter(item => !item.hasPrice).length;
                
                document.getElementById('sc_totalLines').textContent = totalLines;
                document.getElementById('sc_priceLines').textContent = priceLines;
                document.getElementById('sc_textLines').textContent = textLines;
            }
            
            function isNonProductLine(line) {
                const nonProductPatterns = [
                    /^â€”â€”â€”â€”+$/, 
                    /^\[çº¢åŒ…\].*\[çº¢åŒ…\]$/,
                    /^[\s\-_=]+$/,
                    /å¹³å°ç°æŸ¥|ä»·æ ¼å¯èƒ½ä¼šæ³¢åŠ¨/,
                    /å…¨å›½åŒ…é‚®|æ·±åœ³|æ²³æº|æƒ å·/,
                    /ç°è´§ç§’å‘|å…¶ä»–æœºå‹è¯¢ä»·/,
                    /æ›´å¤šå…¶ä»–å“ç‰Œå‹å·/,
                    /å¤‡æ³¨ï¼š|ä»¥ä¸Šå‡ æ¬¾|ä»¥å®é™…å¼€å•ä¸ºå‡†/,
                    /^\.+$/,
                    /^[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+ã€/,
                    /æˆ‘å¸äº§å“å¯å¼€ç¥¨/
                ];
                return nonProductPatterns.some(pattern => pattern.test(line));
            }
            
            function copyResults() {
                if (parsedData.length === 0) {
                    alert('è¯·å…ˆè§£æäº§å“');
                    return;
                }
                
                const replaceSymbol = document.getElementById('sc_priceSeparator').value;
                
                let output = [];
                
                for (let item of parsedData) {
                    let lineToAdd = '';
                    
                    if (item.hasPrice && item.prices.length > 0 && replaceSymbol !== '') {
                        const originalLine = item.original;
                        const priceInfo = item.prices[0];
                        const priceValue = priceInfo.price;
                        const priceStr = priceValue.toString();
                        
                        lineToAdd = replacePriceSeparator(originalLine, priceStr, replaceSymbol);
                    } else {
                        lineToAdd = item.original;
                    }
                    
                    output.push(lineToAdd);
                }
                
                // åœ¨æœ€åæ·»åŠ ç»“å°¾è¯´æ˜ï¼ˆåªæ·»åŠ ä¸€æ¬¡ï¼‰
                let textToCopy = output.join('\n');
                if (enableFooter && footerText.trim()) {
                    textToCopy += '\n' + footerText.trim();
                }
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showCopySuccess();
                }).catch(err => {
                    fallbackCopy(textToCopy);
                });
            }
            
            function replacePriceSeparator(line, priceStr, replaceSymbol) {
                const priceIndex = line.lastIndexOf(priceStr);
                
                if (priceIndex > 0) {
                    let endIndex = priceIndex; // ä»·æ ¼å¼€å§‹ä½ç½®
                    let startIndex = priceIndex;
                    
                    // ç¬¬ä¸€æ­¥ï¼šå‘å‰åˆ é™¤æ‰€æœ‰ç©ºæ ¼ï¼ˆå¤„ç† [æ–‡å­—] åçš„ç©ºæ ¼ï¼‰
                    while (startIndex > 0 && /\s/.test(line[startIndex - 1])) {
                        startIndex--;
                    }
                    
                    // ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ˜¯å¦æœ‰ [æ–‡å­—] æ ¼å¼
                    if (startIndex > 0 && line[startIndex - 1] === ']') {
                        // å‘å‰æŸ¥æ‰¾åŒ¹é…çš„ '['
                        let bracketStart = -1;
                        for (let i = startIndex - 2; i >= 0; i--) {
                            if (line[i] === '[') {
                                bracketStart = i;
                                break;
                            }
                        }
                        
                        if (bracketStart >= 0) {
                            startIndex = bracketStart;
                        }
                    } else {
                        // ç¬¬ä¸‰æ­¥ï¼šå¦‚æœæ²¡æœ‰æ–¹æ‹¬å·ï¼Œåˆ é™¤ä»·æ ¼å‰çš„ç¬¦å·ï¼Œä½†ä¿ç•™æ‹¬å·
                        while (startIndex > 0) {
                            // æ£€æŸ¥æ˜¯å¦æ˜¯Emojiï¼ˆéœ€è¦å¤„ç†ä»£ç†å¯¹ï¼‰
                            let charLength = 1;
                            let char = line[startIndex - 1];
                            
                            // æ£€æŸ¥æ˜¯å¦æ˜¯é«˜ä»£ç†å¯¹ï¼ˆEmojiçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼‰
                            if (startIndex > 1) {
                                const prevChar = line[startIndex - 2];
                                const currentChar = line[startIndex - 1];
                                
                                // æ£€æŸ¥æ˜¯å¦æ˜¯ä»£ç†å¯¹ï¼ˆEmojiï¼‰
                                if (prevChar && currentChar) {
                                    const prevCode = prevChar.charCodeAt(0);
                                    const currentCode = currentChar.charCodeAt(0);
                                    
                                    // é«˜ä»£ç†å¯¹èŒƒå›´ï¼š0xD800-0xDBFFï¼Œä½ä»£ç†å¯¹èŒƒå›´ï¼š0xDC00-0xDFFF
                                    if (prevCode >= 0xD800 && prevCode <= 0xDBFF && 
                                        currentCode >= 0xDC00 && currentCode <= 0xDFFF) {
                                        charLength = 2;
                                        char = line.substring(startIndex - 2, startIndex);
                                        startIndex -= 2; // è·³è¿‡ä¸¤ä¸ªå­—ç¬¦
                                    } else {
                                        startIndex--;
                                    }
                                } else {
                                    startIndex--;
                                }
                            } else {
                                startIndex--;
                            }
                            
                            // å¦‚æœæ˜¯å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡ï¼Œåœæ­¢åˆ é™¤
                            if (/[A-Za-z0-9\u4e00-\u9fa5]/.test(char)) {
                                break;
                            }
                            
                            // å¦‚æœæ˜¯æ‹¬å·ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰ï¼Œåœæ­¢åˆ é™¤
                            if (char === ')' || char === 'ï¼‰') {
                                break;
                            }
                            
                            // åˆ é™¤å…¶ä»–ç¬¦å·ï¼šä»·æ ¼ç¬¦å·ã€emojiã€æ ‡ç‚¹ç¬¦å·ã€æ–œæ ç­‰
                            const isPriceSymbol = /[Â¥$â‚¬Â£â‚¹ğŸ’°ï¿¥]/.test(char);
                            const isEmoji = isEmojiChar(char);
                            const isPunctuation = /[!@#$%^&*()_+=\[\]{}|;':",./<>?~`-]/.test(char);
                            const isSlash = char === '/';
                            
                            if (!isPriceSymbol && !isEmoji && !isPunctuation && !isSlash) {
                                break;
                            }
                        }
                    }
                    
                    const beforeSeparator = line.substring(0, startIndex);
                    const afterPrice = line.substring(priceIndex + priceStr.length);
                    return beforeSeparator + replaceSymbol + priceStr + afterPrice;
                }
                
                return line;
            }
            
            // æ–°å¢ï¼šæ›´å‡†ç¡®çš„Emojiæ£€æµ‹å‡½æ•°
            function isEmojiChar(char) {
                if (!char) return false;
                
                // å¤„ç†ä»£ç†å¯¹ï¼ˆEmojiï¼‰
                if (char.length === 2) {
                    const code1 = char.charCodeAt(0);
                    const code2 = char.charCodeAt(1);
                    
                    // é«˜ä»£ç†å¯¹ + ä½ä»£ç†å¯¹ = Emoji
                    if (code1 >= 0xD800 && code1 <= 0xDBFF && 
                        code2 >= 0xDC00 && code2 <= 0xDFFF) {
                        return true;
                    }
                }
                
                // å¤„ç†å•ä¸ªå­—ç¬¦çš„Emoji
                const codePoint = char.codePointAt(0);
                
                // Emoji Unicode èŒƒå›´
                return (
                    // è¡¨æƒ…ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                    (codePoint >= 0x1F300 && codePoint <= 0x1F5FF) || // æ‚é¡¹ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                    (codePoint >= 0x1F600 && codePoint <= 0x1F64F) || // è¡¨æƒ…ç¬¦å·
                    (codePoint >= 0x1F680 && codePoint <= 0x1F6FF) || // äº¤é€šå’Œåœ°å›¾ç¬¦å·
                    (codePoint >= 0x1F700 && codePoint <= 0x1F77F) || // ç‚¼é‡‘æœ¯ç¬¦å·
                    (codePoint >= 0x1F780 && codePoint <= 0x1F7FF) || // å‡ ä½•å½¢çŠ¶æ‰©å±•
                    (codePoint >= 0x1F800 && codePoint <= 0x1F8FF) || // è¡¥å……ç®­å¤´-C
                    (codePoint >= 0x1F900 && codePoint <= 0x1F9FF) || // è¡¥å……ç¬¦å·å’Œè±¡å½¢æ–‡å­—
                    (codePoint >= 0x1FA00 && codePoint <= 0x1FA6F) || // è±¡æ£‹ç¬¦å·
                    (codePoint >= 0x1FA70 && codePoint <= 0x1FAFF) || // ç¬¦å·å’Œè±¡å½¢æ–‡å­—æ‰©å±•-A
                    (codePoint >= 0x2600 && codePoint <= 0x26FF) ||   // æ‚é¡¹ç¬¦å·
                    (codePoint >= 0x2700 && codePoint <= 0x27BF) ||   // è£…é¥°ç¬¦å·
                    (codePoint >= 0xFE00 && codePoint <= 0xFE0F) ||  // å˜ä½“é€‰æ‹©å™¨
                    (codePoint >= 0x1F1E0 && codePoint <= 0x1F1FF)   // åŒºåŸŸæŒ‡ç¤ºç¬¦å·
                );
            }
            
            function showCopySuccess() {
                const toast = document.createElement('div');
                toast.textContent = 'âœ“ å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 9999;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    showCopySuccess();
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
                
                document.body.removeChild(textarea);
            }
            
            return {
                init: init,
                parseProducts: parseProducts,
                applyPriceSeparator: applyPriceSeparator,
                copyResults: copyResults
            };
        })();
        
        // ========== ä¼šå‘˜ç³»ç»Ÿ JavaScript ==========
        const Membership = (function() {
            let membershipData = {
                isMember: false,
                expiryDate: null,
                packageType: null,
                referralCode: null,
                referredBy: null
            };
            
            // å¥—é¤é…ç½®
            const packages = {
                monthly: {
                    name: 'æœˆåº¦ä¼šå‘˜',
                    price: 19,
                    originalPrice: 33,
                    days: 30,
                    isNewUser: true
                },
                halfyear: {
                    name: 'åŠå¹´ä¼šå‘˜',
                    price: 99,
                    originalPrice: 198,
                    days: 120,
                    isNewUser: false
                },
                yearly: {
                    name: 'å¹´åº¦ä¼šå‘˜',
                    price: 188,
                    originalPrice: 396,
                    days: 360,
                    isNewUser: false
                }
            };
            
            function init() {
                loadMembershipData();
                generateReferralCode();
                updateMembershipStatus();
                checkMembershipExpiry();
            }
            
            function loadMembershipData() {
                const saved = localStorage.getItem('membership_data');
                if (saved) {
                    membershipData = JSON.parse(saved);
                }
            }
            
            function saveMembershipData() {
                localStorage.setItem('membership_data', JSON.stringify(membershipData));
            }
            
            function generateReferralCode() {
                if (!membershipData.referralCode) {
                    // ç”Ÿæˆ8ä½æ¨èç 
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                    let result = '';
                    for (let i = 0; i < 8; i++) {
                        result += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    membershipData.referralCode = result;
                    saveMembershipData();
                }
                document.getElementById('myReferralCode').value = membershipData.referralCode;
            }
            
            function updateMembershipStatus() {
                const statusCard = document.getElementById('membershipStatusCard');
                const statusText = document.getElementById('membershipStatus');
                const expiryText = document.getElementById('membershipExpiry');
                
                if (membershipData.isMember && membershipData.expiryDate) {
                    const expiryDate = new Date(membershipData.expiryDate);
                    const now = new Date();
                    
                    if (expiryDate > now) {
                        statusText.textContent = `ğŸ‘‘ ${packages[membershipData.packageType]?.name || 'ä¼šå‘˜'}`;
                        expiryText.textContent = `åˆ°æœŸæ—¶é—´ï¼š${expiryDate.toLocaleDateString()}`;
                        statusCard.style.background = 'linear-gradient(135deg, #ff6b35 0%, #f7931e 100%)';
                    } else {
                        // ä¼šå‘˜å·²è¿‡æœŸ
                        membershipData.isMember = false;
                        membershipData.expiryDate = null;
                        membershipData.packageType = null;
                        saveMembershipData();
                        showMembershipExpired();
                    }
                } else {
                    statusText.textContent = 'å…è´¹ç”¨æˆ·';
                    expiryText.textContent = 'ç«‹å³å¼€é€šä¼šå‘˜ï¼Œäº«å—æ›´å¤šåŠŸèƒ½';
                    statusCard.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
            }
            
            function showMembershipExpired() {
                const statusText = document.getElementById('membershipStatus');
                const expiryText = document.getElementById('membershipExpiry');
                statusText.textContent = 'ä¼šå‘˜å·²è¿‡æœŸ';
                expiryText.textContent = 'ç»­è´¹ä¼šå‘˜ï¼Œç»§ç»­äº«å—ç‰¹æƒ';
            }
            
            function checkMembershipExpiry() {
                if (membershipData.isMember && membershipData.expiryDate) {
                    const expiryDate = new Date(membershipData.expiryDate);
                    const now = new Date();
                    const daysLeft = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysLeft <= 7 && daysLeft > 0) {
                        showExpiryWarning(daysLeft);
                    }
                }
            }
            
            function showExpiryWarning(daysLeft) {
                const message = `æ‚¨çš„ä¼šå‘˜å°†åœ¨${daysLeft}å¤©ååˆ°æœŸï¼Œè¯·åŠæ—¶ç»­è´¹ï¼`;
                if (confirm(message)) {
                    showPurchaseModal();
                }
            }
            
            function showPurchaseModal() {
                // 1. åˆ‡æ¢åˆ°ä¼šå‘˜Tab
                const tabItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                
                // ç§»é™¤æ‰€æœ‰activeç±»
                tabItems.forEach(tab => tab.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // æ¿€æ´»ä¼šå‘˜Tab
                const membershipTab = document.querySelector('[data-tab="membership"]');
                const membershipContent = document.getElementById('membership');
                if (membershipTab) membershipTab.classList.add('active');
                if (membershipContent) membershipContent.classList.add('active');
                
                // 2. æ˜¾ç¤ºè´­ä¹°å¥—é¤åŒºåŸŸå¹¶æ»šåŠ¨åˆ°é‚£é‡Œ
                setTimeout(() => {
                    const packagesDiv = document.getElementById('membershipPackages');
                    if (packagesDiv) {
                        packagesDiv.style.display = 'block';
                        packagesDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100); // çŸ­æš‚å»¶è¿Ÿç¡®ä¿Tabåˆ‡æ¢å®Œæˆ
            }
            
            function selectPackage(packageType) {
                const packageInfo = packages[packageType];
                if (!packageInfo) return;
                
                const confirmMessage = `ç¡®è®¤è´­ä¹°${packageInfo.name}ï¼Ÿ\nä»·æ ¼ï¼šÂ¥${packageInfo.price}ï¼ˆåŸä»·Â¥${packageInfo.originalPrice}ï¼‰\nä¼šå‘˜å¤©æ•°ï¼š${packageInfo.days}å¤©`;
                
                if (confirm(confirmMessage)) {
                    processPurchase(packageType);
                }
            }
            
            function processPurchase(packageType) {
                const packageInfo = packages[packageType];
                const now = new Date();
                const expiryDate = new Date(now.getTime() + packageInfo.days * 24 * 60 * 60 * 1000);
                
                // æ›´æ–°ä¼šå‘˜çŠ¶æ€
                membershipData.isMember = true;
                membershipData.expiryDate = expiryDate.toISOString();
                membershipData.packageType = packageType;
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ¨èäººå¥–åŠ±
                if (membershipData.referredBy) {
                    addReferralReward(membershipData.referredBy, packageType);
                }
                
                saveMembershipData();
                updateMembershipStatus();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showSuccessMessage(`æ­å–œï¼æ‚¨å·²æˆåŠŸå¼€é€š${packageInfo.name}ï¼Œäº«å—${packageInfo.days}å¤©ä¼šå‘˜æƒç›Šï¼`);
                
                // éšè—å¥—é¤é€‰æ‹©
                document.getElementById('membershipPackages').style.display = 'none';
            }
            
            function addReferralReward(referrerCode, packageType) {
                // æ¨èäººè·å¾—20å¤©å¥–åŠ±
                const referrerData = JSON.parse(localStorage.getItem(`referrer_${referrerCode}`) || '{}');
                const currentExpiry = referrerData.expiryDate ? new Date(referrerData.expiryDate) : new Date();
                const newExpiry = new Date(currentExpiry.getTime() + 20 * 24 * 60 * 60 * 1000);
                referrerData.expiryDate = newExpiry.toISOString();
                referrerData.referralCount = (referrerData.referralCount || 0) + 1;
                localStorage.setItem(`referrer_${referrerCode}`, JSON.stringify(referrerData));
                
                // å¦‚æœæ˜¯é¦–æ¬¡è´­ä¹°ï¼Œæ¨èäººé¢å¤–è·å¾—40å¤©
                if (packageType !== 'monthly') {
                    const extraExpiry = new Date(newExpiry.getTime() + 40 * 24 * 60 * 60 * 1000);
                    referrerData.expiryDate = extraExpiry.toISOString();
                    localStorage.setItem(`referrer_${referrerCode}`, JSON.stringify(referrerData));
                }
            }
            
            function applyReferralCode() {
                const code = document.getElementById('referralCodeInput').value.trim();
                if (!code) {
                    alert('è¯·è¾“å…¥æ¨èç ');
                    return;
                }
                
                if (code === membershipData.referralCode) {
                    alert('ä¸èƒ½ä½¿ç”¨è‡ªå·±çš„æ¨èç ');
                    return;
                }
                
                // æ£€æŸ¥æ¨èç æ˜¯å¦å­˜åœ¨
                const referrerData = JSON.parse(localStorage.getItem(`referrer_${code}`) || '{}');
                if (!referrerData.expiryDate || new Date(referrerData.expiryDate) <= new Date()) {
                    alert('æ¨èç æ— æ•ˆæˆ–å·²è¿‡æœŸ');
                    return;
                }
                
                // åº”ç”¨æ¨èç 
                membershipData.referredBy = code;
                saveMembershipData();
                
                // ç»™åŒæ–¹æ·»åŠ å¥–åŠ±å¤©æ•°
                const now = new Date();
                
                // è¢«æ¨èäººè·å¾—7å¤©
                if (membershipData.isMember && membershipData.expiryDate) {
                    const currentExpiry = new Date(membershipData.expiryDate);
                    const newExpiry = new Date(Math.max(currentExpiry, now).getTime() + 7 * 24 * 60 * 60 * 1000);
                    membershipData.expiryDate = newExpiry.toISOString();
                } else {
                    const newExpiry = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
                    membershipData.isMember = true;
                    membershipData.expiryDate = newExpiry.toISOString();
                    membershipData.packageType = 'referral';
                }
                
                // æ¨èäººè·å¾—20å¤©
                const referrerExpiry = new Date(referrerData.expiryDate);
                const referrerNewExpiry = new Date(referrerExpiry.getTime() + 20 * 24 * 60 * 60 * 1000);
                referrerData.expiryDate = referrerNewExpiry.toISOString();
                referrerData.referralCount = (referrerData.referralCount || 0) + 1;
                localStorage.setItem(`referrer_${code}`, JSON.stringify(referrerData));
                
                saveMembershipData();
                updateMembershipStatus();
                
                showSuccessMessage('æ¨èç ä½¿ç”¨æˆåŠŸï¼æ‚¨è·å¾—äº†7å¤©ä¼šå‘˜æƒç›Šï¼Œæ¨èäººä¹Ÿè·å¾—äº†20å¤©å¥–åŠ±ï¼');
                document.getElementById('referralCodeInput').value = '';
            }
            
            function copyReferralCode() {
                const code = membershipData.referralCode;
                navigator.clipboard.writeText(code).then(() => {
                    showSuccessMessage('æ¨èç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    // é™çº§æ–¹æ¡ˆ
                    const input = document.getElementById('myReferralCode');
                    input.select();
                    document.execCommand('copy');
                    showSuccessMessage('æ¨èç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            }
            
            function showSuccessMessage(message) {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            function isMember() {
                // æµ‹è¯•é˜¶æ®µï¼šä¸´æ—¶è¿”å›trueï¼Œå¯ç”¨æ‰€æœ‰ä¼šå‘˜åŠŸèƒ½
                return true;
                
                // åŸå§‹ä»£ç ï¼ˆå·²æ³¨é‡Šï¼‰ï¼š
                // return membershipData.isMember && 
                //        membershipData.expiryDate && 
                //        new Date(membershipData.expiryDate) > new Date();
            }
            
            function getMemberDaysLeft() {
                if (!isMember()) return 0;
                const expiryDate = new Date(membershipData.expiryDate);
                const now = new Date();
                return Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
            }
            
            return {
                init: init,
                isMember: isMember,
                getMemberDaysLeft: getMemberDaysLeft,
                showPurchaseModal: showPurchaseModal,
                selectPackage: selectPackage,
                applyReferralCode: applyReferralCode,
                copyReferralCode: copyReferralCode
            };
        })();
        
        // ========== è®¾ç½®ç³»ç»Ÿ JavaScript ==========
        const Settings = (function() {
            let userData = {
                isLoggedIn: false,
                username: null,
                email: null,
                loginTime: null
            };
            
            let settingsData = {
                theme: 'light',
                fontSize: 'medium',
                autoSave: true,
                priceHint: true,
                vibration: false
            };
            
            function init() {
                loadUserData();
                loadSettings();
                updateUserInfo();
                applySettings();
                bindEvents();
                checkLoginStatus(); // æ£€æŸ¥ç™»å½•çŠ¶æ€
            }
            
            function loadUserData() {
                const saved = localStorage.getItem('user_data');
                if (saved) {
                    userData = JSON.parse(saved);
                }
            }
            
            function saveUserData() {
                localStorage.setItem('user_data', JSON.stringify(userData));
            }
            
            function loadSettings() {
                const saved = localStorage.getItem('settings_data');
                if (saved) {
                    settingsData = JSON.parse(saved);
                }
                updateSettingsUI();
            }
            
            function saveSettings() {
                localStorage.setItem('settings_data', JSON.stringify(settingsData));
            }
            
            function updateSettingsUI() {
                document.getElementById('themeSelect').value = settingsData.theme;
                document.getElementById('fontSizeSelect').value = settingsData.fontSize;
                document.getElementById('autoSave').checked = settingsData.autoSave;
                document.getElementById('priceHint').checked = settingsData.priceHint;
                document.getElementById('vibration').checked = settingsData.vibration;
            }
            
            function updateUserInfo() {
                const userName = document.getElementById('userName');
                const userStatus = document.getElementById('userStatus');
                const loginBtn = document.getElementById('loginBtn');
                
                if (userData.isLoggedIn) {
                    userName.textContent = userData.username;
                    userStatus.textContent = `ç™»å½•æ—¶é—´ï¼š${new Date(userData.loginTime).toLocaleString()}`;
                    loginBtn.textContent = 'é€€å‡º';
                    loginBtn.onclick = logout;
                } else {
                    userName.textContent = 'æœªç™»å½•';
                    userStatus.textContent = 'ç‚¹å‡»ç™»å½•äº«å—æ›´å¤šåŠŸèƒ½';
                    loginBtn.textContent = 'ç™»å½•';
                    loginBtn.onclick = showLoginModal;
                }
            }
            
            function bindEvents() {
                // ç™»å½•è¡¨å•
                document.getElementById('loginForm').addEventListener('submit', handleLogin);
                
                // æ³¨å†Œè¡¨å•
                document.getElementById('registerForm').addEventListener('submit', handleRegister);
                
                // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
                window.addEventListener('click', function(event) {
                    const loginModal = document.getElementById('loginModal');
                    const registerModal = document.getElementById('registerModal');
                    const helpModal = document.getElementById('helpModal');
                    
                    if (event.target === loginModal) {
                        closeLoginModal();
                    }
                    if (event.target === registerModal) {
                        closeRegisterModal();
                    }
                    if (helpModal && event.target === helpModal) {
                        closeHelpModal();
                    }
                });
            }
            
            function showLoginModal() {
                document.getElementById('loginModal').style.display = 'block';
            }
            
            function closeLoginModal() {
                document.getElementById('loginModal').style.display = 'none';
            }
            
            function showRegisterModal() {
                closeLoginModal();
                document.getElementById('registerModal').style.display = 'block';
            }
            
            function closeRegisterModal() {
                document.getElementById('registerModal').style.display = 'none';
            }
            
            function handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const rememberMe = document.getElementById('rememberMe').checked;
                
                // ç®€å•çš„æ¨¡æ‹Ÿç™»å½•éªŒè¯
                if (username && password) {
                    userData.isLoggedIn = true;
                    userData.username = username;
                    userData.loginTime = new Date().toISOString();
                    
                    if (rememberMe) {
                        saveUserData();
                    }
                    
                    updateUserInfo();
                    closeLoginModal();
                    showSuccessMessage('ç™»å½•æˆåŠŸï¼');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('loginForm').reset();
                } else {
                    alert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ');
                }
            }
            
            function handleRegister(e) {
                e.preventDefault();
                const username = document.getElementById('regUsername').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const email = document.getElementById('regEmail').value;
                
                if (password !== confirmPassword) {
                    alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                    return;
                }
                
                if (username && password) {
                    // æ¨¡æ‹Ÿæ³¨å†ŒæˆåŠŸ
                    showSuccessMessage('æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•');
                    closeRegisterModal();
                    showLoginModal();
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('registerForm').reset();
                } else {
                    alert('è¯·å¡«å†™å¿…è¦ä¿¡æ¯');
                }
            }
            
            function logout() {
                userData.isLoggedIn = false;
                userData.username = null;
                userData.email = null;
                userData.loginTime = null;
                
                localStorage.removeItem('user_data');
                updateUserInfo();
                showSuccessMessage('å·²é€€å‡ºç™»å½•');
            }
            
            function changeTheme() {
                const theme = document.getElementById('themeSelect').value;
                settingsData.theme = theme;
                saveSettings();
                applyTheme(theme);
            }
            
            function applyTheme(theme) {
                const body = document.body;
                body.className = body.className.replace(/theme-\w+/g, '');
                
                if (theme === 'dark') {
                    body.classList.add('theme-dark');
                } else if (theme === 'auto') {
                    // è·Ÿéšç³»ç»Ÿä¸»é¢˜
                    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        body.classList.add('theme-dark');
                    }
                }
            }
            
            function changeFontSize() {
                const fontSize = document.getElementById('fontSizeSelect').value;
                settingsData.fontSize = fontSize;
                saveSettings();
                applyFontSize(fontSize);
            }
            
            function applyFontSize(size) {
                const body = document.body;
                body.className = body.className.replace(/font-\w+/g, '');
                body.classList.add(`font-${size}`);
            }
            
            function toggleAutoSave() {
                settingsData.autoSave = document.getElementById('autoSave').checked;
                saveSettings();
            }
            
            function togglePriceHint() {
                settingsData.priceHint = document.getElementById('priceHint').checked;
                saveSettings();
            }
            
            function toggleVibration() {
                settingsData.vibration = document.getElementById('vibration').checked;
                saveSettings();
            }
            
            function applySettings() {
                applyTheme(settingsData.theme);
                applyFontSize(settingsData.fontSize);
            }
            
            function exportData() {
                const allData = {
                    userData: userData,
                    settingsData: settingsData,
                    membershipData: JSON.parse(localStorage.getItem('membership_data') || '{}'),
                    productManagerData: JSON.parse(localStorage.getItem('productManager_data') || '{}'),
                    priceAdjusterData: JSON.parse(localStorage.getItem('priceAdjuster_data') || '{}'),
                    symbolChangerData: JSON.parse(localStorage.getItem('symbolChanger_data') || '{}')
                };
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `å®¶ç”µæŠ¥ä»·åŠ©æ‰‹_æ•°æ®å¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showSuccessMessage('æ•°æ®å¯¼å‡ºæˆåŠŸï¼');
            }
            
            function importData() {
                const file = document.getElementById('importFile').files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // æ¢å¤å„ç§æ•°æ®
                        if (data.userData) {
                            localStorage.setItem('user_data', JSON.stringify(data.userData));
                            userData = data.userData;
                        }
                        if (data.settingsData) {
                            localStorage.setItem('settings_data', JSON.stringify(data.settingsData));
                            settingsData = data.settingsData;
                        }
                        if (data.membershipData) {
                            localStorage.setItem('membership_data', JSON.stringify(data.membershipData));
                        }
                        if (data.productManagerData) {
                            localStorage.setItem('productManager_data', JSON.stringify(data.productManagerData));
                        }
                        if (data.priceAdjusterData) {
                            localStorage.setItem('priceAdjuster_data', JSON.stringify(data.priceAdjusterData));
                        }
                        if (data.symbolChangerData) {
                            localStorage.setItem('symbolChanger_data', JSON.stringify(data.symbolChangerData));
                        }
                        
                        // æ›´æ–°ç•Œé¢
                        updateUserInfo();
                        updateSettingsUI();
                        applySettings();
                        
                        showSuccessMessage('æ•°æ®å¯¼å…¥æˆåŠŸï¼');
                    } catch (error) {
                        alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„å¤‡ä»½æ–‡ä»¶');
                    }
                };
                reader.readAsText(file);
            }
            
            function clearData() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    localStorage.clear();
                    location.reload();
                }
            }
            
            function showFeedback() {
                alert('æ„è§åé¦ˆåŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
            }
            
            // ä¸€é”®ç™»å½•å¤„ç†
            function handlePhoneLogin() {
                console.log('ä¸€é”®ç™»å½•è¢«ç‚¹å‡»');
                console.log('ALIYUN_CONFIG:', ALIYUN_CONFIG);
                console.log('PhoneNumberServeræ˜¯å¦åŠ è½½:', typeof PhoneNumberServer);
                console.log('window.PhoneNumberServer:', typeof window.PhoneNumberServer);
                console.log('æ‰€æœ‰windowå±æ€§:', Object.keys(window).filter(key => key.includes('Phone') || key.includes('Aliyun')));
                
                // å…ˆæ˜¾ç¤ºä¸€ä¸ªæ˜æ˜¾çš„æç¤º
                alert('ä¸€é”®ç™»å½•è¢«ç‚¹å‡»ï¼\n\næ­£åœ¨æ£€æŸ¥SDKçŠ¶æ€...\n\nPhoneNumberServer: ' + (typeof PhoneNumberServer) + '\nwindow.PhoneNumberServer: ' + (typeof window.PhoneNumberServer));
                
                // æ£€æŸ¥SDKæ˜¯å¦åŠ è½½æˆåŠŸ
                if (typeof PhoneNumberServer === 'undefined' && typeof window.PhoneNumberServer === 'undefined') {
                    console.log('é˜¿é‡Œäº‘SDKæœªåŠ è½½ï¼Œå›é€€åˆ°å¼€å‘æ¨¡å¼');
                    alert('é˜¿é‡Œäº‘SDKæœªåŠ è½½ï¼Œåˆ‡æ¢åˆ°æ¨¡æ‹Ÿæ¨¡å¼');
                    showPhoneLoginModal();
                    return;
                }
                
                if (ALIYUN_CONFIG.isDevelopment) {
                    // å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                    console.log('ä½¿ç”¨å¼€å‘æ¨¡å¼');
                    alert('å½“å‰ä¸ºå¼€å‘æ¨¡å¼');
                    showPhoneLoginModal();
                } else {
                    // ç”Ÿäº§æ¨¡å¼ï¼šè°ƒç”¨é˜¿é‡Œäº‘ SDK
                    console.log('ä½¿ç”¨ç”Ÿäº§æ¨¡å¼');
                    alert('å½“å‰ä¸ºç”Ÿäº§æ¨¡å¼ï¼Œå‡†å¤‡è°ƒç”¨é˜¿é‡Œäº‘SDK');
                    callAliyunPhoneAuth();
                }
            }
            
            // æ˜¾ç¤ºæ‰‹æœºå·ç™»å½•æ¨¡æ€æ¡†ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
            function showPhoneLoginModal() {
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'block';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2>ğŸ“± ä¸€é”®ç™»å½•</h2>
                            <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div style="text-align: center; padding: 20px;">
                                <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
                                <h3 style="margin: 0 0 8px 0;">é˜¿é‡Œäº‘å®¡æ ¸ä¸­</h3>
                                <p style="color: #666; margin: 0 0 20px 0;">æ‚¨çš„å·ç è®¤è¯æ–¹æ¡ˆæ­£åœ¨é˜¿é‡Œäº‘å®¡æ ¸ä¸­ï¼Œé¢„è®¡1-2ä¸ªå·¥ä½œæ—¥ç”Ÿæ•ˆ</p>
                                <div style="background: #fff3cd; padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                                    <p style="margin: 0; font-size: 14px; color: #856404;">
                                        <strong>å½“å‰çŠ¶æ€ï¼š</strong>å®¡æ ¸ä¸­<br>
                                        <strong>æ–¹æ¡ˆ Codeï¼š</strong>${ALIYUN_CONFIG.sceneCode}<br>
                                        <strong>é¢„è®¡ç”Ÿæ•ˆï¼š</strong>1-2ä¸ªå·¥ä½œæ—¥
                                    </p>
                                </div>
                                <div style="background: #f0f8ff; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                                    <p style="margin: 0; font-size: 14px; color: #333;">
                                        <strong>ä¸´æ—¶æµ‹è¯•ï¼š</strong>ä½¿ç”¨æ¨¡æ‹Ÿç™»å½•åŠŸèƒ½
                                    </p>
                                </div>
                                <button class="btn btn-primary" onclick="Settings.simulatePhoneLogin()" style="width: 100%;">
                                    æ¨¡æ‹Ÿç™»å½•æµ‹è¯•
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            // æ¨¡æ‹Ÿæ‰‹æœºå·ç™»å½•
            function simulatePhoneLogin() {
                // æ¨¡æ‹Ÿè°ƒç”¨åç«¯éªŒè¯æ¥å£
                const mockToken = 'mock_token_' + Date.now();
                
                fetch('/.netlify/functions/auth/verify-phone', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: mockToken })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // ä¿å­˜ JWT å’Œç”¨æˆ·ä¿¡æ¯
                        localStorage.setItem('jwt', data.jwt);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        
                        // æ›´æ–° UI
                        updateUserInfo(data.user);
                        
                        // å…³é—­æ¨¡æ€æ¡†
                        document.querySelector('.modal').remove();
                        
                        showSuccessMessage('ç™»å½•æˆåŠŸï¼');
                    } else {
                        alert('ç™»å½•å¤±è´¥ï¼š' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    alert('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
            }
            
            // è°ƒç”¨é˜¿é‡Œäº‘å·ç è®¤è¯ SDKï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
            function callAliyunPhoneAuth() {
                if (typeof PhoneNumberServer === 'undefined') {
                    alert('é˜¿é‡Œäº‘SDKåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                    return;
                }
                
                const phoneNumberServer = new PhoneNumberServer();
                
                // ç¬¬ä¸€æ­¥ï¼šè·å–accessTokenå’ŒjwtToken
                getAuthTokens()
                    .then(({ accessToken, jwtToken }) => {
                        // ç¬¬äºŒæ­¥ï¼šèº«ä»½é‰´æƒ
                        phoneNumberServer.checkLoginAvailable({
                            accessToken: accessToken,
                            jwtToken: jwtToken,
                            success: function (res) {
                                console.log('é‰´æƒæˆåŠŸ', res);
                                if (res.code === 600000) {
                                    // ç¬¬ä¸‰æ­¥ï¼šè·å–ç™»å½•Token
                                    getLoginToken(phoneNumberServer);
                                } else {
                                    alert('é‰´æƒå¤±è´¥ï¼š' + (res.message || 'æœªçŸ¥é”™è¯¯'));
                                }
                            },
                            error: function (res) {
                                console.log('é‰´æƒå¤±è´¥', res);
                                alert('é‰´æƒå¤±è´¥ï¼Œè¯·å…³é—­WiFiä½¿ç”¨ç§»åŠ¨ç½‘ç»œé‡è¯•');
                            }
                        });
                    })
                    .catch(error => {
                        console.error('è·å–Tokenå¤±è´¥:', error);
                        alert('è·å–è®¤è¯Tokenå¤±è´¥ï¼š' + error.message);
                    });
            }
            
            // è·å–è®¤è¯Token
            function getAuthTokens() {
                console.log('å¼€å§‹è·å–è®¤è¯Token...');
                
                // å…ˆæµ‹è¯•ç®€å•å‡½æ•°
                return fetch('/.netlify/functions/auth/simple-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ test: 'data' })
                })
                .then(response => {
                    console.log('simple-testå“åº”çŠ¶æ€:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('simple-testå“åº”ç»“æœ:', data);
                    
                    // ç°åœ¨æµ‹è¯•çœŸå®å‡½æ•°
                    return fetch('/.netlify/functions/auth/get-auth-token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ sceneCode: ALIYUN_CONFIG.sceneCode })
                    });
                })
                .then(response => {
                    console.log('get-auth-tokenå“åº”çŠ¶æ€:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('get-auth-tokenå“åº”ç»“æœ:', data);
                    if (data.success) {
                        return { accessToken: data.accessToken, jwtToken: data.jwtToken };
                    } else {
                        throw new Error(data.message || 'è·å–Tokenå¤±è´¥');
                    }
                });
            }
            
            // è·å–ç™»å½•Token
            function getLoginToken(phoneNumberServer) {
                phoneNumberServer.getLoginToken({
                    success: function (res) {
                        console.log('è·å–ç™»å½•TokenæˆåŠŸ', res);
                        // ç¬¬å››æ­¥ï¼šæœåŠ¡ç«¯å–å·
                        getPhoneNumber(res.spToken);
                    },
                    error: function (res) {
                        console.log('è·å–ç™»å½•Tokenå¤±è´¥', res);
                        alert('è·å–ç™»å½•Tokenå¤±è´¥ï¼š' + (res.message || 'æœªçŸ¥é”™è¯¯'));
                    },
                    watch: function (status, data) {
                        console.log('æˆæƒé¡µçŠ¶æ€:', status, data);
                    }
                });
            }
            
            // æœåŠ¡ç«¯å–å·
            function getPhoneNumber(spToken) {
                fetch('/.netlify/functions/auth/verify-phone', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ spToken: spToken })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        localStorage.setItem('jwt', data.jwt);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        updateUserInfo(data.user);
                        showSuccessMessage('ç™»å½•æˆåŠŸï¼');
                    } else {
                        alert('ç™»å½•å¤±è´¥ï¼š' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Login error:', error);
                    alert('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
            }
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            function updateUserInfo(user) {
                const userName = document.getElementById('userName');
                const userStatus = document.getElementById('userStatus');
                const loginButtons = document.getElementById('loginButtons');
                
                if (user) {
                    userName.textContent = user.phone || 'å·²ç™»å½•';
                    userStatus.textContent = user.isMember ? 
                        `ä¼šå‘˜ç”¨æˆ· | åˆ°æœŸï¼š${new Date(user.memberExpireAt).toLocaleDateString()}` : 
                        'å…è´¹ç”¨æˆ·';
                    
                    loginButtons.innerHTML = `
                        <button class="btn btn-danger" onclick="Settings.logout()">é€€å‡ºç™»å½•</button>
                    `;
                } else {
                    userName.textContent = 'æœªç™»å½•';
                    userStatus.textContent = 'ç‚¹å‡»ç™»å½•äº«å—æ›´å¤šåŠŸèƒ½';
                    loginButtons.innerHTML = `
                        <button class="btn btn-primary" onclick="Settings.handlePhoneLogin()" id="phoneLoginBtn">ğŸ“± ä¸€é”®ç™»å½•</button>
                        <button class="btn btn-secondary" onclick="Settings.showLoginModal()" id="otherLoginBtn">å…¶ä»–ç™»å½•</button>
                    `;
                }
            }
            
            // é€€å‡ºç™»å½•
            function logout() {
                localStorage.removeItem('jwt');
                localStorage.removeItem('user');
                updateUserInfo(null);
                showSuccessMessage('å·²é€€å‡ºç™»å½•');
            }
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            function checkLoginStatus() {
                const jwt = localStorage.getItem('jwt');
                const user = localStorage.getItem('user');
                
                if (jwt && user) {
                    try {
                        const userData = JSON.parse(user);
                        updateUserInfo(userData);
                    } catch (error) {
                        console.error('Parse user data error:', error);
                        logout();
                    }
                }
            }

            function showHelp() {
                let helpModal = document.getElementById('helpModal');
                if (!helpModal) {
                    helpModal = document.createElement('div');
                    helpModal.id = 'helpModal';
                    helpModal.className = 'modal';
                    helpModal.innerHTML = `
                        <div class="modal-content" style="max-width: 520px; width: 92%;">
                            <div class="modal-header">
                                <h2>ä½¿ç”¨å¸®åŠ©</h2>
                                <span class="close" onclick="Settings.closeHelpModal()">&times;</span>
                            </div>
                            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                                <div style="display: grid; gap: 16px;">
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ“Œ å¯¼èˆªä¸åˆ‡æ¢</h3>
                                        <p style="margin:0; color:#555; font-size:14px;">é¡¶éƒ¨æ ‡ç­¾æ åœ¨ <strong>äº§å“ç®¡ç† / ä»·æ ¼è°ƒæ•´ / ç¬¦å·æ›´æ¢ / ä¼šå‘˜ / è®¾ç½®</strong> ä¹‹é—´åˆ‡æ¢ã€‚</p>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ—‚ äº§å“ç®¡ç†</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>ç²˜è´´æ–‡æœ¬åç‚¹"è§£ææ–‡æœ¬"ã€‚</li>
                                            <li>ç‚¹æ¯è¡Œå¯ç›´æ¥ç¼–è¾‘ï¼›æ”¯æŒæ’åºä¸æ‰¹é‡åˆ é™¤ã€‚</li>
                                            <li>"å¤åˆ¶ç»“æœ"æŒ‰å½“å‰æ’åºè¾“å‡ºï¼Œä¿æŒæ®µè½é¡ºåºã€‚</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ’° ä»·æ ¼è°ƒæ•´</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>æ”¯æŒç™¾åˆ†æ¯”/å›ºå®šé¢è°ƒä»·ï¼Œé»˜è®¤ <strong>+5%</strong>ï¼Œå¹¶å¯å››èˆäº”å…¥åˆ°åä½ã€‚</li>
                                            <li>å¯å¼€å¯åŒºé—´è°ƒä»·ï¼š0-999ã€1000-1999ã€2000-4999ã€5000-9999ã€10000+ã€‚</li>
                                            <li>é¢œè‰²æç¤ºï¼šç´«-æ‰‹åŠ¨ã€çº¢-ä¸Šæ¶¨ã€ç»¿-ä¸‹é™ã€‚</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ”„ ç¬¦å·æ›´æ¢</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>æ‰¹é‡æ›¿æ¢ä»·æ ¼å‰ç¬¦å·ï¼ˆå¦‚ ğŸ’°ã€ã€å‘ã€‘ï¼‰ã€‚</li>
                                            <li>å‹¾é€‰"ç»“å°¾è¯´æ˜"åï¼Œå†…å®¹ä»…è¿½åŠ åˆ°æ•´ç¯‡æœ«å°¾ä¸€æ¬¡ã€‚</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ‘‘ ä¼šå‘˜ä¸æ¨è</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>å¥—é¤ï¼šæœˆ/åŠå¹´/å¹´ï¼Œè´­ä¹°åè§£é”æ— é™åˆ¶ä¸ä¼˜å…ˆæ”¯æŒã€‚</li>
                                            <li>æ¨èç ï¼šA è· 20 å¤©ï¼ŒB è· 7 å¤©ï¼›B é¦–è´­ï¼ŒA å†åŠ  40 å¤©ã€‚</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">âš™ï¸ è®¾ç½®ä¸æ•°æ®</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>ä¸»é¢˜ï¼šæµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿï¼›å­—ä½“ï¼šå°/ä¸­/å¤§ã€‚</li>
                                            <li>æ•°æ®ï¼šå¯¼å…¥/å¯¼å‡ºå¤‡ä»½ï¼Œä¸€é”®æ¸…é™¤é‡ç½®ã€‚</li>
                                            <li>ç™»å½•ï¼šæ”¯æŒè®°ä½æˆ‘ä¸è‡ªåŠ¨ç™»å½•ã€‚</li>
                                        </ul>
                                    </div>
                                    <div style="background:#f8f9fa; border-radius:10px; padding:12px;">
                                        <h3 style="margin:0 0 8px 0; font-size:16px;">ğŸ“² å®‰è£…ä¸ºæ‰‹æœºAPP</h3>
                                        <ul style="margin:0; padding-left:18px; color:#555; font-size:14px;">
                                            <li>Edge/Chrome æ‰“å¼€ç«™ç‚¹ â†’ èœå• â†’ æ·»åŠ åˆ°ä¸»å±ï¼ˆå®‰è£…ï¼‰ã€‚</li>
                                            <li>æ›´æ–°ï¼šä¸‹æ‹‰åˆ·æ–°æˆ–é‡æ–°æ‰“å¼€å³å¯è·å–æœ€æ–°ç‰ˆã€‚</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(helpModal);
                }
                helpModal.style.display = 'block';
            }

            function closeHelpModal() {
                const helpModal = document.getElementById('helpModal');
                if (helpModal) helpModal.style.display = 'none';
            }
            
            function showSuccessMessage(message) {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 15px 30px;
                    border-radius: 8px;
                    font-size: 16px;
                    z-index: 10001;
                `;
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            return {
                init: init,
                showLoginModal: showLoginModal,
                closeLoginModal: closeLoginModal,
                showRegisterModal: showRegisterModal,
                closeRegisterModal: closeRegisterModal,
                changeTheme: changeTheme,
                changeFontSize: changeFontSize,
                toggleAutoSave: toggleAutoSave,
                togglePriceHint: togglePriceHint,
                toggleVibration: toggleVibration,
                exportData: exportData,
                importData: importData,
                clearData: clearData,
                showFeedback: showFeedback,
                showHelp: showHelp,
                closeHelpModal: closeHelpModal,
                handlePhoneLogin: handlePhoneLogin,
                simulatePhoneLogin: simulatePhoneLogin,
                logout: logout
            };
        })();
        
        // ========== å†å²è®°å½•ç®¡ç†å™¨ ==========
        const HistoryManager = (function() {
            let historyRecords = [];
            let isCompareMode = false;
            let selectedRecords = [];
            
            function init() {
                loadRecords();
                populateYearOptions();
                // ç»Ÿä¸€ç›‘å¬å†å²æ›´æ–°äº‹ä»¶ï¼Œæ”¶åˆ°åç«‹å³åˆ·æ–°è§†å›¾ä¸æ—¥å†
                window.addEventListener('history:updated', function() {
                    renderCalendar();
                    renderRecords();
                });
            }
            
            function loadRecords() {
                const saved = localStorage.getItem('historyRecords');
                if (saved) {
                    historyRecords = JSON.parse(saved);
                }
            }
            
            function saveRecords() {
                localStorage.setItem('historyRecords', JSON.stringify(historyRecords));
            }
            
            function populateYearOptions() {
                const yearSelect = document.getElementById('historyYearSelect');
                if (!yearSelect) return;
                
                const currentYear = new Date().getFullYear();
                const years = [currentYear];
                historyRecords.forEach(record => {
                    const recordYear = new Date(record.timestamp).getFullYear();
                    if (!years.includes(recordYear)) {
                        years.push(recordYear);
                    }
                });
                years.sort((a, b) => b - a);
                
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year + 'å¹´';
                    yearSelect.appendChild(option);
                });
            }
            
            function saveRecord(source, title) {
                // é»˜è®¤æ¥æºä¸ºäº§å“ç®¡ç†
                if (!source) source = 'productManager';
                
                // æ ¹æ®æ¥æºç¡®å®šæˆªå›¾ç›®æ ‡å®¹å™¨
                let container, products = [];
                
                if (source === 'productManager') {
                    container = document.getElementById('pm_resultsContainer');
                    if (!container || container.children.length === 0) {
                        alert('è¯·å…ˆè§£æå¹¶è·å–äº§å“åˆ—è¡¨');
                        return;
                    }
                    
                    // æå–äº§å“ä¿¡æ¯ï¼ˆä¸â€œå¤åˆ¶ç»“æœâ€ä¸€è‡´ï¼Œè¯»å– .item-textï¼›æ— ä»·æ ¼ä¹Ÿä¿å­˜ï¼‰
                    container.querySelectorAll('.result-item').forEach(item => {
                        const textEl = item.querySelector('.item-text');
                        const fallbackEl = item.querySelector('.result-text');
                        const text = (textEl ? textEl.textContent : (fallbackEl ? fallbackEl.textContent : item.textContent)).trim();
                        const prices = findExplicitPrices(text);
                        products.push({
                            text: text,
                            price: prices.length > 0 ? prices[0] : ''
                        });
                    });
                } else if (source === 'priceAdjuster') {
                    container = document.getElementById('pa_resultArea');
                    if (!container || container.children.length === 0) {
                        alert('è¯·å…ˆè§£æå¹¶è·å–è°ƒä»·ç»“æœ');
                        return;
                    }
                    
                    // æå–è°ƒä»·æ•°æ®ï¼ˆä»¥ PriceAdjuster.displayResults ç”Ÿæˆçš„ç»“æ„ä¸ºå‡†ï¼‰
                    container.querySelectorAll('.result-item').forEach(item => {
                        const contentEl = item.querySelector('.result-content');
                        const originalPriceEl = item.querySelector('.result-price.original');
                        const newPriceEl = item.querySelector('.result-price.new');
                        const textContent = (contentEl ? contentEl.textContent : '').trim();
                        if (!textContent) return;
                        if (originalPriceEl && newPriceEl) {
                            products.push({
                                text: textContent,
                                originalPrice: originalPriceEl.textContent.replace('Â¥', '').replace(/,/g, ''),
                                newPrice: newPriceEl.textContent.replace('Â¥', '').replace(/,/g, '')
                            });
                        } else {
                            // æ— ä»·æ ¼çš„çº¯æ–‡æœ¬è¡Œä¹Ÿä¿å­˜
                            products.push({ text: textContent });
                        }
                    });
                } else if (source === 'symbolChanger') {
                    container = document.getElementById('sc_resultArea');
                    if (!container || container.children.length === 0) {
                        alert('è¯·å…ˆè§£æå¹¶è·å–ç¬¦å·æ›´æ¢ç»“æœ');
                        return;
                    }
                    
                    // æå–ç¬¦å·æ›´æ¢åçš„æ•°æ®ï¼šæŒ‰â€œå¤åˆ¶ç»“æœâ€çš„è§„åˆ™ç»„åˆ
                    container.querySelectorAll('.result-item').forEach(item => {
                        const contentEl = item.querySelector('.result-content');
                        const priceEl = item.querySelector('.result-price');
                        let line = (contentEl ? contentEl.textContent : item.textContent).trim();
                        if (priceEl && priceEl.textContent.trim()) {
                            const raw = priceEl.textContent.trim();
                            const numMatch = raw.match(/\d[\d.,]*/);
                            const num = numMatch ? numMatch[0].replace(/,/g, '') : '';
                            const sym = raw.replace(/[\d.,]/g, '');
                            if (num) {
                                const idx = line.lastIndexOf(num);
                                if (idx >= 0) {
                                    let start = idx;
                                    while (start > 0 && /[\sÂ¥$â‚¬Â£â‚¹ğŸ’°ï¿¥!@#$%^&*()_+\-=/\\`~\[\]{}|;:'",.<>?]/.test(line[start-1])) {
                                        start--;
                                    }
                                    line = line.substring(0, start) + sym + line.substring(start);
                                }
                            }
                        }
                        products.push({ text: line });
                    });
                } else {
                    alert('æœªçŸ¥çš„è®°å½•æ¥æº');
                    return;
                }
                
                const now = new Date();
                const timestamp = now.getTime();
                
                // æå–å‰ä¸¤è¡Œä½œä¸ºé¢„è§ˆæ–‡æœ¬
                let previewLines = [];
                if (products.length > 0) {
                    const firstTwo = products.slice(0, 2);
                    previewLines = firstTwo.map(p => {
                        // é™åˆ¶æ¯è¡Œé•¿åº¦ï¼Œç§»åŠ¨ç«¯çº¦25-30ä¸ªå­—ç¬¦ï¼Œæ¡Œé¢ç«¯å¯æ›´é•¿
                        let text = p.text || '';
                        // ç§»é™¤å‰åç©ºç™½
                        text = text.trim();
                        // é™åˆ¶é•¿åº¦ï¼Œé¿å…è¿‡é•¿ï¼ˆçº¦30-35ä¸ªä¸­æ–‡å­—ç¬¦ï¼‰
                        if (text.length > 35) {
                            text = text.substring(0, 35) + '...';
                        }
                        return text;
                    }).filter(line => line.length > 0); // è¿‡æ»¤ç©ºè¡Œ
                }
                
                // ç›´æ¥ä¿å­˜æ–‡æœ¬ä¿¡æ¯ï¼Œä¸ä½¿ç”¨æˆªå›¾
                const record = {
                    id: 'record_' + timestamp,
                    timestamp: timestamp,
                    date: now.toLocaleString('zh-CN'),
                    title: title || `å†å²è®°å½• - ${now.toLocaleDateString('zh-CN')}`,
                    thumbnail: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2Y1ZjVmNSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTk5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj7liJvlu7rogIU8L3RleHQ+PC9zdmc+',
                    source: source, // æ·»åŠ æ¥æºå­—æ®µ
                    productCount: products.length,
                    products: products,
                    previewText: previewLines // æ·»åŠ é¢„è§ˆæ–‡æœ¬å­—æ®µ
                };
                
                historyRecords.unshift(record); // æœ€æ–°è®°å½•æ”¾åœ¨æœ€å‰é¢
                saveRecords();
                // ç«‹å³åˆ·æ–°æ—¥å†ä¸åˆ—è¡¨ï¼Œä¸ç­‰å¾…
                renderCalendar();
                renderRecords();
                // å¹¿æ’­ä¸€æ¬¡å…¨å±€äº‹ä»¶ï¼Œä¾›å…¶ä»–åœ°æ–¹è®¢é˜…
                try {
                    window.dispatchEvent(new CustomEvent('history:updated'));
                } catch (e) {}
                
                // ä½¿ç”¨å…¨å±€é€šçŸ¥ç³»ç»Ÿ
                if (typeof showSuccessMessage === 'function') {
                    showSuccessMessage('å†å²è®°å½•å·²ä¿å­˜ï¼');
                } else {
                    alert('å†å²è®°å½•å·²ä¿å­˜ï¼');
                }
            }
            
            function showSaveDialog(source) {
                const title = prompt('è¯·è¾“å…¥å†å²è®°å½•æ ‡é¢˜ï¼ˆç•™ç©ºå°†ä½¿ç”¨é»˜è®¤æ ‡é¢˜ï¼‰ï¼š');
                if (title === null) return; // ç”¨æˆ·å–æ¶ˆ
                saveRecord(source, title || undefined);
            }
            
            function deleteRecord(recordId) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿ')) {
                    historyRecords = historyRecords.filter(r => r.id !== recordId);
                    saveRecords();
                    renderRecords();
                }
            }
            
            function viewRecord(recordId) {
                const record = historyRecords.find(r => r.id === recordId);
                if (!record) return;
                
                // æ ¹æ®æ¥æºåˆ‡æ¢åˆ°ç›¸åº”ç•Œé¢
                const source = record.source || 'productManager';
                let targetTab = 'productManager';
                let targetContainer = 'pm_resultsContainer';
                
                if (source === 'priceAdjuster') {
                    targetTab = 'priceAdjuster';
                    targetContainer = 'pa_resultArea';
                } else if (source === 'symbolChanger') {
                    targetTab = 'symbolChanger';
                    targetContainer = 'sc_resultArea';
                }
                
                // åˆ‡æ¢åˆ°å¯¹åº”ç•Œé¢
                switchTab(targetTab);
                
                setTimeout(() => {
                    const container = document.getElementById(targetContainer);
                    if (!container) return;
                    
                    container.innerHTML = '';
                    
                    if (source === 'productManager') {
                        // äº§å“ç®¡ç†ç•Œé¢
                        record.products.forEach((item, index) => {
                            const div = document.createElement('div');
                            div.className = 'result-item';
                            div.innerHTML = `
                                <input type="checkbox" class="result-checkbox" onchange="ProductManager.toggleSelectAll()">
                                <div class="result-text" contenteditable="true">${item.text}</div>
                            `;
                            container.appendChild(div);
                        });
                    } else if (source === 'priceAdjuster') {
                        // ä»·æ ¼è°ƒæ•´ç•Œé¢ï¼ˆæ–‡æœ¬ + æ–°ä»·ï¼›æ— ä»·åˆ™ä»…æ–‡æœ¬ï¼‰
                        record.products.forEach((item, index) => {
                            const div = document.createElement('div');
                            div.className = 'result-item';
                            const hasNewPrice = typeof item.newPrice !== 'undefined' && item.newPrice !== null && item.newPrice !== '';
                            const priceHtml = hasNewPrice ? `<div class=\\"result-price\\"><span class=\\"result-price new\\">Â¥${item.newPrice}</span></div>` : `<div class=\\"result-price\\"></div>`;
                            div.innerHTML = `
                                <div class=\"result-content\">${item.text}</div>
                                ${priceHtml}
                            `;
                            container.appendChild(div);
                        });
                    } else if (source === 'symbolChanger') {
                        // ç¬¦å·æ›´æ¢ç•Œé¢
                        record.products.forEach((item, index) => {
                            const div = document.createElement('div');
                            div.className = 'result-item';
                            div.innerHTML = `
                                <div class="result-text">${item.text}</div>
                            `;
                            container.appendChild(div);
                        });
                    }
                    
                    // ä½¿ç”¨å…¨å±€é€šçŸ¥ç³»ç»Ÿ
                    if (typeof showSuccessMessage === 'function') {
                        showSuccessMessage('å†å²è®°å½•å·²åŠ è½½ï¼');
                    } else {
                        alert('å†å²è®°å½•å·²åŠ è½½ï¼');
                    }
                }, 300);
            }
            
            function showImage(recordId) {
                const record = historyRecords.find(r => r.id === recordId);
                if (!record) return;
                
                const modal = document.createElement('div');
                modal.className = 'image-viewer-modal';
                modal.innerHTML = `
                    <button class="image-viewer-close" onclick="this.parentElement.remove()">&times;</button>
                    <img src="${record.thumbnail}" class="image-viewer-img" id="viewerImg">
                `;
                
                document.body.appendChild(modal);
                
                // ç®€å•çš„å›¾ç‰‡ç¼©æ”¾æ”¯æŒ
                const img = modal.querySelector('#viewerImg');
                let scale = 1;
                let startDistance = 0;
                
                modal.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const touch1 = e.touches[0];
                        const touch2 = e.touches[1];
                        startDistance = Math.hypot(
                            touch1.clientX - touch2.clientX,
                            touch1.clientY - touch2.clientY
                        );
                    }
                });
                
                modal.addEventListener('touchmove', (e) => {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const touch1 = e.touches[0];
                        const touch2 = e.touches[1];
                        const distance = Math.hypot(
                            touch1.clientX - touch2.clientX,
                            touch1.clientY - touch2.clientY
                        );
                        
                        scale = distance / startDistance;
                        img.style.transform = `scale(${scale})`;
                    }
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }
            
            function enterCompareMode() {
                isCompareMode = true;
                selectedRecords = [];
                document.getElementById('compareFloatingBtn').style.display = 'none';
                renderRecords();
            }
            
            function exitCompareMode() {
                isCompareMode = false;
                selectedRecords = [];
                document.getElementById('compareFloatingBtn').style.display = 'none';
                renderRecords();
            }
            
            function toggleRecordSelection(recordId) {
                if (!isCompareMode) return;
                
                const index = selectedRecords.indexOf(recordId);
                if (index > -1) {
                    selectedRecords.splice(index, 1);
                } else {
                    if (selectedRecords.length < 3) {
                        selectedRecords.push(recordId);
                    } else {
                        alert('æœ€å¤šåªèƒ½é€‰æ‹©3æ¡è®°å½•è¿›è¡Œå¯¹æ¯”');
                    }
                }
                
                document.getElementById('compareCount').textContent = selectedRecords.length;
                document.getElementById('compareFloatingBtn').style.display = selectedRecords.length > 0 ? 'block' : 'none';
                
                renderRecords();
            }
            
            function startCompare() {
                if (selectedRecords.length < 2) {
                    alert('è¯·è‡³å°‘é€‰æ‹©2æ¡è®°å½•è¿›è¡Œå¯¹æ¯”');
                    return;
                }
                
                // åˆ›å»ºå¯¹æ¯”é¡µé¢
                const compareView = document.createElement('div');
                compareView.id = 'compareView';
                compareView.style.cssText = `
                    position: fixed;
                    top: 50px;
                    left: 0;
                    right: 0;
                    bottom: 70px;
                    background: white;
                    z-index: 2000;
                    overflow-y: auto;
                    padding: 20px;
                `;
                
                const selected = historyRecords.filter(r => selectedRecords.includes(r.id));
                
                // æå–æ‰€æœ‰äº§å“è¿›è¡Œå¯¹æ¯”
                const productMap = {};
                selected.forEach((record, index) => {
                    record.products.forEach(product => {
                        const key = product.text.split('ï¼š')[0]; // ç”¨äº§å“åç§°ä½œä¸ºé”®
                        if (!productMap[key]) {
                            productMap[key] = {};
                        }
                        productMap[key][`record_${index}`] = {
                            text: product.text,
                            price: product.price
                        };
                    });
                });
                
                let html = `
                    <div style="margin-bottom: 30px;">
                        <button onclick="document.getElementById('compareView').remove(); HistoryManager.exitCompareMode()" 
                                style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-bottom: 20px;">
                            â† è¿”å›</button>
                        <h2 style="margin: 20px 0;">ä»·æ ¼å¯¹æ¯”åˆ†æ</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${selected.map((r, i) => `
                                <div style="background: #f0f8ff; padding: 10px; border-radius: 6px;">
                                    <div><strong>è®°å½•${i+1}</strong></div>
                                    <div style="font-size: 12px; color: #666;">${r.date}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px; background: white;">
                        <thead>
                            <tr style="background: #f5f5f5;">
                                <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">äº§å“åç§°</th>
                                ${selected.map((_, i) => `<th style="padding: 12px; text-align: center; border: 1px solid #ddd;">è®°å½•${i+1}ä»·æ ¼</th>`).join('')}
                                <th style="padding: 12px; text-align: center; border: 1px solid #ddd;">å˜åŒ–è¶‹åŠ¿</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                Object.keys(productMap).forEach((key, i) => {
                    const product = productMap[key];
                    const prices = selected.map((_, index) => product['record_' + index]);
                    
                    const bgColor = i % 2 === 0 ? '#fff' : '#fafafa';
                    
                    html += '<tr>';
                    html += '<td style="padding: 12px; border: 1px solid #ddd; background: ' + bgColor + ';">' + key + '</td>';
                    
                    prices.forEach((p) => {
                        const price = p ? p.price : '-';
                        html += '<td style="padding: 12px; text-align: center; border: 1px solid #ddd; background: ' + bgColor + ';">' + price + '</td>';
                    });
                    
                    // ä»·æ ¼å˜åŒ–è¶‹åŠ¿
                    const validPrices = prices.filter(function(p) { return p && p.price; }).map(function(p) {
                        return parseFloat(p.price.replace(/,/g, ''));
                    });
                    if (validPrices.length >= 2) {
                        const first = validPrices[0];
                        const last = validPrices[validPrices.length - 1];
                        const change = last - first;
                        const percent = ((change / first) * 100).toFixed(1);
                        const trend = change > 0 ? 'â†‘' : change < 0 ? 'â†“' : 'â†’';
                        const color = change > 0 ? '#e74c3c' : change < 0 ? '#27ae60' : '#999';
                        
                        html += '<td style="padding: 12px; text-align: center; border: 1px solid #ddd; color: ' + color + '; background: ' + bgColor + ';">';
                        html += trend + ' ' + percent + '%';
                        html += '</td>';
                    } else {
                        html += '<td style="padding: 12px; text-align: center; border: 1px solid #ddd;"></td>';
                    }
                    
                    html += '</tr>';
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                compareView.innerHTML = html;
                document.body.appendChild(compareView);
            }
            
            function filterRecords() {
                const year = document.getElementById('historyYearSelect').value;
                const month = document.getElementById('historyMonthSelect').value;
                
                let filtered = historyRecords;
                
                // é¦–å…ˆåº”ç”¨æ¥æºç­›é€‰
                if (currentFilterSource !== 'all') {
                    filtered = filtered.filter(r => (r.source || 'productManager') === currentFilterSource);
                }
                
                if (year !== 'all') {
                    filtered = filtered.filter(r => {
                        const recordYear = new Date(r.timestamp).getFullYear();
                        return recordYear.toString() === year;
                    });
                }
                
                if (month !== 'all') {
                    filtered = filtered.filter(r => {
                        const recordMonth = new Date(r.timestamp).getMonth() + 1;
                        return recordMonth.toString() === month;
                    });
                }
                
                // æ˜¾ç¤ºç­›é€‰ç»“æœ
                const container = document.getElementById('historyListContainer');
                container.innerHTML = '';
                
                if (filtered.length === 0) {
                    document.getElementById('historyEmptyState').style.display = 'block';
                    return;
                }
                
                document.getElementById('historyEmptyState').style.display = 'none';
                
                filtered.forEach(record => {
                    const card = document.createElement('div');
                    card.className = 'history-card';
                    card.style.position = 'relative';
                    
                    card.innerHTML = `
                        <img src="${record.thumbnail}" class="history-card-thumbnail" onclick="HistoryManager.showImage('${record.id}')">
                        <div class="history-card-title">${record.title}</div>
                        <div class="history-card-date">${record.date}</div>
                        <div class="history-card-info">
                            <span>äº§å“æ•°: ${record.productCount}</span>
                        </div>
                        <div class="history-card-actions">
                            <button class="btn btn-secondary" onclick="HistoryManager.viewRecord('${record.id}')">æŸ¥çœ‹</button>
                            <button class="btn btn-danger" onclick="HistoryManager.deleteRecord('${record.id}')">åˆ é™¤</button>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            }
            
            function clearFilter() {
                document.getElementById('historyYearSelect').value = 'all';
                document.getElementById('historyMonthSelect').value = 'all';
                renderRecords();
            }
            
            function deleteAll() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    historyRecords = [];
                    saveRecords();
                    renderRecords();
                }
            }
            
            function findExplicitPrices(text) {
                // ç®€åŒ–ç‰ˆä»·æ ¼æå–ï¼Œä» ProductManager å¤åˆ¶
                const pricePattern = /(\d{1,3}(?:,\d{3})*(?:\.\d+)?|\d+\.\d+)/g;
                const matches = text.match(pricePattern);
                return matches || [];
            }
            
            // æ–°å¢ï¼šæ—¥æœŸæ ¼å¼åŒ–è¾…åŠ©å‡½æ•°
            function formatDateKey(year, month, day) {
                return `${year}/${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}`;
            }
            
            function getDateKeyFromTimestamp(timestamp) {
                const date = new Date(timestamp);
                return formatDateKey(date.getFullYear(), date.getMonth() + 1, date.getDate());
            }
            
            // æ–°å¢ï¼šæ¥æºç­›é€‰
            let currentFilterSource = 'all';
            function filterBySource(source) {
                currentFilterSource = source;
                
                // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`.filter-tab[data-filter="${source}"]`)?.classList.add('active');
                
                // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥æ›´æ–°è®°å½•æ¡æ•°
                renderCalendar();
                
                renderRecords();
            }
            
            // æ–°å¢ï¼šè§†å›¾åˆ‡æ¢
            let currentView = 'grid';
            function switchView(view) {
                currentView = view;
                localStorage.setItem('historyView', view);
                
                const container = document.getElementById('historyListContainer');
                container.className = `history-list ${view}-view`;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.view-btn[data-view="${view}"]`)?.classList.add('active');
            }
            
            // æ–°å¢ï¼šæ—¥å†ç›¸å…³
            let currentCalendarYear = new Date().getFullYear();
            let currentCalendarMonth = new Date().getMonth() + 1;
            let selectedDate = null;
            
            function initCalendar() {
                console.log('initCalendar called');
                console.log('historyRecords length:', historyRecords.length);
                console.log('currentCalendarYear:', currentCalendarYear);
                console.log('currentCalendarMonth:', currentCalendarMonth);
                
                renderCalendar();
                loadSavedView();
                
                // å¼ºåˆ¶æ¸²æŸ“å†å²è®°å½•
                console.log('Forcing renderRecords...');
                renderRecords();
            }
            
            function renderCalendar() {
                console.log('renderCalendar called');
                
                const firstDay = new Date(currentCalendarYear, currentCalendarMonth - 1, 1);
                const lastDay = new Date(currentCalendarYear, currentCalendarMonth, 0);
                const daysInMonth = lastDay.getDate();
                const startDayOfWeek = firstDay.getDay();
                
                console.log('Calendar data:', { firstDay, lastDay, daysInMonth, startDayOfWeek });
                
                const calendarDays = document.getElementById('calendarDays');
                const currentMonthEl = document.getElementById('calendarCurrentMonth');
                
                console.log('Calendar elements:', { calendarDays, currentMonthEl });
                
                if (!calendarDays || !currentMonthEl) {
                    console.error('Calendar elements not found!');
                    return;
                }
                
                currentMonthEl.textContent = `${currentCalendarYear} / ${currentCalendarMonth}`;
                
                calendarDays.innerHTML = '';
                
                // è·å–å½“æœˆè®°å½•ç»Ÿè®¡
                const recordCounts = getRecordCountsByDate(currentCalendarYear, currentCalendarMonth);
                console.log('Record counts:', recordCounts);
                
                // å¡«å……ç©ºç™½æ—¥æœŸ
                for (let i = 0; i < startDayOfWeek; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    calendarDays.appendChild(emptyDay);
                }
                
                // å¡«å……æ—¥æœŸæ ¼å­
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    const count = recordCounts[day] || 0;
                    const isSelected = selectedDate && 
                        selectedDate.year === currentCalendarYear && 
                        selectedDate.month === currentCalendarMonth && 
                        selectedDate.day === day;
                    
                    dayEl.className = `calendar-day ${count > 0 ? 'has-records' : ''} ${isSelected ? 'selected' : ''}`;
                    dayEl.innerHTML = `
                        <div class="calendar-day-number">${day}</div>
                        ${count > 0 ? `<div class="calendar-day-count">${count}æ¡</div>` : ''}
                    `;
                    dayEl.onclick = () => selectDate(day);
                    
                    calendarDays.appendChild(dayEl);
                }
            }
            
            function getRecordCountsByDate(year, month) {
                const counts = {};
                historyRecords.forEach(record => {
                    const date = new Date(record.timestamp);
                    if (date.getFullYear() === year && date.getMonth() + 1 === month) {
                        // æ ¹æ®å½“å‰ç­›é€‰æ¡ä»¶è¿‡æ»¤
                        if (currentFilterSource === 'all' || 
                            (record.source || 'productManager') === currentFilterSource) {
                            const day = date.getDate();
                            counts[day] = (counts[day] || 0) + 1;
                        }
                    }
                });
                return counts;
            }
            
            function selectDate(day) {
                // ä¸è®¾ç½® selectedDateï¼Œé¿å…æ—¥æœŸç­›é€‰
                
                // éšè—æ—¥å†ï¼Œæ˜¾ç¤ºå†å²è®°å½•åˆ—è¡¨
                document.querySelector('.calendar-picker').style.display = 'none';
                document.getElementById('historyListContainer').style.display = 'grid';
                
                // æ·»åŠ è¿”å›æ—¥å†æŒ‰é’®
                addBackToCalendarButton();
                
                // æ¸²æŸ“æ‰€æœ‰è®°å½•ï¼ˆæŒ‰æ¥æºç­›é€‰ï¼‰
                renderRecords();
                
                // æ»šåŠ¨åˆ°æŒ‡å®šæ—¥æœŸ
                const dateKey = formatDateKey(currentCalendarYear, currentCalendarMonth, day);
                const targetElement = document.getElementById(`date-${dateKey.replace(/\//g, '-')}`);
                
                console.log('Looking for date element:', `date-${dateKey.replace(/\//g, '-')}`);
                console.log('Target element found:', targetElement);
                
                if (targetElement) {
                    setTimeout(() => {
                        targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                } else {
                    console.log('Target element not found, available elements:', 
                        Array.from(document.querySelectorAll('[id^="date-"]')).map(el => el.id));
                }
            }
            
            function changeMonth(direction) {
                currentCalendarMonth += direction;
                
                if (currentCalendarMonth < 1) {
                    currentCalendarMonth = 12;
                    currentCalendarYear--;
                } else if (currentCalendarMonth > 12) {
                    currentCalendarMonth = 1;
                    currentCalendarYear++;
                }
                
                renderCalendar();
            }
            
            function showHistoryView() {
                // åˆ‡æ¢åˆ°å†å²è®°å½•ç•Œé¢
                switchTab('historyViewer');
            }
            
            function addBackToCalendarButton() {
                // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨è¿”å›æŒ‰é’®
                if (document.getElementById('backToCalendarBtn')) {
                    return;
                }
                // ä»…åœ¨å†å²è®°å½•é¡µæ˜¾ç¤º
                if (typeof currentTab !== 'undefined' && currentTab !== 'historyViewer') {
                    return;
                }
                
                const backBtn = document.createElement('div');
                backBtn.id = 'backToCalendarBtn';
                backBtn.style.cssText = `
                    position: fixed;
                    top: 80px;
                    left: 20px;
                    z-index: 1000;
                    background: #667eea;
                    color: white;
                    padding: 10px 15px;
                    border-radius: 20px;
                    font-size: 14px;
                    cursor: pointer;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    display: flex;
                    align-items: center;
                    gap: 5px;
                `;
                backBtn.innerHTML = 'â† è¿”å›æ—¥å†';
                backBtn.onclick = backToCalendar;
                
                document.body.appendChild(backBtn);
            }
            
            function backToCalendar() {
                // æ¸…é™¤æ—¥æœŸé€‰æ‹©
                selectedDate = null;
                
                // æ˜¾ç¤ºæ—¥å†ï¼Œéšè—åˆ—è¡¨
                document.querySelector('.calendar-picker').style.display = 'block';
                document.getElementById('historyListContainer').style.display = 'none';
                
                // ç§»é™¤è¿”å›æŒ‰é’®
                const backBtn = document.getElementById('backToCalendarBtn');
                if (backBtn) {
                    backBtn.remove();
                }
                
                // é‡æ–°æ¸²æŸ“æ—¥å†
                renderCalendar();
            }
            
            function displayFilteredRecords(filtered) {
                const container = document.getElementById('historyListContainer');
                const emptyState = document.getElementById('historyEmptyState');
                
                container.innerHTML = '';
                
                // å¦‚æœæ²¡æœ‰ä¼ å…¥filteredå‚æ•°ï¼Œä½¿ç”¨renderRecordsè¿›è¡Œç­›é€‰
                if (!filtered) {
                    renderRecords();
                    return;
                }
                
                if (filtered.length === 0) {
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                filtered.forEach(record => {
                    const card = document.createElement('div');
                    card.className = `history-card ${selectedRecords.includes(record.id) ? 'comparing' : ''}`;
                    
                    const sourceIcon = {
                        'productManager': 'ğŸ“¦',
                        'priceAdjuster': 'ğŸ’°',
                        'symbolChanger': 'ğŸ”„'
                    }[record.source || 'productManager'] || 'ğŸ“¦';
                    
                    card.innerHTML = `
                        <img src="${record.thumbnail}" class="history-card-thumbnail" onclick="HistoryManager.showImage('${record.id}')">
                        <div class="history-card-title">${sourceIcon} ${record.title}</div>
                        <div class="history-card-date">${record.date}</div>
                        <div class="history-card-info">
                            <span>äº§å“æ•°: ${record.productCount}</span>
                        </div>
                        <div class="history-card-actions">
                            <button class="btn btn-secondary" onclick="HistoryManager.viewRecord('${record.id}')">æŸ¥çœ‹</button>
                            <button class="btn btn-danger" onclick="HistoryManager.deleteRecord('${record.id}')">åˆ é™¤</button>
                        </div>
                    `;
                    
                    if (isCompareMode) {
                        card.onclick = () => toggleRecordSelection(record.id);
                    }
                    
                    container.appendChild(card);
                });
            }
            
            function loadSavedView() {
                const savedView = localStorage.getItem('historyView') || 'grid';
                switchView(savedView);
            }
            
            // HTMLè½¬ä¹‰å‡½æ•°
            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // æ›´æ–° renderRecords å‡½æ•°ï¼Œæ”¯æŒç­›é€‰å’Œè§†å›¾
            const originalRenderRecords = typeof renderRecords !== 'undefined' ? renderRecords : null;
            renderRecords = function() {
                console.log('=== renderRecords START ===');
                console.log('currentFilterSource:', currentFilterSource);
                console.log('Total records:', historyRecords.length);
                
                let filtered = historyRecords;
                
                // åªæ ¹æ®æ¥æºç­›é€‰ï¼Œä¸é™åˆ¶æ—¥æœŸ
                if (currentFilterSource !== 'all') {
                    const beforeFilter = filtered.length;
                    filtered = filtered.filter(r => (r.source || 'productManager') === currentFilterSource);
                    console.log('Filter applied:', currentFilterSource, 'before:', beforeFilter, 'after:', filtered.length);
                    if (filtered.length > 0) {
                        console.log('Sample filtered sources:', filtered.slice(0, 3).map(r => r.source || 'productManager'));
                    }
                } else {
                    console.log('No filter applied (showing all)');
                }
                
                console.log('Filtered records:', filtered.length);
                console.log('=== renderRecords END ===');
                
                const container = document.getElementById('historyListContainer');
                const emptyState = document.getElementById('historyEmptyState');
                
                if (!container) {
                    console.log('historyListContainer not found');
                    return;
                }
                
                if (filtered.length === 0) {
                    if (emptyState) emptyState.style.display = 'block';
                    container.innerHTML = '';
                    return;
                }
                
                if (emptyState) emptyState.style.display = 'none';
                container.innerHTML = '';
                
                // æŒ‰æ—¥æœŸåˆ†ç»„
                const groupedByDate = {};
                filtered.forEach(record => {
                    const dateKey = getDateKeyFromTimestamp(record.timestamp);
                    if (!groupedByDate[dateKey]) {
                        groupedByDate[dateKey] = [];
                    }
                    groupedByDate[dateKey].push(record);
                });
                
                // æŒ‰æ—¥æœŸé™åºæ’åˆ—
                const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
                    return new Date(b) - new Date(a);
                });
                
                // æ¸²æŸ“æ¯ä¸ªæ—¥æœŸåˆ†ç»„
                sortedDates.forEach(dateKey => {
                    // æ·»åŠ æ—¥æœŸæ ‡é¢˜
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'date-group-header';
                    dateHeader.id = `date-${dateKey.replace(/\//g, '-')}`;
                    dateHeader.innerHTML = `<h3>${dateKey}</h3>`;
                    container.appendChild(dateHeader);
                    
                    // æ¸²æŸ“è¯¥æ—¥æœŸçš„è®°å½•
                    groupedByDate[dateKey].forEach(record => {
                        const card = document.createElement('div');
                        card.className = `history-card ${selectedRecords.includes(record.id) ? 'comparing' : ''}`;
                        
                        const sourceIcon = {
                            'productManager': 'ğŸ“¦',
                            'priceAdjuster': 'ğŸ’°',
                            'symbolChanger': 'ğŸ”„'
                        }[record.source || 'productManager'] || 'ğŸ“¦';
                        
                        // ç”Ÿæˆç¼©ç•¥å›¾HTMLï¼šå¦‚æœæœ‰é¢„è§ˆæ–‡æœ¬åˆ™æ˜¾ç¤ºæ–‡æœ¬ï¼Œå¦åˆ™æ˜¾ç¤ºå ä½å›¾
                        let thumbnailHtml = '';
                        if (record.previewText && record.previewText.length > 0) {
                            thumbnailHtml = `<div class="history-card-thumbnail-text" onclick="HistoryManager.viewRecord('${record.id}')">
                                ${record.previewText.map(line => `<div class="preview-line">${escapeHtml(line || '')}</div>`).join('')}
                            </div>`;
                        } else {
                            thumbnailHtml = `<img src="${record.thumbnail}" class="history-card-thumbnail" onclick="HistoryManager.showImage('${record.id}')">`;
                        }
                        
                        card.innerHTML = `
                            ${thumbnailHtml}
                            <div class="history-card-title">${sourceIcon} ${record.title}</div>
                            <div class="history-card-date">${record.date}</div>
                            <div class="history-card-info">
                                <span>äº§å“æ•°: ${record.productCount}</span>
                            </div>
                            <div class="history-card-actions">
                                <button class="btn btn-secondary" onclick="HistoryManager.viewRecord('${record.id}')">æŸ¥çœ‹</button>
                                <button class="btn btn-danger" onclick="HistoryManager.deleteRecord('${record.id}')">åˆ é™¤</button>
                            </div>
                        `;
                        
                        if (isCompareMode) {
                            card.onclick = () => toggleRecordSelection(record.id);
                        }
                        
                        container.appendChild(card);
                    });
                });
            };
            
            // æ›´æ–°initå‡½æ•°
            const originalInit = init;
            init = function() {
                originalInit();
                
                // å»¶è¿Ÿåˆå§‹åŒ–æ—¥å†ï¼Œç¡®ä¿DOMå·²åŠ è½½
                setTimeout(() => {
                    console.log('HistoryManager init - starting calendar initialization');
                    if (typeof initCalendar === 'function') {
                        initCalendar();
                    }
                }, 100);
            };
            
            return {
                init: init,
                saveRecord: saveRecord,
                deleteRecord: deleteRecord,
                viewRecord: viewRecord,
                showImage: showImage,
                showSaveDialog: showSaveDialog,
                enterCompareMode: enterCompareMode,
                exitCompareMode: exitCompareMode,
                toggleRecordSelection: toggleRecordSelection,
                startCompare: startCompare,
                filterRecords: filterRecords,
                clearFilter: clearFilter,
                deleteAll: deleteAll,
                renderRecords: renderRecords,
                filterBySource: filterBySource,
                switchView: switchView,
                changeMonth: changeMonth,
                selectDate: selectDate,
                showHistoryView: showHistoryView,
                displayFilteredRecords: displayFilteredRecords,
                addBackToCalendarButton: addBackToCalendarButton,
                backToCalendar: backToCalendar
            };
        })();
        
        // ========== å…¨å±€Tabåˆ‡æ¢é€»è¾‘ ==========
        let currentTab = 'productManager'; // é»˜è®¤æ˜¾ç¤ºäº§å“ç®¡ç†
        
        // ç¡®ä¿åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–currentTab
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof currentTab === 'undefined') {
                currentTab = 'productManager';
            }
        });
        
        function switchTab(tabName) {
            // ç¡®ä¿currentTabå·²åˆå§‹åŒ–
            if (typeof currentTab === 'undefined') {
                currentTab = 'productManager';
            }
            
            console.log('Switching to tab:', tabName, 'currentTab:', currentTab);
            
            // éšè—æ‰€æœ‰tabå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰nav-itemçš„activeçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„tabå†…å®¹
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // æ¿€æ´»å¯¹åº”çš„nav-item
            const targetNavItem = document.querySelector(`.nav-item[data-tab="${tabName}"]`);
            if (targetNavItem) {
                targetNavItem.classList.add('active');
            }
            
            // æ›´æ–°é¡¶éƒ¨æ ‡é¢˜
            const titles = {
                'productManager': 'äº§å“ç®¡ç†',
                'priceAdjuster': 'ä»·æ ¼è°ƒæ•´',
                'symbolChanger': 'ç¬¦å·æ›´æ¢',
                'historyViewer': 'å†å²è®°å½•',
                'membership': 'ä¼šå‘˜ä¸­å¿ƒ',
                'settings': 'æˆ‘çš„'
            };
            document.getElementById('topPageTitle').textContent = titles[tabName] || 'å®¶ç”µæŠ¥ä»·åŠ©æ‰‹';
            
            currentTab = tabName;
            
            // å¦‚æœåˆ‡æ¢åˆ°å†å²è®°å½•ï¼Œå¼ºåˆ¶åˆ·æ–°æ—¥å†å’Œè®°å½•
            if (tabName === 'historyViewer') {
                setTimeout(() => {
                    console.log('Switched to historyViewer, force refreshing...');
                    if (typeof HistoryManager !== 'undefined' && HistoryManager.renderRecords) {
                        HistoryManager.renderRecords();
                    }
                    // è‹¥å½“å‰å¤„äºåˆ—è¡¨è§†å›¾ï¼ˆæ—¥å†éšè—ã€åˆ—è¡¨å¯è§ï¼‰ï¼Œåˆ™é‡å»ºè¿”å›æ—¥å†æŒ‰é’®
                    try {
                        const calendarEl = document.querySelector('.calendar-picker');
                        const listEl = document.getElementById('historyListContainer');
                        const calendarHidden = calendarEl && getComputedStyle(calendarEl).display === 'none';
                        const listVisible = listEl && getComputedStyle(listEl).display !== 'none';
                        if (calendarHidden && listVisible && HistoryManager && HistoryManager.addBackToCalendarButton) {
                            HistoryManager.addBackToCalendarButton();
                        }
                    } catch (e) { /* noop */ }
                }, 100);
            } else {
                // ç¦»å¼€å†å²é¡µæ—¶ç§»é™¤è¿”å›æ—¥å†æŒ‰é’®
                const backBtn = document.getElementById('backToCalendarBtn');
                if (backBtn) backBtn.remove();
            }
        }
        
        function openCurrentPageMenu() {
            alert('å½“å‰é¡µé¢ï¼š' + document.getElementById('topPageTitle').textContent);
        }
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            ProductManager.init();
            PriceAdjuster.init();
            SymbolChanger.init();
            Membership.init();
            Settings.init();
            HistoryManager.init();
            switchTab('productManager'); // åˆå§‹åŒ–æ˜¾ç¤ºäº§å“ç®¡ç†é¡µé¢
        });
        
        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(function(registration) {
                    console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration);
                })
                .catch(function(error) {
                    console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                });
        }
    </script>
</body>
</html>

